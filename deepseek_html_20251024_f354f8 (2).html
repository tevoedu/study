<!DOCTYPE html> 
<html lang="pt-BR"> 
<head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>StudyFlow - ChatBot Central</title> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
  <style> 
    :root { 
      --primary: #25D366; 
      --primary-dark: #128C7E; 
      --secondary: #34B7F1; 
      --success: #4CAF50; 
      --warning: #FF9800; 
      --danger: #F44336; 
      --light: #FFFFFF; 
      --dark: #1F2C34; 
      --gray: #667781; 
      --light-gray: #F0F0F0; 
      --chat-bg: #E5DDD5; 
      --user-bubble: #DCF8C6; 
      --bot-bubble: #FFFFFF; 
      --border-radius: 18px; 
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.12); 
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
    } 
    
    .dark-theme { 
      --primary: #00A884; 
      --primary-dark: #008069; 
      --secondary: #53BDEB; 
      --light: #111B21; 
      --dark: #E9EDEF; 
      --gray: #8696A0; 
      --light-gray: #202C33; 
      --chat-bg: #0B141A; 
      --user-bubble: #005C4B; 
      --bot-bubble: #202C33; 
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.3); 
    } 
    
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
    } 
    
    body { 
      background-color: var(--light); 
      color: var(--dark); 
      height: 100vh; 
      display: flex; 
      flex-direction: column; 
      transition: var(--transition); 
      overflow: hidden; 
    } 
    
    .chatbot-container { 
      display: flex; 
      flex-direction: column; 
      height: 100vh; 
      width: 100%; 
      background-color: var(--chat-bg); 
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E"); 
      overflow: hidden; 
      position: relative; 
    } 
    
    .chatbot-header { 
      background-color: var(--light); 
      color: var(--dark); 
      padding: 0.8rem 1.5rem; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); 
      z-index: 10; 
      position: relative; 
    } 
    
    .header-left { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
    } 
    
    .bot-avatar { 
      width: 40px; 
      height: 40px; 
      border-radius: 50%; 
      background: linear-gradient(135deg, var(--primary), var(--secondary)); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 1.2rem; 
      color: white; 
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); 
    } 
    
    .header-info h1 { 
      font-size: 1.1rem; 
      font-weight: 600; 
      margin-bottom: 2px; 
    } 
    
    .header-info p { 
      font-size: 0.8rem; 
      opacity: 0.7; 
      display: flex; 
      align-items: center; 
      gap: 4px; 
    } 
    
    .status-dot { 
      width: 8px; 
      height: 8px; 
      border-radius: 50%; 
      background-color: var(--success); 
      display: inline-block; 
    } 
    
    .header-actions { 
      display: flex; 
      gap: 10px; 
    } 
    
    .header-btn { 
      background: transparent; 
      border: none; 
      color: var(--gray); 
      width: 36px; 
      height: 36px; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      cursor: pointer; 
      transition: var(--transition); 
    } 
    
    .header-btn:hover { 
      background-color: var(--light-gray); 
    } 
    
    .chat-messages { 
      display: flex; 
      flex-direction: column; 
      padding: 1rem; 
      overflow-y: auto; 
      flex: 1; 
      gap: 8px; 
      scroll-behavior: smooth; 
    } 
    
    .message-container { 
      display: flex; 
      margin-bottom: 4px; 
      animation: messageAppear 0.3s ease-out; 
    } 
    
    .bot-container { 
      justify-content: flex-start; 
    } 
    
    .user-container { 
      justify-content: flex-end; 
    } 
    
    .avatar { 
      width: 32px; 
      height: 32px; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      margin: 0 8px; 
      flex-shrink: 0; 
      align-self: flex-end; 
      margin-bottom: 4px; 
    } 
    
    .bot-avatar-small { 
      background: linear-gradient(135deg, var(--primary), var(--secondary)); 
      color: white; 
      font-size: 0.9rem; 
    } 
    
    .user-avatar-small { 
      background: var(--secondary); 
      color: white; 
      font-size: 0.9rem; 
    } 
    
    .message-bubble { 
      position: relative; 
      padding: 12px 16px; 
      border-radius: var(--border-radius); 
      max-width: 80%; 
      margin-bottom: 2px; 
      word-wrap: break-word; 
      overflow-wrap: break-word; 
      box-shadow: var(--shadow); 
      line-height: 1.4; 
    } 
    
    @keyframes messageAppear { 
      from { 
        opacity: 0; 
        transform: translateY(10px); 
      } 
      to { 
        opacity: 1; 
        transform: translateY(0); 
      } 
    } 
    
    .bot-bubble { 
      background: var(--bot-bubble); 
      align-self: flex-start; 
      border-bottom-left-radius: 4px; 
      color: var(--dark); 
    } 
    
    .user-bubble { 
      background: var(--user-bubble); 
      align-self: flex-end; 
      border-bottom-right-radius: 4px; 
      color: #111B21; 
    } 
    
    .bubble-time { 
      font-size: 0.65rem; 
      opacity: 0.7; 
      margin-top: 4px; 
      text-align: right; 
    } 
    
    .typing-indicator { 
      display: flex; 
      align-items: center; 
      gap: 5px; 
      padding: 12px 16px; 
      background-color: var(--bot-bubble); 
      border-radius: var(--border-radius); 
      border-bottom-left-radius: 4px; 
      align-self: flex-start; 
      width: fit-content; 
      margin-bottom: 8px; 
      box-shadow: var(--shadow); 
    } 
    
    .typing-dot { 
      width: 8px; 
      height: 8px; 
      border-radius: 50%; 
      background-color: var(--gray); 
      animation: typingAnimation 1.4s infinite ease-in-out; 
    } 
    
    .typing-dot:nth-child(1) { 
      animation-delay: -0.32s; 
    } 
    
    .typing-dot:nth-child(2) { 
      animation-delay: -0.16s; 
    } 
    
    @keyframes typingAnimation { 
      0%, 80%, 100% { 
        transform: scale(0.8); 
        opacity: 0.5; 
      } 
      40% { 
        transform: scale(1); 
        opacity: 1; 
      } 
    } 
    
    .chatbot-input { 
      display: flex; 
      padding: 0.8rem 1.5rem; 
      background-color: var(--light); 
      border-top: 1px solid var(--light-gray); 
      gap: 8px; 
      align-items: center; 
    } 
    
    .chatbot-input input { 
      flex: 1; 
      padding: 12px 16px; 
      border-radius: 24px; 
      border: none; 
      background-color: var(--light-gray); 
      color: var(--dark); 
      font-size: 0.95rem; 
      outline: none; 
      transition: var(--transition); 
    } 
    
    .chatbot-input input:focus { 
      background-color: var(--light); 
      box-shadow: 0 0 0 1.5px var(--primary); 
    } 
    
    .input-actions { 
      display: flex; 
      gap: 5px; 
    } 
    
    .input-btn { 
      width: 40px; 
      height: 40px; 
      border-radius: 50%; 
      border: none; 
      background: transparent; 
      color: var(--gray); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      cursor: pointer; 
      transition: var(--transition); 
    } 
    
    .input-btn:hover { 
      background-color: var(--light-gray); 
    } 
    
    .send-btn { 
      width: 40px; 
      height: 40px; 
      border-radius: 50%; 
      border: none; 
      background: var(--primary); 
      color: white; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      cursor: pointer; 
      transition: var(--transition); 
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); 
    } 
    
    .send-btn:hover { 
      background: var(--primary-dark); 
      transform: scale(1.05); 
    } 
    
    .message-content { 
      display: flex; 
      flex-direction: column; 
      gap: 8px; 
    } 
    
    .message-header { 
      display: flex; 
      align-items: center; 
      gap: 8px; 
      margin-bottom: 4px; 
    } 
    
    .message-icon { 
      width: 20px; 
      height: 20px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      border-radius: 50%; 
      background-color: var(--primary); 
      color: white; 
      font-size: 0.7rem; 
    } 
    
    .message-title { 
      font-weight: 600; 
      font-size: 1rem; 
      color: var(--dark); 
    } 
    
    .message-subtitle { 
      font-weight: 500; 
      font-size: 0.9rem; 
      color: var(--dark); 
      margin-bottom: 4px; 
    } 
    
    .message-text { 
      font-size: 0.9rem; 
      line-height: 1.4; 
      color: var(--dark); 
    } 
    
    .message-divider { 
      height: 1px; 
      background-color: var(--light-gray); 
      margin: 8px 0; 
    } 
    
    .message-section { 
      margin: 8px 0; 
    } 
    
    .message-section-title { 
      font-weight: 600; 
      font-size: 0.85rem; 
      margin-bottom: 6px; 
      color: var(--gray); 
      text-transform: uppercase; 
      letter-spacing: 0.5px; 
    } 
    
    .message-list { 
      list-style-type: none; 
      margin: 8px 0; 
      padding-left: 0; 
    } 
    
    .message-list-item { 
      display: flex; 
      align-items: flex-start; 
      gap: 8px; 
      padding: 6px 0; 
      border-bottom: 1px solid var(--light-gray); 
    } 
    
    .message-list-item:last-child { 
      border-bottom: none; 
    } 
    
    .message-list-icon { 
      width: 16px; 
      text-align: center; 
      color: var(--primary); 
      margin-top: 2px; 
      flex-shrink: 0; 
    } 
    
    .message-list-content { 
      flex: 1; 
    } 
    
    .message-list-title { 
      font-weight: 500; 
      font-size: 0.9rem; 
      margin-bottom: 2px; 
    } 
    
    .message-list-description { 
      font-size: 0.8rem; 
      color: var(--gray); 
    } 
    
    .message-stats { 
      display: grid; 
      grid-template-columns: repeat(2, 1fr); 
      gap: 10px; 
      margin: 12px 0; 
    } 
    
    .message-stat { 
      background-color: var(--light-gray); 
      padding: 10px; 
      border-radius: 8px; 
      text-align: center; 
    } 
    
    .message-stat-value { 
      font-size: 1.2rem; 
      font-weight: 700; 
      margin: 3px 0; 
    } 
    
    .message-stat-label { 
      font-size: 0.75rem; 
      color: var(--gray); 
    } 
    
    .message-progress { 
      margin: 10px 0; 
    } 
    
    .message-progress-bar { 
      height: 6px; 
      background-color: var(--light-gray); 
      border-radius: 3px; 
      margin: 8px 0; 
      overflow: hidden; 
    } 
    
    .message-progress-fill { 
      height: 100%; 
      background: linear-gradient(90deg, var(--success), var(--primary)); 
      border-radius: 3px; 
      transition: width 0.5s ease; 
    } 
    
    .message-progress-text { 
      display: flex; 
      justify-content: space-between; 
      font-size: 0.8rem; 
      color: var(--gray); 
    } 
    
    .message-alert { 
      padding: 10px 12px; 
      border-radius: 8px; 
      margin: 8px 0; 
      display: flex; 
      align-items: center; 
      gap: 8px; 
      font-size: 0.9rem; 
      box-shadow: var(--shadow); 
    } 
    
    .message-alert-warning { 
      background-color: rgba(255, 152, 0, 0.1); 
      border-left: 4px solid var(--warning); 
    } 
    
    .message-alert-danger { 
      background-color: rgba(244, 67, 54, 0.1); 
      border-left: 4px solid var(--danger); 
    } 
    
    .message-alert-success { 
      background-color: rgba(76, 175, 80, 0.1); 
      border-left: 4px solid var(--success); 
    } 
    
    .message-alert-info { 
      background-color: rgba(52, 183, 241, 0.1); 
      border-left: 4px solid var(--secondary); 
    } 
    
    .message-card { 
      background-color: var(--bot-bubble); 
      border-radius: 12px; 
      padding: 16px; 
      margin: 10px 0; 
      box-shadow: var(--shadow); 
      border-left: 4px solid var(--primary); 
    } 
    
    .message-card-header { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      margin-bottom: 12px; 
      padding-bottom: 8px; 
      border-bottom: 1px solid var(--light-gray); 
    } 
    
    .message-card-title { 
      font-weight: 600; 
      font-size: 1.1rem; 
      color: var(--dark); 
    } 
    
    .message-card-content { 
      display: flex; 
      flex-direction: column; 
      gap: 8px; 
    } 
    
    .message-muted { 
      font-size: 0.8rem; 
      color: var(--gray); 
      margin-top: 4px; 
    } 
    
    .message-badge { 
      display: inline-block; 
      padding: 2px 8px; 
      background-color: var(--primary); 
      color: white; 
      border-radius: 12px; 
      font-size: 0.7rem; 
      font-weight: 600; 
      margin-left: 6px; 
    } 
    
    .message-badge-warning { 
      background-color: var(--warning); 
    } 
    
    .message-badge-danger { 
      background-color: var(--danger); 
    } 
    
    .message-badge-success { 
      background-color: var(--success); 
    } 
    
    .quick-actions { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 8px; 
      margin: 12px 0; 
      justify-content: center; 
    } 
    
    .action-btn { 
      padding: 10px 16px; 
      background-color: var(--bot-bubble); 
      border: none; 
      border-radius: 20px; 
      cursor: pointer; 
      display: flex; 
      align-items: center; 
      gap: 6px; 
      font-size: 0.85rem; 
      transition: var(--transition); 
      color: var(--dark); 
      box-shadow: var(--shadow); 
      font-weight: 500; 
    } 
    
    .action-btn:hover { 
      background-color: var(--primary); 
      color: white; 
      transform: translateY(-2px); 
    } 
    
    .action-btn.primary { 
      background-color: var(--primary); 
      color: white; 
    } 
    
    .action-btn.secondary { 
      background-color: var(--secondary); 
      color: white; 
    } 
    
    .action-btn.info { 
      background-color: var(--light-gray); 
      color: var(--dark); 
    } 
    
    .action-btn.reset { 
      background-color: var(--danger); 
      color: white; 
    } 
    
    .chat-date { 
      text-align: center; 
      color: var(--gray); 
      font-size: 0.8rem; 
      margin: 10px 0; 
      position: relative; 
    } 
    
    .chat-date::before { 
      content: ''; 
      position: absolute; 
      top: 50%; 
      left: 0; 
      right: 0; 
      height: 1px; 
      background-color: var(--light-gray); 
      z-index: 1; 
    } 
    
    .chat-date span { 
      background-color: var(--chat-bg); 
      padding: 0 10px; 
      position: relative; 
      z-index: 2; 
    } 
    
    .message-reaction { 
      display: flex; 
      justify-content: flex-end; 
      margin-top: 2px; 
    } 
    
    .reaction-icon { 
      font-size: 0.7rem; 
      color: var(--gray); 
    } 
    
    @media (max-width: 768px) { 
      .chatbot-container { 
        height: 100vh; 
      } 
      .message-bubble { 
        max-width: 85%; 
      } 
      .message-stats { 
        grid-template-columns: 1fr; 
      } 
    } 
    
    .typing-text { 
      overflow: hidden; 
      white-space: nowrap; 
      animation: typing 3.5s steps(40, end); 
    } 
    
    @keyframes typing { 
      from { width: 0 } 
      to { width: 100% } 
    } 
    
    .modal { 
      display: none; 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      background-color: rgba(0, 0, 0, 0.5); 
      z-index: 1000; 
      justify-content: center; 
      align-items: center; 
      backdrop-filter: blur(4px); 
      animation: modalFadeIn 0.3s; 
    } 
    
    @keyframes modalFadeIn { 
      from { opacity: 0; } 
      to { opacity: 1; } 
    } 
    
    .modal-content { 
      background-color: var(--light); 
      border-radius: 12px; 
      width: 90%; 
      max-width: 800px; 
      max-height: 90vh; 
      overflow-y: auto; 
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); 
      animation: modalSlideIn 0.3s; 
    } 
    
    @keyframes modalSlideIn { 
      from { opacity: 0; transform: scale(0.9); } 
      to { opacity: 1; transform: scale(1); } 
    } 
    
    .modal-header { 
      padding: 1.2rem 1.5rem; 
      border-bottom: 1px solid var(--light-gray); 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
    } 
    
    .modal-header h3 { 
      font-size: 1.2rem; 
      display: flex; 
      align-items: center; 
      gap: 10px; 
    } 
    
    .close-modal { 
      background: none; 
      border: none; 
      font-size: 1.5rem; 
      cursor: pointer; 
      color: var(--gray); 
      transition: var(--transition); 
    } 
    
    .close-modal:hover { 
      color: var(--dark); 
    } 
    
    .modal-body { 
      padding: 1.5rem; 
    } 
    
    .tasks-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
      gap: 1rem; 
      margin-bottom: 1.5rem; 
    } 
    
    .task-card { 
      background-color: var(--light-gray); 
      border-radius: 12px; 
      padding: 1.5rem; 
      border: 1px solid var(--light-gray); 
      transition: var(--transition); 
      box-shadow: var(--shadow); 
      position: relative; 
    } 
    
    .task-card.disabled { 
      opacity: 0.6; 
    } 
    
    .task-card.active { 
      opacity: 1; 
      border-color: var(--primary); 
      background-color: var(--light); 
    } 
    
    .task-card:hover { 
      transform: translateY(-3px); 
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1); 
    } 
    
    .task-header { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      margin-bottom: 1rem; 
    } 
    
    .task-icon-large { 
      font-size: 1.5rem; 
    } 
    
    .task-title { 
      font-weight: 600; 
      font-size: 1.1rem; 
    } 
    
    .task-description { 
      color: var(--gray); 
      font-size: 0.9rem; 
      margin-bottom: 1rem; 
    } 
    
    .task-form { 
      display: flex; 
      flex-direction: column; 
      gap: 1rem; 
    } 
    
    .form-group { 
      margin-bottom: 0; 
    } 
    
    .form-group label { 
      display: block; 
      margin-bottom: 5px; 
      font-weight: 600; 
      font-size: 0.9rem; 
    } 
    
    .form-group input, .form-group select { 
      width: 100%; 
      padding: 10px 12px; 
      border-radius: 8px; 
      border: 1px solid var(--light-gray); 
      background-color: var(--light); 
      color: var(--dark); 
      font-size: 0.9rem; 
      transition: var(--transition); 
    } 
    
    .form-group input:focus, .form-group select:focus { 
      border-color: var(--primary); 
      box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.2); 
    } 
    
    .empty-state { 
      text-align: center; 
      padding: 2rem; 
      color: var(--gray); 
    } 
    
    .empty-state i { 
      font-size: 3rem; 
      margin-bottom: 1rem; 
      opacity: 0.5; 
    } 
    
    .modal-footer { 
      padding: 1.2rem 1.5rem; 
      border-top: 1px solid var(--light-gray); 
      display: flex; 
      justify-content: flex-end; 
      gap: 10px; 
    } 
    
    .btn { 
      padding: 10px 20px; 
      border-radius: 8px; 
      border: none; 
      cursor: pointer; 
      font-weight: 600; 
      transition: var(--transition); 
    } 
    
    .btn-primary { 
      background-color: var(--primary); 
      color: white; 
    } 
    
    .btn-primary:hover { 
      background-color: var(--primary-dark); 
    } 
    
    .btn-secondary { 
      background-color: var(--light-gray); 
      color: var(--dark); 
    } 
    
    .btn-secondary:hover { 
      background-color: var(--gray); 
      color: white; 
    } 
    
    .activate-btn { 
      background-color: var(--primary); 
      color: white; 
      border: none; 
      border-radius: 8px; 
      padding: 5px 10px; 
      cursor: pointer; 
      font-size: 0.8rem; 
      margin-left: auto; 
      transition: var(--transition); 
    } 
    
    .activate-btn:hover { 
      background-color: var(--primary-dark); 
    } 
    
    .task-card.disabled .activate-btn { 
      display: block; 
    } 
    
    .task-card.active .activate-btn { 
      display: none; 
    } 
    
    /* CORRE√á√ÉO CR√çTICA: Permitir que o bot√£o de ativar seja clic√°vel mesmo em cards desabilitados */
    .task-card.disabled .activate-btn {
      pointer-events: all !important;
    }
    
    /* CORRE√á√ÉO: Tornar os inputs edit√°veis apenas quando o card estiver ativo */
    .task-card.disabled input {
      pointer-events: none;
      background-color: rgba(255, 255, 255, 0.5);
    }
    
    .task-card.active input {
      pointer-events: all;
      background-color: var(--light);
    }
  </style> 
</head> 
<body> 
  <div class="chatbot-container"> 
    <div class="chatbot-header"> 
      <div class="header-left"> 
        <div class="bot-avatar"> 
          <i class="fas fa-robot"></i> 
        </div> 
        <div class="header-info"> 
          <h1>StudyFlow Assistant</h1> 
          <p><span class="status-dot"></span> Online ‚Ä¢ Seu assistente de estudos</p> 
        </div> 
      </div> 
      <div class="header-actions"> 
        <button class="header-btn" id="themeToggle"> 
          <i class="fas fa-moon"></i> 
        </button> 
        <button class="header-btn" id="infoBtn"> 
          <i class="fas fa-info"></i> 
        </button> 
      </div> 
    </div> 
    <div class="chat-messages" id="chatMessages"> 
      <!-- Mensagens ser√£o adicionadas dinamicamente --> 
    </div> 
    <div class="chatbot-input"> 
      <div class="input-actions"> 
        <button class="input-btn" id="attachBtn"> 
          <i class="fas fa-paperclip"></i> 
        </button> 
        <button class="input-btn" id="emojiBtn"> 
          <i class="far fa-smile"></i> 
        </button> 
      </div> 
      <input type="text" id="messageInput" placeholder="Digite uma mensagem..."> 
      <button class="send-btn" id="sendMessage"> 
        <i class="fas fa-paper-plane"></i> 
      </button> 
    </div> 
  </div> 
  
  <!-- Modal de Registro Din√¢mico --> 
  <div class="modal" id="registerModal"> 
    <div class="modal-content"> 
      <div class="modal-header"> 
        <h3><i class="fas fa-plus-circle"></i> Registrar Atividades</h3> 
        <button class="close-modal" id="closeRegisterModal">&times;</button> 
      </div> 
      <div class="modal-body" id="registerModalBody"> 
        <!-- Conte√∫do din√¢mico ser√° inserido aqui --> 
      </div> 
      <div class="modal-footer"> 
        <button class="btn btn-secondary" id="cancelRegister">Cancelar</button> 
        <button class="btn btn-primary" id="saveRegister">Salvar Atividades Selecionadas</button> 
      </div> 
    </div> 
  </div> 
  
  <!-- Modal de Configura√ß√£o de Mat√©rias por Dia --> 
  <div class="modal" id="configModal"> 
    <div class="modal-content"> 
      <div class="modal-header"> 
        <h3><i class="fas fa-cog"></i> Configurar Mat√©rias por Dia</h3> 
        <button class="close-modal" id="closeConfigModal">&times;</button> 
      </div> 
      <div class="modal-body"> 
        <div class="form-group"> 
          <label for="materiasPorDia">Quantidade de mat√©rias por dia:</label> 
          <input type="number" id="materiasPorDia" min="1" max="5" value="1"> 
        </div> 
        <div class="message-muted"> 
          Esta configura√ß√£o define quantas mat√©rias ser√£o mostradas no resumo di√°rio. 
        </div> 
      </div> 
      <div class="modal-footer"> 
        <button class="btn btn-secondary" id="cancelConfig">Cancelar</button> 
        <button class="btn btn-primary" id="saveConfig">Salvar</button> 
      </div> 
    </div> 
  </div> 
  
  <script> 
    // Classe principal do ChatBot 
    class StudyFlowChatBot { 
      constructor() { 
        this.currentTheme = localStorage.getItem('theme') || 'light'; 
        // Limitar hist√≥rico para apenas 3 mensagens 
        this.chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || []; 
        if (this.chatHistory.length > 3) { 
          this.chatHistory = this.chatHistory.slice(-3); 
        } 
        this.messageIds = new Set(); // Para evitar duplica√ß√£o 
        
        // Configura√ß√£o de mat√©rias por dia 
        this.materiasPorDia = parseInt(localStorage.getItem('studyFlow_materiasPorDia')) || 1; 
        
        // Estado do dia atual 
        this.today = new Date().toISOString().split('T')[0]; 
        this.init(); 
      } 
      
      // FUN√á√ÉO ADICIONADA PARA CORRIGIR O ERRO 
      formatTime(date) { 
        const hours = date.getHours().toString().padStart(2, '0'); 
        const minutes = date.getMinutes().toString().padStart(2, '0'); 
        return `${hours}:${minutes}`; 
      } 
      
      init() { 
        this.initTheme(); 
        this.initChat(); 
        this.initEventListeners(); 
        this.showWelcomeMessage(); 
      } 
      
      initTheme() { 
        if (this.currentTheme === 'dark') { 
          document.body.classList.add('dark-theme'); 
          document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>'; 
        } 
      } 
      
      initChat() { 
        // Carregar hist√≥rico do chat 
        if (this.chatHistory.length > 0) { 
          this.chatHistory.forEach(msg => { 
            this.addMessageToChat(msg.content, msg.isUser, msg.timestamp); 
          }); 
        } 
      } 
      
      initEventListeners() { 
        // Toggle de tema 
        document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme()); 
        
        // Bot√£o de info 
        document.getElementById('infoBtn').addEventListener('click', () => this.showInfo()); 
        
        // Enviar mensagem 
        document.getElementById('sendMessage').addEventListener('click', () => this.sendMessage()); 
        document.getElementById('messageInput').addEventListener('keypress', (e) => { 
          if (e.key === 'Enter') { 
            this.sendMessage(); 
          } 
        }); 
        
        // Bot√µes de a√ß√£o r√°pida 
        document.getElementById('attachBtn').addEventListener('click', () => this.showQuickActions()); 
        document.getElementById('emojiBtn').addEventListener('click', () => this.toggleEmojiPicker()); 
        
        // Modal de registro 
        document.getElementById('closeRegisterModal').addEventListener('click', () => this.closeRegisterModal()); 
        document.getElementById('cancelRegister').addEventListener('click', () => this.closeRegisterModal()); 
        document.getElementById('saveRegister').addEventListener('click', () => this.saveSelectedTasks()); 
        
        // Modal de configura√ß√£o 
        document.getElementById('closeConfigModal').addEventListener('click', () => this.closeConfigModal()); 
        document.getElementById('cancelConfig').addEventListener('click', () => this.closeConfigModal()); 
        document.getElementById('saveConfig').addEventListener('click', () => this.saveConfig()); 
        
        // Fechar modal ao clicar fora 
        window.addEventListener('click', (e) => { 
          const registerModal = document.getElementById('registerModal'); 
          const configModal = document.getElementById('configModal'); 
          if (e.target === registerModal) { 
            this.closeRegisterModal(); 
          } 
          if (e.target === configModal) { 
            this.closeConfigModal(); 
          } 
        }); 
      } 
      
      showWelcomeMessage() { 
        if (this.chatHistory.length === 0) { 
          // Adicionar data atual 
          this.addDateDivider(); 
          this.typeMessage("Ol√°! Sou seu assistente de estudos do StudyFlow. üëã", () => { 
            setTimeout(() => { 
              this.typeMessage("Posso te ajudar a gerenciar seu ciclo de estudos, mostrar tarefas di√°rias, registrar progresso e muito mais!", () => { 
                setTimeout(() => { 
                  this.addQuickActions(); 
                }, 500); 
              }); 
            }, 500); 
          }); 
        } 
      } 
      
      addQuickActions() { 
        const quickActionsHTML = ` 
          <div class="quick-actions"> 
            <button class="action-btn primary" onclick="chatBot.showDailySummary()"> 
              <i class="fas fa-calendar-day"></i> Resumo do Dia 
            </button> 
            <button class="action-btn secondary" onclick="chatBot.openRegisterModal()"> 
              <i class="fas fa-plus-circle"></i> Registrar Atividade 
            </button> 
            <button class="action-btn info" onclick="chatBot.showEditalMenu()"> 
              <i class="fas fa-file-alt"></i> Edital 
            </button> 
            <button class="action-btn info" onclick="chatBot.showSimuladosMenu()"> 
              <i class="fas fa-chart-line"></i> Simulados 
            </button> 
            <button class="action-btn info" onclick="chatBot.showConfigModal()"> 
              <i class="fas fa-cog"></i> Configurar 
            </button> 
            <button class="action-btn info" onclick="chatBot.showHelp()"> 
              <i class="fas fa-question-circle"></i> Ajuda 
            </button> 
            <!-- BOT√ÉO DE RESET ATUALIZADO --> 
            <button class="action-btn reset" onclick="chatBot.showResetConfirmation()"> 
              <i class="fas fa-exclamation-triangle"></i> Reset 
            </button> 
          </div> 
        `; 
        this.addBotMessage(quickActionsHTML, false); 
      } 
      
      // FUN√á√ÉO ATUALIZADA: Reset para m√≥dulo Chatbot 
      showResetConfirmation() { 
        const confirmationHTML = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-exclamation-triangle" style="color: var(--danger)"></i> 
              <div class="message-card-title">Reset Tempor√°rio</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-alert message-alert-danger"> 
                <i class="fas fa-exclamation-circle"></i> 
                <div><strong>Aten√ß√£o!</strong> Esta fun√ß√£o executa um reset tempor√°rio do m√≥dulo do Chatbot, √∫til para corrigir travamentos ou inconsist√™ncias nos dados do dia. Nenhum outro m√≥dulo ser√° afetado. Deseja continuar?</div> 
              </div> 
              <div class="quick-actions"> 
                <button class="action-btn reset" onclick="chatBot.resetChatbotData()"> 
                  <i class="fas fa-sync-alt"></i> Confirmar Reset 
                </button> 
                <button class="action-btn info" onclick="chatBot.addBotMessage('Reset cancelado. O sistema permanece inalterado.', false)"> 
                  <i class="fas fa-times"></i> Cancelar 
                </button> 
              </div> 
            </div> 
          </div> 
        `; 
        this.addBotMessage(confirmationHTML, false); 
      } 
      
      // FUN√á√ÉO ATUALIZADA: Reset dos dados do chatbot 
      resetChatbotData() { 
        const hoje = new Date(); 
        const hojeStr = hoje.toLocaleDateString('pt-BR'); 
        
        // Limpar apenas os dados espec√≠ficos do chatbot que est√£o bloqueando o dia 
        localStorage.removeItem('lastRegisterDate'); 
        localStorage.removeItem('dailyActivities'); 
        
        // Mensagem de confirma√ß√£o 
        const successHTML = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-check-circle" style="color: var(--success)"></i> 
              <div class="message-card-title">Reset Conclu√≠do</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-alert message-alert-success"> 
                <i class="fas fa-check-circle"></i> 
                <div><strong>Reset realizado com sucesso!</strong> Dados do m√≥dulo Chatbot reiniciados em ${hojeStr}.</div> 
              </div> 
              <div class="message-text"> 
                Agora voc√™ pode visualizar e registrar as atividades reais do dia. O sistema voltar√° a funcionar normalmente a partir de amanh√£. 
              </div> 
              <div class="quick-actions"> 
                <button class="action-btn primary" onclick="chatBot.showDailySummary()"> 
                  <i class="fas fa-calendar-day"></i> Ver Resumo do Dia 
                </button> 
                <button class="action-btn secondary" onclick="chatBot.openRegisterModal()"> 
                  <i class="fas fa-plus-circle"></i> Registrar Atividades 
                </button> 
              </div> 
            </div> 
          </div> 
        `; 
        this.addBotMessage(successHTML, false); 
      } 
      
      // CORRE√á√ÉO PARA O PROBLEMA DA DATA - FUN√á√ïES NOVAS 
      getDynamicDateString() { 
        // SEMPRE retorna a data atual do sistema 
        const hoje = new Date(); 
        const year = hoje.getFullYear(); 
        const month = String(hoje.getMonth() + 1).padStart(2, '0'); 
        const day = String(hoje.getDate()).padStart(2, '0'); 
        return `${year}-${month}-${day}`; 
      } 
      
      getDynamicDateObject() { 
        // SEMPRE retorna o objeto Date atual 
        return new Date(); 
      } 
      
      formatDynamicDate(date) { 
        // Formata a data para exibi√ß√£o 
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }; 
        return date.toLocaleDateString('pt-BR', options); 
      } 
      
      // CORRE√á√ÉO APLICADA: Fun√ß√£o para verificar se uma data √© hoje 
      isToday(dateString) { 
        const hoje = this.getDynamicDateString(); 
        return dateString === hoje; 
      } 
      
      // CORRE√á√ÉO APLICADA: Fun√ß√£o para verificar se j√° registrou atividades HOJE 
      hasRegisteredToday() { 
        const lastRegisterDate = localStorage.getItem('lastRegisterDate'); 
        return lastRegisterDate && this.isToday(lastRegisterDate); 
      } 
      
      // NOVA FUN√á√ÉO: Verificar se j√° estudou hoje 
      hasStudiedToday() { 
        const dailyActivities = JSON.parse(localStorage.getItem('dailyActivities')) || {}; 
        return dailyActivities.date === this.today; 
      } 
      
      // MODIFICAR A FUN√á√ÉO showDailySummary (substituir a existente) 
      showDailySummary() { 
        const hoje = this.getDynamicDateObject(); // SEMPRE usa data din√¢mica 
        const hojeStr = this.getDynamicDateString(); // SEMPRE usa data atual 
        
        // Atualizar automaticamente os baralhos do Anki 
        this.updateAnkiProgress(); 
        
        // CORRE√á√ÉO APLICADA: Verificar se j√° registrou atividades HOJE usando a nova fun√ß√£o 
        if (this.hasStudiedToday()) { 
          // J√° registrou hoje - mostrar resumo do que foi feito 
          this.showTodaySummary(hojeStr); 
        } else { 
          // N√£o registrou hoje - mostrar tarefas pendentes 
          this.showPendingTasks(hojeStr); 
        } 
      } 
      
      // NOVA FUN√á√ÉO: Atualizar progresso do Anki automaticamente 
      updateAnkiProgress() { 
        const ankiData = this.getModuleData('ciclos_focus_v1'); 
        if (!ankiData) return; 
        
        const today = new Date().toDateString(); 
        if (ankiData.lastUpdated !== today) { 
          // Atualizar o √≠ndice do Anki para o dia atual 
          const totalDecks = ankiData.decks.length; 
          const perDay = ankiData.perDay; 
          const totalBlocks = Math.ceil(totalDecks / perDay); 
          
          // Calcular o √≠ndice baseado na data 
          const startDate = new Date(ankiData.startDate || new Date()); 
          const diffTime = new Date() - startDate; 
          const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)); 
          
          ankiData.blockIndex = diffDays % totalBlocks; 
          ankiData.lastUpdated = today; 
          this.setModuleData('ciclos_focus_v1', ankiData); 
        } 
      } 
      
      // MODIFICAR A FUN√á√ÉO showPendingTasks (substituir a existente) 
      showPendingTasks(hojeStr) { 
        const hoje = new Date(hojeStr + 'T00:00:00'); // Converte para objeto Date 
        const dataFormatada = this.formatDynamicDate(hoje); // Usa formata√ß√£o din√¢mica 
        
        // Buscar dados reais dos m√≥dulos 
        const dailyReviewGoal = this.getModuleData('dailyReviewGoal') || 5; 
        const dailyCompletedReviews = this.getModuleData('dailyCompletedReviews') || 0; 
        
        // Calcular revis√µes para hoje (usando o mesmo algoritmo do m√≥dulo de revis√µes) 
        const revisoesHoje = this.calculateTodayReviews(); 
        
        // Calcular progresso da meta di√°ria 
        const progressoMeta = Math.min((dailyCompletedReviews / dailyReviewGoal) * 100, 100); 
        
        // Verificar alertas 
        const alertas = this.checkAlerts(); 
        
        // Obter mat√©rias do ciclo - COM M√öLTIPLAS MAT√âRIAS 
        const materiasCiclo = this.getTodaySubjects(); 
        
        // CORRE√á√ÉO APLICADA: Obter baralhos do Anki ATUALIZADOS 
        const baralhosAnki = this.getTodayDecks(); 
        
        // Construir o card de resumo pendente com nova formata√ß√£o 
        let summaryHTML = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-calendar-day"></i> 
              <div class="message-card-title">Resumo do Dia - ${dataFormatada}</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-text"> 
                <strong>Ol√°! Aqui est√£o suas tarefas para hoje:</strong> 
              </div> 
        `; 
        
        // MODIFICA√á√ÉO APLICADA: REMOVIDA A SE√á√ÉO DE PROGRESSO DI√ÅRIO
        
        // Revis√µes 
        if (revisoesHoje.length > 0) { 
          summaryHTML += ` 
            <div class="message-section"> 
              <div class="message-section-title">Revis√µes Pendentes</div> 
              <div class="message-list"> 
          `; 
          revisoesHoje.forEach(revisao => { 
            summaryHTML += ` 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-book"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">${revisao.nome}</div> 
                    <div class="message-list-description">${revisao.disciplina}</div> 
                  </div> 
                </div> 
            `; 
          }); 
          summaryHTML += ` 
              </div> 
            </div> 
          `; 
        } else { 
          summaryHTML += ` 
            <div class="message-section"> 
              <div class="message-section-title">Revis√µes Pendentes</div> 
              <div class="message-alert message-alert-info"> 
                <i class="fas fa-info-circle"></i> 
                <div>Nenhuma revis√£o pendente para hoje</div> 
              </div> 
            </div> 
          `; 
        } 
        
        // Mat√©rias - COM M√öLTIPLAS MAT√âRIAS E HIST√ìRICO 
        summaryHTML += ` 
          <div class="message-section"> 
            <div class="message-section-title">Mat√©rias de Hoje</div> 
        `; 
        
        if (materiasCiclo.length > 0) { 
          summaryHTML += `<div class="message-list">`; 
          materiasCiclo.forEach(materia => { 
            // Buscar o progresso salvo para esta mat√©ria 
            const teoriaProgress = this.getModuleData('teoriaProgress'); 
            const ultimoEstudo = teoriaProgress && teoriaProgress[materia]; 
            
            summaryHTML += ` 
              <div class="message-list-item"> 
                <div class="message-list-icon"><i class="fas fa-book"></i></div> 
                <div class="message-list-content"> 
                  <div class="message-list-title">${materia}</div> 
                  ${ultimoEstudo ? ` 
                    <div class="message-list-description"> 
                      √öltimo estudo: ${ultimoEstudo.conteudo} ${ultimoEstudo.pagina ? `(${ultimoEstudo.pagina})` : ''} 
                    </div>` : ` 
                    <div class="message-list-description">Nenhum registro anterior</div>` 
                  } 
                </div> 
              </div> 
            `; 
          }); 
          summaryHTML += `</div>`; 
        } else { 
          summaryHTML += ` 
            <div class="message-alert message-alert-warning"> 
              <i class="fas fa-exclamation-triangle"></i> 
              <div>Nenhuma mat√©ria encontrada no ciclo de estudos ativo</div> 
            </div> 
          `; 
        } 
        
        summaryHTML += `</div>`; 
        
        // Anki - CORRE√á√ÉO APLICADA: Usar baralhos atualizados 
        summaryHTML += ` 
          <div class="message-section"> 
            <div class="message-section-title">Baralhos Anki</div> 
            <div class="message-list"> 
        `; 
        
        if (baralhosAnki.length > 0) { 
          baralhosAnki.forEach(deck => { 
            summaryHTML += ` 
              <div class="message-list-item"> 
                <div class="message-list-icon"><i class="fas fa-layer-group"></i></div> 
                <div class="message-list-content"> 
                  <div class="message-list-title">${deck}</div> 
                </div> 
              </div> 
            `; 
          }); 
        } else { 
          summaryHTML += ` 
            <div class="message-alert message-alert-info"> 
              <i class="fas fa-info-circle"></i> 
              <div>Nenhum baralho programado para hoje</div> 
            </div> 
          `; 
        } 
        
        summaryHTML += ` 
            </div> 
          </div> 
        `; 
        
        // Alertas 
        if (alertas.length > 0) { 
          summaryHTML += ` 
            <div class="message-section"> 
              <div class="message-section-title">Alertas</div> 
          `; 
          alertas.forEach(alerta => { 
            const alertClass = `message-alert-${alerta.tipo === 'alert-danger' ? 'danger' : alerta.tipo === 'alert-warning' ? 'warning' : 'info'}`; 
            summaryHTML += ` 
              <div class="message-alert ${alertClass}"> 
                <i class="fas fa-${alerta.icone}"></i> 
                <div>${alerta.mensagem}</div> 
              </div> 
            `; 
          }); 
          summaryHTML += `</div>`; 
        } 
        
        summaryHTML += ` 
            </div> 
          </div> 
        `; 
        
        this.addBotMessage(summaryHTML, true, 'pending-summary'); 
        
        // Adicionar bot√µes de a√ß√£o 
        setTimeout(() => { 
          this.addBotMessage(` 
            <div class="quick-actions"> 
              <button class="action-btn primary" onclick="chatBot.openRegisterModal()"> 
                <i class="fas fa-plus-circle"></i> Registrar Atividades 
              </button> 
              <button class="action-btn info" onclick="chatBot.showHelp()"> 
                <i class="fas fa-question-circle"></i> Preciso de Ajuda 
              </button> 
            </div> 
          `, false); 
        }, 500); 
      } 
      
      // MODIFICAR A FUN√á√ÉO showTodaySummary (substituir a existente) 
      showTodaySummary(hojeStr) { 
        const hoje = new Date(hojeStr + 'T00:00:00'); // Converte para objeto Date 
        const dataFormatada = this.formatDynamicDate(hoje); // Usa formata√ß√£o din√¢mica 
        
        // Buscar atividades registradas hoje 
        const dailyActivities = JSON.parse(localStorage.getItem('dailyActivities')) || { activities: {} }; 
        const atividades = dailyActivities.activities; 
        
        // Calcular tempo total 
        let totalTime = 0; 
        let totalAnkiDecks = 0; 
        let totalQuestoes = 0;
        let totalTeoria = 0;
        
        if (atividades.questoes && atividades.questoes.length > 0) { 
          atividades.questoes.forEach(q => {
            totalTime += q.tempo;
            totalQuestoes++;
          }); 
        } 
        
        if (atividades.anki && atividades.anki.length > 0) { 
          atividades.anki.forEach(a => { 
            totalTime += a.tempo; 
            totalAnkiDecks++; 
          }); 
        } 
        
        if (atividades.teoria && atividades.teoria.length > 0) { 
          atividades.teoria.forEach(t => {
            totalTime += t.tempo;
            totalTeoria++;
          }); 
        } 
        
        // Calcular horas e minutos 
        const hours = Math.floor(totalTime / 60); 
        const minutes = totalTime % 60; 
        
        let summaryHTML = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-calendar-day"></i> 
              <div class="message-card-title">Resumo do Dia - ${dataFormatada}</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-alert message-alert-success"> 
                <i class="fas fa-check-circle"></i> 
                <div><strong>Parab√©ns! Voc√™ j√° estudou hoje.</strong></div> 
              </div> 
        `; 
        
        // Quest√µes 
        if (atividades.questoes && atividades.questoes.length > 0) { 
          summaryHTML += ` 
            <div class="message-section"> 
              <div class="message-section-title">Quest√µes Realizadas</div> 
              <div class="message-list"> 
          `; 
          atividades.questoes.forEach(q => { 
            const acertos = q.feitas - q.erradas; 
            const taxaAcerto = q.feitas > 0 ? Math.round((acertos / q.feitas) * 100) : 0; 
            
            summaryHTML += ` 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">${q.assunto}</div> 
                    <div class="message-list-description">${q.feitas} quest√µes ‚Ä¢ ${taxaAcerto}% de acerto ‚Ä¢ ${q.tempo} min</div> 
                  </div> 
                </div> 
            `; 
          }); 
          summaryHTML += ` 
              </div> 
            </div> 
          `; 
        } 
        
        // Anki 
        if (atividades.anki && atividades.anki.length > 0) { 
          summaryHTML += ` 
            <div class="message-section"> 
              <div class="message-section-title">Revis√µes Anki</div> 
              <div class="message-list"> 
          `; 
          atividades.anki.forEach(a => { 
            summaryHTML += ` 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">${a.deck}</div> 
                    <div class="message-list-description">${a.cards} cards revisados ‚Ä¢ ${a.tempo} min</div> 
                  </div> 
                </div> 
            `; 
          }); 
          summaryHTML += ` 
              </div> 
            </div> 
          `; 
        } 
        
        // Teoria 
        if (atividades.teoria && atividades.teoria.length > 0) { 
          summaryHTML += ` 
            <div class="message-section"> 
              <div class="message-section-title">Estudo Te√≥rico</div> 
              <div class="message-list"> 
          `; 
          atividades.teoria.forEach(t => { 
            summaryHTML += ` 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">${t.materia}</div> 
                    <div class="message-list-description">${t.conteudo || t.pagina || 'Estudo conclu√≠do'} ‚Ä¢ ${t.tempo} min</div> 
                  </div> 
                </div> 
            `; 
          }); 
          summaryHTML += ` 
              </div> 
            </div> 
          `; 
        } 
        
        // Resumo final - MODIFICA√á√ÉO APLICADA: EXPANDIR PARA M√öLTIPLOS BLOCOS
        summaryHTML += ` 
              <div class="message-divider"></div> 
              <div class="message-stats"> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${hours}h ${minutes}m</div> 
                  <div class="message-stat-label">Tempo Total</div> 
                </div> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${totalAnkiDecks}</div> 
                  <div class="message-stat-label">Baralhos Revisados</div> 
                </div> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${totalQuestoes}</div> 
                  <div class="message-stat-label">Blocos de Quest√µes</div> 
                </div> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${totalTeoria}</div> 
                  <div class="message-stat-label">Estudos Te√≥ricos</div> 
                </div> 
              </div> 
              <div class="message-alert message-alert-info"> 
                <i class="fas fa-info-circle"></i> 
                <div><strong>Volte amanh√£ para novas atividades!</strong></div> 
              </div> 
        `; 
        
        summaryHTML += ` 
            </div> 
          </div> 
        `; 
        
        this.addBotMessage(summaryHTML, true, 'today-summary'); 
        
        // N√£o mostrar bot√£o de registrar, pois j√° registrou hoje 
        setTimeout(() => { 
          this.addBotMessage(` 
            <div class="quick-actions"> 
              <button class="action-btn info" onclick="chatBot.showHelp()"> 
                <i class="fas fa-question-circle"></i> Preciso de Ajuda 
              </button> 
            </div> 
          `, false); 
        }, 500); 
      } 
      
      // MODIFICAR A FUN√á√ÉO openRegisterModal (substituir a existente) 
      openRegisterModal() { 
        const hojeStr = this.getDynamicDateString(); // SEMPRE usa data atual 
        
        // CORRE√á√ÉO APLICADA: Verificar se j√° registrou HOJE usando a nova fun√ß√£o 
        if (this.hasStudiedToday()) { 
          this.typeMessage("Voc√™ j√° registrou suas atividades hoje! üòä\n\nSe quiser ver o resumo do que foi feito, pe√ßa o <strong>resumo do dia</strong>."); 
          return; 
        } 
        
        document.getElementById('registerModal').style.display = 'flex'; 
        this.loadTodayTasks(); 
      } 
      
      // MODIFICAR A FUN√á√ÉO addDateDivider (substituir a existente) 
      addDateDivider() { 
        const hoje = this.getDynamicDateObject(); // SEMPRE usa data atual 
        const dataFormatada = this.formatDynamicDate(hoje); 
        
        const chatMessages = document.getElementById('chatMessages'); 
        const dateDiv = document.createElement('div'); 
        dateDiv.className = 'chat-date'; 
        dateDiv.innerHTML = `<span>${dataFormatada}</span>`; 
        chatMessages.appendChild(dateDiv); 
      } 
      
      // Modal de configura√ß√£o 
      showConfigModal() { 
        document.getElementById('configModal').style.display = 'flex'; 
        document.getElementById('materiasPorDia').value = this.materiasPorDia; 
      } 
      
      closeConfigModal() { 
        document.getElementById('configModal').style.display = 'none'; 
      } 
      
      saveConfig() { 
        const materiasPorDia = parseInt(document.getElementById('materiasPorDia').value); 
        if (materiasPorDia >= 1 && materiasPorDia <= 5) { 
          this.materiasPorDia = materiasPorDia; 
          localStorage.setItem('studyFlow_materiasPorDia', materiasPorDia.toString()); 
          this.closeConfigModal(); 
          this.typeMessage(`Configura√ß√£o salva! Agora voc√™ ver√° ${materiasPorDia} mat√©ria(s) por dia.`); 
        } else { 
          alert('Por favor, informe um n√∫mero entre 1 e 5.'); 
        } 
      } 
      
      // CORRE√á√ÉO APLICADA: Fun√ß√£o para obter baralhos do Anki atualizados 
      getTodayDecks() { 
        const ankiData = this.getModuleData('ciclos_focus_v1'); 
        if (!ankiData || !ankiData.decks || !ankiData.perDay) return []; 
        
        const perDay = ankiData.perDay; 
        const blockIndex = ankiData.blockIndex || 0; 
        
        // Calcular os baralhos do dia atual baseado no blockIndex atual 
        const startIndex = blockIndex * perDay; 
        const todayDecks = ankiData.decks.slice(startIndex, startIndex + perDay); 
        
        // Retornar apenas os nomes dos baralhos 
        return todayDecks.map(deck => deck.name); 
      } 
      
      // CORRE√á√ÉO APLICADA: Fun√ß√£o para obter tarefas do dia atualizada 
      getTodayTasks() { 
        const hoje = new Date(); 
        const hojeStr = hoje.toISOString().split('T')[0]; 
        
        const tasks = { 
          questoes: [], 
          anki: [], 
          teoria: [] 
        }; 
        
        // Buscar assuntos para quest√µes de hoje (revis√£o) - APENAS AS DO DIA 
        tasks.questoes = this.calculateTodayReviews(); 
        
        // CORRE√á√ÉO APLICADA: Buscar baralhos do Anki para hoje (atualizados) 
        tasks.anki = this.getTodayDecks().map(deckName => ({ 
          id: deckName, 
          nome: deckName, 
          emoji: 'üîÅ' 
        })); 
        
        // Buscar mat√©rias de teoria para hoje (ciclo te√≥rico) - COM M√öLTIPLAS MAT√âRIAS 
        const activeCycle = this.getActiveCycle(); 
        if (activeCycle && activeCycle.generatedCycle) { 
          // Obter as pr√≥ximas mat√©rias baseado na configura√ß√£o 
          tasks.teoria = this.getTodaySubjects(); 
        } 
        
        return tasks; 
      } 
      
      // CORRE√á√ÉO CR√çTICA: Fun√ß√£o para ativar/desativar tarefas no modal 
      activateTask(button) { 
        const card = button.closest('.task-card'); 
        
        // Alternar entre os estados disabled e active
        if (card.classList.contains('disabled')) {
          card.classList.remove('disabled');
          card.classList.add('active');
          
          // Habilitar todos os inputs dentro do card
          const inputs = card.querySelectorAll('input');
          inputs.forEach(input => {
            input.disabled = false;
          });
        } else {
          card.classList.remove('active');
          card.classList.add('disabled');
          
          // Desabilitar todos os inputs dentro do card
          const inputs = card.querySelectorAll('input');
          inputs.forEach(input => {
            input.disabled = true;
          });
        }
      }
      
      // MODIFICAR A FUN√á√ÉO loadTodayTasks (substituir a existente) 
      loadTodayTasks() { 
        const modalBody = document.getElementById('registerModalBody'); 
        modalBody.innerHTML = ''; 
        
        const todayTasks = this.getTodayTasks(); 
        
        if (todayTasks.questoes.length === 0 && todayTasks.anki.length === 0 && todayTasks.teoria.length === 0) { 
          modalBody.innerHTML = ` 
            <div class="empty-state"> 
              <i class="fas fa-check-circle"></i> 
              <h3>N√£o h√° tarefas pendentes para hoje!</h3> 
              <p>Parab√©ns! Voc√™ j√° concluiu todas as tarefas de hoje ou n√£o h√° atividades programadas.</p> 
            </div> 
          `; 
          return; 
        } 
        
        let tasksHTML = '<div class="tasks-grid">'; 
        
        // Adicionar cards para quest√µes (apenas as do dia) 
        todayTasks.questoes.forEach(questao => { 
          tasksHTML += this.createQuestaoCard(questao); 
        }); 
        
        // Adicionar cards para Anki 
        todayTasks.anki.forEach(deck => { 
          tasksHTML += this.createAnkiCard(deck); 
        }); 
        
        // Adicionar cards para teoria - COM M√öLTIPLAS MAT√âRIAS 
        todayTasks.teoria.forEach(materia => { 
          tasksHTML += this.createTeoriaCard(materia); 
        }); 
        
        tasksHTML += '</div>'; 
        modalBody.innerHTML = tasksHTML; 
      } 
      
      createQuestaoCard(questao) { 
        return ` 
          <div class="task-card disabled" data-type="questoes" data-id="${questao.id}"> 
            <div class="task-header"> 
              <div class="task-icon-large">üß©</div> 
              <div class="task-title">Quest√µes: ${questao.disciplina}</div> 
              <button class="activate-btn" onclick="chatBot.activateTask(this)">Ativar</button> 
            </div> 
            <div class="task-description"> 
              <strong>Assunto:</strong> ${questao.nome} 
            </div> 
            <div class="task-form"> 
              <div class="form-group"> 
                <label for="questoes-feitas-${questao.id}">Quantidade de quest√µes feitas</label> 
                <input type="number" id="questoes-feitas-${questao.id}" min="0" placeholder="Ex: 20" disabled> 
              </div> 
              <div class="form-group"> 
                <label for="questoes-erradas-${questao.id}">Quantidade de quest√µes erradas</label> 
                <input type="number" id="questoes-erradas-${questao.id}" min="0" placeholder="Ex: 5" disabled> 
              </div> 
              <div class="form-group"> 
                <label for="questoes-tempo-${questao.id}">Tempo total gasto (minutos)</label> 
                <input type="number" id="questoes-tempo-${questao.id}" min="0" placeholder="Ex: 45" disabled> 
              </div> 
            </div> 
          </div> 
        `; 
      } 
      
      createAnkiCard(deck) { 
        return ` 
          <div class="task-card disabled" data-type="anki" data-id="${deck.id}"> 
            <div class="task-header"> 
              <div class="task-icon-large">${deck.emoji}</div> 
              <div class="task-title">Revis√£o Anki</div> 
              <button class="activate-btn" onclick="chatBot.activateTask(this)">Ativar</button> 
            </div> 
            <div class="task-description"> 
              <strong>Baralho:</strong> ${deck.nome} 
            </div> 
            <div class="task-form"> 
              <div class="form-group"> 
                <label for="anki-tempo-${deck.id}">Tempo de estudo (minutos)</label> 
                <input type="number" id="anki-tempo-${deck.id}" min="0" placeholder="Ex: 30" disabled> 
              </div> 
              <div class="form-group"> 
                <label for="anki-cards-${deck.id}">Quantidade de cards revisados</label> 
                <input type="number" id="anki-cards-${deck.id}" min="0" placeholder="Ex: 50" disabled> 
              </div> 
            </div> 
          </div> 
        `; 
      } 
      
      createTeoriaCard(materia) { 
        return ` 
          <div class="task-card disabled" data-type="teoria" data-id="${materia}"> 
            <div class="task-header"> 
              <div class="task-icon-large">üìö</div> 
              <div class="task-title">Estudo Te√≥rico</div> 
              <button class="activate-btn" onclick="chatBot.activateTask(this)">Ativar</button> 
            </div> 
            <div class="task-description"> 
              <strong>Mat√©ria:</strong> ${materia} 
            </div> 
            <div class="task-form"> 
              <div class="form-group"> 
                <label for="teoria-conteudo-${materia}">Conte√∫do estudado (PDF/Aula)</label> 
                <input type="text" id="teoria-conteudo-${materia}" placeholder="Ex: PDF Aula 1, Video Aula 2" disabled> 
              </div> 
              <div class="form-group"> 
                <label for="teoria-pagina-${materia}">P√°gina/Progresso</label> 
                <input type="text" id="teoria-pagina-${materia}" placeholder="Ex: P√°gina 42, 50% conclu√≠do" disabled> 
              </div> 
              <div class="form-group"> 
                <label for="teoria-tempo-${materia}">Tempo de estudo (minutos)</label> 
                <input type="number" id="teoria-tempo-${materia}" min="0" placeholder="Ex: 60" disabled> 
              </div> 
            </div> 
          </div> 
        `; 
      } 
      
      // NOVA FUN√á√ÉO: Salvar apenas as tarefas selecionadas 
      saveSelectedTasks() { 
        const activeCards = document.querySelectorAll('.task-card.active'); 
        let hasError = false; 
        let savedCount = 0; 
        let totalTime = 0; 
        let activities = { 
          questoes: [], 
          anki: [], 
          teoria: [] 
        }; 
        
        if (activeCards.length === 0) { 
          alert('Por favor, selecione pelo menos uma atividade para registrar.'); 
          return; 
        } 
        
        activeCards.forEach(card => { 
          const type = card.getAttribute('data-type'); 
          const id = card.getAttribute('data-id'); 
          
          if (type === 'questoes') { 
            const feitas = document.getElementById(`questoes-feitas-${id}`).value; 
            const erradas = document.getElementById(`questoes-erradas-${id}`).value; 
            const tempo = document.getElementById(`questoes-tempo-${id}`).value; 
            
            if (!feitas || !tempo) { 
              hasError = true; 
              card.style.border = '1px solid red'; 
            } else { 
              card.style.border = ''; 
              this.saveQuestoes(id, feitas, erradas, tempo); 
              savedCount++; 
              totalTime += parseInt(tempo); 
              activities.questoes.push({ 
                assunto: id, 
                feitas: parseInt(feitas), 
                erradas: parseInt(erradas), 
                tempo: parseInt(tempo) 
              }); 
            } 
          } else if (type === 'anki') { 
            const tempo = document.getElementById(`anki-tempo-${id}`).value; 
            const cards = document.getElementById(`anki-cards-${id}`).value; 
            
            if (!tempo || !cards) { 
              hasError = true; 
              card.style.border = '1px solid red'; 
            } else { 
              card.style.border = ''; 
              this.saveAnki(id, tempo, cards); 
              savedCount++; 
              totalTime += parseInt(tempo); 
              activities.anki.push({ 
                deck: id, 
                tempo: parseInt(tempo), 
                cards: parseInt(cards) 
              }); 
            } 
          } else if (type === 'teoria') { 
            const conteudo = document.getElementById(`teoria-conteudo-${id}`).value; 
            const pagina = document.getElementById(`teoria-pagina-${id}`).value; 
            const tempo = document.getElementById(`teoria-tempo-${id}`).value; 
            
            if (!tempo) { 
              hasError = true; 
              card.style.border = '1px solid red'; 
            } else { 
              card.style.border = ''; 
              this.saveTeoria(id, conteudo, pagina, tempo); 
              savedCount++; 
              totalTime += parseInt(tempo); 
              activities.teoria.push({ 
                materia: id, 
                conteudo: conteudo, 
                pagina: pagina, 
                tempo: parseInt(tempo) 
              }); 
            } 
          } 
        }); 
        
        if (hasError) { 
          alert('Preencha todos os campos obrigat√≥rios das atividades selecionadas!'); 
          return; 
        } 
        
        // Salvar a data do √∫ltimo registro 
        const hoje = new Date(); 
        const hojeStr = hoje.toISOString().split('T')[0]; 
        localStorage.setItem('lastRegisterDate', hojeStr); 
        
        // Salvar as atividades do dia 
        const dailyActivities = { 
          date: hojeStr, 
          activities: activities 
        }; 
        localStorage.setItem('dailyActivities', JSON.stringify(dailyActivities)); 
        
        this.closeRegisterModal(); 
        
        if (savedCount > 0) { 
          this.showRegistrationSummary(savedCount, totalTime, activities); 
        } 
      } 
      
      showRegistrationSummary(savedCount, totalTime, activities) { 
        // Mensagem de sucesso destacada 
        const successMessage = ` 
          <div class="message-bubble bot-bubble message-alert-success"> 
            <div class="message-content"> 
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px"> 
                <i class="fas fa-check-circle" style="color: var(--success)"></i> 
                <strong>${savedCount} atividade(s) registrada(s) com sucesso!</strong> 
              </div> 
              <div class="message-text"> 
                Seu progresso foi salvo e suas pr√≥ximas revis√µes foram atualizadas. 
              </div> 
            </div> 
            <div class="bubble-time">${this.formatTime(new Date())}</div> 
          </div> 
        `; 
        
        // Adicionar a mensagem de sucesso 
        const chatMessages = document.getElementById('chatMessages'); 
        const messageContainer = document.createElement('div'); 
        messageContainer.className = 'message-container bot-container'; 
        const avatar = document.createElement('div'); 
        avatar.className = 'avatar bot-avatar-small'; 
        avatar.innerHTML = '<i class="fas fa-robot"></i>'; 
        messageContainer.appendChild(avatar); 
        messageContainer.innerHTML = successMessage; 
        chatMessages.appendChild(messageContainer); 
        chatMessages.scrollTop = chatMessages.scrollHeight; 
        
        setTimeout(() => { 
          let summaryHTML = ` 
            <div class="message-card"> 
              <div class="message-card-header"> 
                <i class="fas fa-chart-bar"></i> 
                <div class="message-card-title">Resumo das Atividades de Hoje</div> 
              </div> 
              <div class="message-card-content"> 
          `; 
          
          // Adicionar quest√µes 
          if (activities.questoes.length > 0) { 
            summaryHTML += `<div class="message-section-title">üß© Quest√µes</div>`; 
            activities.questoes.forEach(q => { 
              const acertos = q.feitas - q.erradas; 
              const taxaAcerto = q.feitas > 0 ? Math.round((acertos / q.feitas) * 100) : 0; 
              
              summaryHTML += ` 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">${q.assunto}</div> 
                    <div class="message-list-description">${q.feitas} quest√µes (${taxaAcerto}% acerto)</div> 
                  </div> 
                </div> 
              `; 
            }); 
          } 
          
          // Adicionar Anki 
          if (activities.anki.length > 0) { 
            summaryHTML += `<div class="message-section-title">üîÅ Anki</div>`; 
            activities.anki.forEach(a => { 
              summaryHTML += ` 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">${a.deck}</div> 
                    <div class="message-list-description">${a.cards} cards revisados</div> 
                  </div> 
                </div> 
              `; 
            }); 
          } 
          
          // Adicionar teoria 
          if (activities.teoria.length > 0) { 
            summaryHTML += `<div class="message-section-title">üìö Teoria</div>`; 
            activities.teoria.forEach(t => { 
              summaryHTML += ` 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">${t.materia}</div> 
                    <div class="message-list-description">${t.conteudo || t.pagina || 'Estudo'}</div> 
                  </div> 
                </div> 
              `; 
            }); 
          } 
          
          // Total 
          summaryHTML += ` 
                <div class="message-divider"></div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-clock"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Tempo Total</div> 
                    <div class="message-list-description">${totalTime} minutos</div> 
                  </div> 
                </div> 
          `; 
          
          summaryHTML += `</div></div>`; 
          this.addBotMessage(summaryHTML, false); 
          
          setTimeout(() => { 
            // Mostrar pr√≥ximas datas de revis√£o 
            const nextReviews = this.getNextReviewDates(); 
            if (nextReviews.length > 0) { 
              let nextReviewsHTML = ` 
                <div class="message-card"> 
                  <div class="message-card-header"> 
                    <i class="fas fa-calendar-alt"></i> 
                    <div class="message-card-title">Pr√≥ximas Revis√µes</div> 
                  </div> 
                  <div class="message-card-content"> 
              `; 
              
              nextReviews.forEach(review => { 
                nextReviewsHTML += ` 
                  <div class="message-list-item"> 
                    <div class="message-list-icon"><i class="fas fa-calendar-day"></i></div> 
                    <div class="message-list-content"> 
                      <div class="message-list-title">${review.assunto}</div> 
                      <div class="message-list-description">${review.data}</div> 
                    </div> 
                  </div> 
                `; 
              }); 
              
              nextReviewsHTML += `</div></div>`; 
              this.addBotMessage(nextReviewsHTML, false); 
            } 
          }, 500); 
        }, 500); 
      } 
      
      getNextReviewDates() { 
        const disciplines = this.getModuleData('disciplines'); 
        const nextReviews = []; 
        const hoje = new Date(); 
        
        if (disciplines && Array.isArray(disciplines)) { 
          disciplines.forEach(disciplina => { 
            if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) { 
              disciplina.assuntos.forEach(assunto => { 
                if (assunto.nextReviewDate) { 
                  const nextDate = new Date(assunto.nextReviewDate); 
                  if (nextDate > hoje) { 
                    nextReviews.push({ 
                      assunto: assunto.nome, 
                      disciplina: disciplina.name, 
                      data: nextDate.toLocaleDateString('pt-BR') 
                    }); 
                  } 
                } 
              }); 
            } 
          }); 
        } 
        
        // Ordenar por data e pegar as 3 mais pr√≥ximas 
        return nextReviews 
          .sort((a, b) => new Date(a.data) - new Date(b.data)) 
          .slice(0, 3); 
      } 
      
      // Fun√ß√µes de utilit√°rio 
      toggleTheme() { 
        if (this.currentTheme === 'light') { 
          document.body.classList.add('dark-theme'); 
          document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>'; 
          this.currentTheme = 'dark'; 
        } else { 
          document.body.classList.remove('dark-theme'); 
          document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>'; 
          this.currentTheme = 'light'; 
        } 
        localStorage.setItem('theme', this.currentTheme); 
      } 
      
      addUserMessage(content) { 
        this.addMessageToChat(content, true); 
      } 
      
      // Buscar ciclo ativo de forma robusta 
      getActiveCycle() { 
        // Tentar diferentes chaves poss√≠veis para o ciclo ativo 
        const possibleKeys = [ 
          'StudyFlow_activeCycle', 
          'StudyFlow_allCycles', 
          'activeCycle', 
          'StudyFlow_cycle', 
          'currentCycle' 
        ]; 
        
        for (const key of possibleKeys) { 
          const data = this.getModuleData(key); 
          if (data) { 
            // Se for um array (como StudyFlow_allCycles), pegar o primeiro ciclo 
            if (Array.isArray(data) && data.length > 0) { 
              const cycle = data[0]; 
              if (cycle && cycle.generatedCycle && Array.isArray(cycle.generatedCycle)) { 
                return cycle; 
              } 
            } 
            // Se for um objeto direto 
            else if (data.generatedCycle && Array.isArray(data.generatedCycle)) { 
              return data; 
            } 
          } 
        } 
        
        // Se n√£o encontrou, tentar buscar em todas as chaves do localStorage 
        for (let i = 0; i < localStorage.length; i++) { 
          const key = localStorage.key(i); 
          if (key && (key.includes('cycle') || key.includes('Cycle') || key.includes('CYCLE'))) { 
            try { 
              const data = JSON.parse(localStorage.getItem(key)); 
              if (data) { 
                // Se for um array, pegar o primeiro item 
                if (Array.isArray(data) && data.length > 0) { 
                  const cycle = data[0]; 
                  if (cycle && cycle.generatedCycle && Array.isArray(cycle.generatedCycle)) { 
                    return cycle; 
                  } 
                } 
                // Se for um objeto direto 
                else if (data.generatedCycle && Array.isArray(data.generatedCycle)) { 
                  return data; 
                } 
              } 
            } catch (e) { 
              // Ignorar chaves que n√£o s√£o JSON v√°lido 
            } 
          } 
        } 
        
        return null; 
      } 
      
      // Fun√ß√µes de integra√ß√£o com m√≥dulos 
      getModuleData(key) { 
        try { 
          const data = localStorage.getItem(key); 
          return data ? JSON.parse(data) : null; 
        } catch (e) { 
          console.error(`Erro ao carregar dados do m√≥dulo: ${key}`, e); 
          return null; 
        } 
      } 
      
      setModuleData(key, data) { 
        try { 
          localStorage.setItem(key, JSON.stringify(data)); 
          return true; 
        } catch (e) { 
          console.error(`Erro ao salvar dados no m√≥dulo: ${key}`, e); 
          return false; 
        } 
      } 
      
      // ALGORITMO DE PRIORIZA√á√ÉO ID√äNTICO AO M√ìDULO DE REVIS√ïES 
      calculateTodayReviews() { 
        const disciplines = this.getModuleData('disciplines'); 
        const dailyReviewGoal = this.getModuleData('dailyReviewGoal') || 5; 
        
        if (!disciplines || !Array.isArray(disciplines)) return []; 
        
        const hoje = new Date(); 
        const todayTimestamp = hoje.getTime(); 
        
        let pendingTopics = []; 
        
        // Fase 1: Coletar todos os assuntos pendentes 
        disciplines.forEach(disciplina => { 
          if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) { 
            disciplina.assuntos.forEach(assunto => { 
              // Ignorar assuntos suspensos 
              if (assunto.suspended) return; 
              
              // Verificar se est√° na data de revis√£o ou atrasado 
              if (assunto.nextReviewDate && assunto.nextReviewDate <= todayTimestamp) { 
                // Calcular dias de atraso 
                const daysOverdue = Math.max(0, Math.floor((todayTimestamp - assunto.nextReviewDate) / (1000 * 60 * 60 * 24))); 
                
                // Calcular dificuldade m√©dia (invertida: maior dificuldade = maior prioridade) 
                let avgDifficulty = 2; // padr√£o 
                if (assunto.difficultyHistory && assunto.difficultyHistory.length > 0) { 
                  avgDifficulty = assunto.difficultyHistory.reduce((a, b) => a + b, 0) / assunto.difficultyHistory.length; 
                } 
                const difficultyScore = (3 - avgDifficulty); // Inverte a escala 
                
                // Obter import√¢ncia 
                const importance = assunto.importance || 3; 
                
                // Calcular prioridade (mesma f√≥rmula do m√≥dulo de revis√µes) 
                const priority = (difficultyScore * 40) + (daysOverdue * 60) + (importance * 20); 
                
                pendingTopics.push({ 
                  id: assunto.nome, 
                  nome: assunto.nome, 
                  disciplina: disciplina.name, 
                  priority: priority, 
                  daysOverdue: daysOverdue, 
                  difficulty: avgDifficulty, 
                  importance: importance 
                }); 
              } 
            }); 
          } 
        }); 
        
        // Fase 2: Ordenar por prioridade (decrescente) 
        pendingTopics.sort((a, b) => b.priority - a.priority); 
        
        // Fase 3: Limitar pela meta di√°ria 
        return pendingTopics.slice(0, dailyReviewGoal); 
      } 
      
      calculateOverdueReviews() { 
        const disciplines = this.getModuleData('disciplines'); 
        if (!disciplines || !Array.isArray(disciplines)) return 0; 
        
        const hoje = new Date(); 
        const todayTimestamp = hoje.getTime(); 
        
        let atrasadas = 0; 
        
        disciplines.forEach(disciplina => { 
          if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) { 
            disciplina.assuntos.forEach(assunto => { 
              if (assunto.nextReviewDate && assunto.nextReviewDate < todayTimestamp && !assunto.suspended) { 
                atrasadas++; 
              } 
            }); 
          } 
        }); 
        
        return atrasadas; 
      } 
      
      // FUN√á√ÉO MELHORADA: Agora retorna m√∫ltiplas mat√©rias baseado na configura√ß√£o 
      getTodaySubjects() { 
        const activeCycle = this.getActiveCycle(); 
        if (!activeCycle || !activeCycle.generatedCycle) { 
          return []; 
        } 
        
        const todayIndex = activeCycle.currentDay || 0; 
        const materiasPorDia = this.materiasPorDia || 1; 
        
        let subjects = []; 
        const cycleLength = activeCycle.generatedCycle.length; 
        
        if (cycleLength === 0) { 
          return []; 
        } 
        
        // Ajustar o √≠ndice para estar dentro dos limites 
        const adjustedIndex = todayIndex % cycleLength; 
        
        // Pegar as pr√≥ximas mat√©rias baseado na configura√ß√£o 
        for (let i = 0; i < materiasPorDia; i++) { 
          const index = (adjustedIndex + i) % cycleLength; 
          let subject = activeCycle.generatedCycle[index]; 
          
          // Se o subject for um array (m√∫ltiplas mat√©rias no mesmo dia), junt√°-las 
          if (Array.isArray(subject)) { 
            subject = subject.join(', '); 
          } 
          
          // Ignorar revis√µes e simulados na contagem 
          if (subject && !subject.includes('Revis√£o') && !subject.includes('Simulado')) { 
            subjects.push(subject); 
          } 
        } 
        
        return subjects; 
      } 
      
      saveQuestoes(assuntoId, feitas, erradas, tempo) { 
        const corretas = parseInt(feitas) - parseInt(erradas); 
        const dificuldade = 2; // Valor padr√£o (Bom) - poderia ser capturado do usu√°rio 
        
        // Atualizar m√≥dulo de revis√µes 
        const revisaoAtualizada = this.updateReviewModule(assuntoId, feitas, corretas, tempo, dificuldade); 
        
        if (revisaoAtualizada) { 
          // Atualizar m√≥dulo home (mantendo o funcionamento atual) 
          let dailyCompletedReviews = this.getModuleData('dailyCompletedReviews') || 0; 
          dailyCompletedReviews += 1; 
          this.setModuleData('dailyCompletedReviews', dailyCompletedReviews); 
          
          const hoje = new Date(); 
          this.setModuleData('lastReviewDate', hoje.toISOString().split('T')[0]); 
          
          this.registerHomeSession(`Quest√µes - ${assuntoId}`, parseInt(tempo)); 
          localStorage.setItem('ultimoEstudo', new Date().toISOString()); 
        } 
      } 
      
      saveTeoria(materiaId, conteudo, pagina, tempo) { 
        // Atualizar ciclo de estudos 
        const cicloAtualizado = this.updateStudyCycle(materiaId, tempo); 
        
        if (cicloAtualizado) { 
          // Registrar sess√£o no m√≥dulo Home (mantendo o funcionamento atual) 
          this.registerHomeSession(`Teoria - ${materiaId}`, parseInt(tempo)); 
          
          // Salvar progresso da teoria 
          const teoriaProgress = this.getModuleData('teoriaProgress') || {}; 
          teoriaProgress[materiaId] = { 
            conteudo: conteudo, 
            pagina: pagina, 
            ultimaAtualizacao: new Date().toISOString() 
          }; 
          this.setModuleData('teoriaProgress', teoriaProgress); 
          
          localStorage.setItem('ultimoEstudo', new Date().toISOString()); 
        } 
      } 
      
      saveAnki(deckId, tempo, cards) { 
        // Registrar sess√£o no m√≥dulo Home 
        const ankiData = this.getModuleData('ciclos_focus_v1'); 
        const deck = ankiData && ankiData.decks ? ankiData.decks.find(d => d.id === deckId) : null; 
        const deckNome = deck ? deck.name : deckId; 
        
        this.registerHomeSession(`Anki - ${deckNome}`, parseInt(tempo)); 
        
        // Atualizar √∫ltimo estudo 
        localStorage.setItem('ultimoEstudo', new Date().toISOString()); 
      } 
      
      // Fun√ß√£o para atualizar o m√≥dulo de revis√µes (quest√µes) 
      updateReviewModule(assuntoId, feitas, corretas, tempo, dificuldade) { 
        const disciplines = this.getModuleData('disciplines') || []; 
        const hoje = new Date().getTime(); 
        
        // Encontrar o assunto espec√≠fico 
        let assuntoEncontrado = null; 
        let disciplinaEncontrada = null; 
        
        for (const disciplina of disciplines) { 
          if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) { 
            for (const assunto of disciplina.assuntos) { 
              if (assunto.nome === assuntoId) { 
                assuntoEncontrado = assunto; 
                disciplinaEncontrada = disciplina; 
                break; 
              } 
            } 
            if (assuntoEncontrado) break; 
          } 
        } 
        
        if (assuntoEncontrado) { 
          // Atualizar estat√≠sticas 
          assuntoEncontrado.questions = (assuntoEncontrado.questions || 0) + parseInt(feitas); 
          assuntoEncontrado.correct = (assuntoEncontrado.correct || 0) + parseInt(corretas); 
          assuntoEncontrado.incorrect = (assuntoEncontrado.incorrect || 0) + (parseInt(feitas) - parseInt(corretas)); 
          
          // Adicionar dificuldade ao hist√≥rico 
          if (!assuntoEncontrado.difficultyHistory) { 
            assuntoEncontrado.difficultyHistory = []; 
          } 
          assuntoEncontrado.difficultyHistory.push(parseInt(dificuldade)); 
          
          // Calcular acur√°cia 
          const accuracy = (parseInt(corretas) / parseInt(feitas)) * 100; 
          
          // Determinar o m√©todo de revis√£o 
          if (assuntoEncontrado.reviewMethod === 'fixed') { 
            // Revis√£o por desempenho - usar a fun√ß√£o do m√≥dulo de revis√µes 
            const interval = this.getPerformanceBasedInterval(accuracy); 
            assuntoEncontrado.interval = interval; 
            assuntoEncontrado.repetitions = (assuntoEncontrado.repetitions || 0) + 1; 
          } else { 
            // SM-2 - usar a fun√ß√£o do m√≥dulo de revis√µes 
            const result = this.calculateNextReviewSM2( 
              parseInt(dificuldade), 
              assuntoEncontrado.easeFactor || 2.5, 
              assuntoEncontrado.interval || 1, 
              assuntoEncontrado.repetitions || 0 
            ); 
            assuntoEncontrado.easeFactor = result.newEF; 
            assuntoEncontrado.interval = result.newInterval; 
            assuntoEncontrado.repetitions = result.repetitions; 
          } 
          
          // Atualizar datas 
          assuntoEncontrado.lastReviewed = hoje; 
          
          // Calcular pr√≥xima data de revis√£o 
          const nextReviewDate = new Date(hoje); 
          nextReviewDate.setDate(nextReviewDate.getDate() + assuntoEncontrado.interval); 
          assuntoEncontrado.nextReviewDate = nextReviewDate.getTime(); 
          
          // Calcular for√ßa da mem√≥ria 
          assuntoEncontrado.memoryStrength = this.calculateMemoryStrength(assuntoEncontrado); 
          
          // Salvar de volta no localStorage 
          this.setModuleData('disciplines', disciplines); 
          return true; 
        } else { 
          return false; 
        } 
      } 
      
      // Fun√ß√£o para atualizar o ciclo de estudos (mat√©rias te√≥ricas) 
      updateStudyCycle(materiaId, tempo) { 
        const activeCycle = this.getActiveCycle(); 
        const hoje = new Date().toISOString().split('T')[0]; // Data no formato YYYY-MM-DD 
        
        if (activeCycle && activeCycle.generatedCycle) { 
          const todayIndex = activeCycle.currentDay || 0; 
          const cycleLength = activeCycle.generatedCycle.length; 
          
          // Encontrar a mat√©ria no ciclo atual 
          let materiaEncontrada = activeCycle.generatedCycle[todayIndex % cycleLength]; 
          
          // Se for um array (m√∫ltiplas mat√©rias no mesmo dia), verificar se a mat√©ria est√° presente 
          if (Array.isArray(materiaEncontrada)) { 
            if (materiaEncontrada.includes(materiaId)) { 
              materiaEncontrada = materiaId; 
            } else { 
              materiaEncontrada = null; 
            } 
          } else { 
            if (materiaEncontrada !== materiaId) { 
              materiaEncontrada = null; 
            } 
          } 
          
          if (materiaEncontrada) { 
            // Marcar como estudada no dia atual 
            if (!activeCycle.completedSubjects) { 
              activeCycle.completedSubjects = {}; 
            } 
            activeCycle.completedSubjects[todayIndex] = true; 
            
            // Avan√ßar para o pr√≥ximo dia apenas se ainda n√£o avan√ßou hoje 
            if (activeCycle.lastAdvanced !== hoje) { 
              activeCycle.currentDay = (todayIndex + 1) % cycleLength; 
              activeCycle.lastAdvanced = hoje; 
            } 
            
            // Atualizar estat√≠sticas de progresso 
            if (!activeCycle.studyTime) { 
              activeCycle.studyTime = {}; 
            } 
            // Usar a data como chave para o tempo de estudo 
            activeCycle.studyTime[hoje] = (activeCycle.studyTime[hoje] || 0) + parseInt(tempo); 
            
            // Salvar de volta 
            this.setModuleData('StudyFlow_activeCycle', activeCycle); 
            return true; 
          } 
        } 
        return false; 
      } 
      
      // Fun√ß√£o para calcular intervalo baseado em desempenho 
      getPerformanceBasedInterval(accuracy) { 
        accuracy = Math.max(0, Math.min(100, accuracy)); 
        
        if (accuracy >= 100) return 30; 
        if (accuracy >= 80) return 25; 
        if (accuracy >= 60) return 15; 
        if (accuracy >= 40) return 7; 
        return 3; 
      } 
      
      // Algoritmo SM-2 
      calculateNextReviewSM2(q, currentEF, currentInterval, repetitions) { 
        let newEF = currentEF + (0.1 - (3 - q) * (0.08 + (3 - q) * 0.02)); 
        newEF = Math.max(1.3, Math.min(newEF, 2.5)); 
        
        let newInterval; 
        
        if (q < 2) { 
          newInterval = 1; 
          repetitions = 0; 
        } else { 
          if (repetitions === 0) { 
            newInterval = 1; 
          } else if (repetitions === 1) { 
            newInterval = 3; 
          } else { 
            newInterval = Math.round(currentInterval * newEF); 
          } 
          repetitions++; 
        } 
        
        return { newInterval, newEF, repetitions }; 
      } 
      
      // Fun√ß√£o para calcular for√ßa da mem√≥ria 
      calculateMemoryStrength(topic) { 
        if (!topic.lastReviewed) return 0.5; 
        
        const now = this.getToday(); 
        const lastReview = topic.lastReviewed; 
        const diffTime = Math.max(0, now - lastReview); 
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)); 
        
        const baseStrength = 0.9; 
        const decayRate = 0.15; 
        
        let strength = baseStrength * Math.exp(-decayRate * diffDays); 
        
        if (topic.difficultyHistory && topic.difficultyHistory.length > 0) { 
          const avgDifficulty = topic.difficultyHistory.reduce((a, b) => a + b, 0) / topic.difficultyHistory.length; 
          strength *= (1 - (avgDifficulty * 0.15)); 
        } 
        
        return Math.min(Math.max(strength, 0.1), 0.95); 
      } 
      
      // Fun√ß√£o para obter timestamp do dia atual 
      getToday() { 
        const today = new Date(); 
        today.setHours(0, 0, 0, 0); 
        return today.getTime(); 
      } 
      
      registerHomeSession(subject, minutes) { 
        const hoje = new Date(); 
        const dateKey = `sessions-${hoje.getDate()}-${hoje.getMonth()+1}-${hoje.getFullYear()}`; 
        
        let sessions = this.getModuleData(dateKey) || []; 
        sessions.push({ 
          subject: subject, 
          minutes: minutes, 
          date: `${hoje.getDate()}-${hoje.getMonth()+1}-${hoje.getFullYear()}`, 
          timestamp: hoje.toISOString() 
        }); 
        
        this.setModuleData(dateKey, sessions); 
      } 
      
      // Restante das fun√ß√µes (showEditalMenu, showSimuladosMenu, etc.) permanecem inalteradas 
      // ... (c√≥digo omitido por brevidade, mas mantido no arquivo completo) 
      
      closeRegisterModal() { 
        document.getElementById('registerModal').style.display = 'none'; 
      } 
      
      addMessageToChat(content, isUser = false, timestamp = null, messageId = null) { 
        // Verificar se a mensagem j√° foi exibida (evitar duplica√ß√£o) 
        if (messageId && this.messageIds.has(messageId)) { 
          return; 
        } 
        
        if (messageId) { 
          this.messageIds.add(messageId); 
        } 
        
        const chatMessages = document.getElementById('chatMessages'); 
        const messageContainer = document.createElement('div'); 
        messageContainer.className = `message-container ${isUser ? 'user-container' : 'bot-container'}`; 
        
        if (!isUser) { 
          const avatar = document.createElement('div'); 
          avatar.className = 'avatar bot-avatar-small'; 
          avatar.innerHTML = '<i class="fas fa-robot"></i>'; 
          messageContainer.appendChild(avatar); 
        } 
        
        const messageBubble = document.createElement('div'); 
        messageBubble.className = `message-bubble ${isUser ? 'user-bubble' : 'bot-bubble'}`; 
        
        // Processar markdown simples (substituir *texto* por <strong>texto</strong>) 
        const processedContent = this.parseMarkdown(content); 
        
        const messageContent = document.createElement('div'); 
        messageContent.className = 'message-content'; 
        messageContent.innerHTML = processedContent; 
        
        const messageTime = document.createElement('div'); 
        messageTime.className = 'bubble-time'; 
        messageTime.textContent = timestamp ? this.formatTime(new Date(timestamp)) : this.formatTime(new Date()); 
        
        messageBubble.appendChild(messageContent); 
        messageBubble.appendChild(messageTime); 
        
        // Adicionar rea√ß√£o para mensagens do usu√°rio 
        if (isUser) { 
          const reaction = document.createElement('div'); 
          reaction.className = 'message-reaction'; 
          reaction.innerHTML = '<span class="reaction-icon"><i class="fas fa-check-double"></i></span>'; 
          messageBubble.appendChild(reaction); 
        } 
        
        messageContainer.appendChild(messageBubble); 
        
        if (isUser) { 
          const avatar = document.createElement('div'); 
          avatar.className = 'avatar user-avatar-small'; 
          avatar.innerHTML = '<i class="fas fa-user"></i>'; 
          messageContainer.appendChild(avatar); 
        } 
        
        chatMessages.appendChild(messageContainer); 
        
        // Scroll para a √∫ltima mensagem 
        chatMessages.scrollTop = chatMessages.scrollHeight; 
        
        // Salvar no hist√≥rico (limitado a 3 mensagens) 
        this.chatHistory.push({ 
          content: content, 
          isUser: isUser, 
          timestamp: timestamp || new Date().toISOString() 
        }); 
        
        // Manter apenas as √∫ltimas 3 mensagens 
        if (this.chatHistory.length > 3) { 
          this.chatHistory = this.chatHistory.slice(-3); 
        } 
        
        localStorage.setItem('chatHistory', JSON.stringify(this.chatHistory)); 
      } 
      
      // Fun√ß√£o para parsear markdown simples 
      parseMarkdown(text) { 
        // Substituir *texto* por <strong>texto</strong> 
        return text.replace(/\*(.*?)\*/g, '<strong>$1</strong>'); 
      } 
      
      addBotMessage(content, saveToHistory = true, messageId = null) { 
        if (saveToHistory) { 
          this.addMessageToChat(content, false, null, messageId); 
        } else { 
          // N√£o salva no hist√≥rico para mensagens de interface 
          const chatMessages = document.getElementById('chatMessages'); 
          const messageContainer = document.createElement('div'); 
          messageContainer.className = 'message-container bot-container'; 
          
          const avatar = document.createElement('div'); 
          avatar.className = 'avatar bot-avatar-small'; 
          avatar.innerHTML = '<i class="fas fa-robot"></i>'; 
          messageContainer.appendChild(avatar); 
          
          const messageBubble = document.createElement('div'); 
          messageBubble.className = 'message-bubble bot-bubble'; 
          
          // Processar markdown 
          const processedContent = this.parseMarkdown(content); 
          
          const messageContent = document.createElement('div'); 
          messageContent.className = 'message-content'; 
          messageContent.innerHTML = processedContent; 
          
          const messageTime = document.createElement('div'); 
          messageTime.className = 'bubble-time'; 
          messageTime.textContent = this.formatTime(new Date()); 
          
          messageBubble.appendChild(messageContent); 
          messageBubble.appendChild(messageTime); 
          
          messageContainer.appendChild(messageBubble); 
          chatMessages.appendChild(messageContainer); 
          
          chatMessages.scrollTop = chatMessages.scrollHeight; 
        } 
      } 
      
      typeMessage(text, callback = null, messageId = null) { 
        const chatMessages = document.getElementById('chatMessages'); 
        const messageContainer = document.createElement('div'); 
        messageContainer.className = 'message-container bot-container'; 
        
        const avatar = document.createElement('div'); 
        avatar.className = 'avatar bot-avatar-small'; 
        avatar.innerHTML = '<i class="fas fa-robot"></i>'; 
        messageContainer.appendChild(avatar); 
        
        const messageBubble = document.createElement('div'); 
        messageBubble.className = 'message-bubble bot-bubble'; 
        
        // Processar markdown 
        const processedText = this.parseMarkdown(text); 
        
        const messageContent = document.createElement('div'); 
        messageContent.className = 'message-content'; 
        messageContent.innerHTML = `<span class="typing-text">${processedText}</span>`; 
        
        const messageTime = document.createElement('div'); 
        messageTime.className = 'bubble-time'; 
        messageTime.textContent = this.formatTime(new Date()); 
        
        messageBubble.appendChild(messageContent); 
        messageBubble.appendChild(messageTime); 
        
        messageContainer.appendChild(messageBubble); 
        chatMessages.appendChild(messageContainer); 
        
        chatMessages.scrollTop = chatMessages.scrollHeight; 
        
        // Salvar no hist√≥rico - CORRIGIDO 
        this.chatHistory.push({ 
          content: text, 
          isUser: false, 
          timestamp: new Date().toISOString() 
        }); 
        
        // Manter apenas as √∫ltimas 3 mensagens 
        if (this.chatHistory.length > 3) { 
          this.chatHistory = this.chatHistory.slice(-3); 
        } 
        
        localStorage.setItem('chatHistory', JSON.stringify(this.chatHistory)); 
        
        // Chamar callback ap√≥s a anima√ß√£o 
        if (callback) { 
          setTimeout(callback, text.length * 30 + 300); 
        } 
      } 
      
      showTypingIndicator() { 
        const chatMessages = document.getElementById('chatMessages'); 
        const messageContainer = document.createElement('div'); 
        messageContainer.className = 'message-container bot-container'; 
        
        const avatar = document.createElement('div'); 
        avatar.className = 'avatar bot-avatar-small'; 
        avatar.innerHTML = '<i class="fas fa-robot"></i>'; 
        messageContainer.appendChild(avatar); 
        
        const typingBubble = document.createElement('div'); 
        typingBubble.className = 'typing-indicator'; 
        typingBubble.id = 'typingIndicator'; 
        typingBubble.innerHTML = ` 
          <div class="typing-dot"></div> 
          <div class="typing-dot"></div> 
          <div class="typing-dot"></div> 
        `; 
        
        messageContainer.appendChild(typingBubble); 
        chatMessages.appendChild(messageContainer); 
        
        chatMessages.scrollTop = chatMessages.scrollHeight; 
      } 
      
      hideTypingIndicator() { 
        const typingIndicator = document.getElementById('typingIndicator'); 
        if (typingIndicator) { 
          typingIndicator.parentElement.remove(); 
        } 
      } 
      
      sendMessage() { 
        const input = document.getElementById('messageInput'); 
        const message = input.value.trim(); 
        
        if (message) { 
          this.addUserMessage(message); 
          input.value = ''; 
          
          // Simular resposta do bot 
          this.showTypingIndicator(); 
          setTimeout(() => { 
            this.hideTypingIndicator(); 
            this.processUserMessage(message); 
          }, 1000 + Math.random() * 1000); 
        } 
      } 
      
      processUserMessage(message) { 
        const lowerMessage = message.toLowerCase(); 
        
        if (lowerMessage.includes('resumo') || lowerMessage.includes('como estou') || lowerMessage.includes('tarefas')) { 
          this.showDailySummary(); 
        } else if (lowerMessage.includes('registrar') || lowerMessage.includes('adicionar')) { 
          this.openRegisterModal(); 
        } else if (lowerMessage.includes('configurar') || lowerMessage.includes('config')) { 
          this.showConfigModal(); 
        } else if (lowerMessage.includes('ajuda') || lowerMessage.includes('comandos')) { 
          this.showHelp(); 
        } else if (lowerMessage.includes('info') || lowerMessage.includes('sobre')) { 
          this.showInfo(); 
        } else if (lowerMessage.includes('edital')) { 
          this.showEditalMenu(); 
        } else if (lowerMessage.includes('simulado')) { 
          this.showSimuladosMenu(); 
        } else if (lowerMessage.includes('reset')) { 
          this.showResetConfirmation(); 
        } else { 
          // Resposta padr√£o 
          this.typeMessage("Entendi sua mensagem! Posso te ajudar com:\n\n‚Ä¢ <strong>Resumo do dia</strong>\n‚Ä¢ <strong>Registrar atividades</strong>\n‚Ä¢ <strong>Edital</strong>\n‚Ä¢ <strong>Simulados</strong>\n‚Ä¢ <strong>Configura√ß√µes</strong>\n‚Ä¢ <strong>Ajuda e informa√ß√µes</strong>\n\nO que voc√™ gostaria de fazer?"); 
        } 
      } 
      
      showHelp() { 
        const helpCard = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-question-circle"></i> 
              <div class="message-card-title">Como posso ajud√°-lo?</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-list"> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-calendar-day"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Resumo do dia</div> 
                    <div class="message-list-description">Mostrar tarefas e progresso atual</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-plus-circle"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Registrar atividades</div> 
                    <div class="message-list-description">Quest√µes, Anki ou teoria</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-file-alt"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Edital</div> 
                    <div class="message-list-description">Ver progresso no edital completo ou por mat√©ria</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-chart-line"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Simulados</div> 
                    <div class="message-list-description">Ver notas e relat√≥rios de simulados</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-cog"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Configurar</div> 
                    <div class="message-list-description">Ajustar quantidade de mat√©rias por dia</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-question-circle"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Ajuda</div> 
                    <div class="message-list-description">Mostrar esta mensagem de ajuda</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-info"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Informa√ß√µes</div> 
                    <div class="message-list-description">Sobre o StudyFlow</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-exclamation-triangle"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Reset</div> 
                    <div class="message-list-description">Fun√ß√£o tempor√°ria para corrigir travamentos</div> 
                  </div> 
                </div> 
              </div> 
            </div> 
          </div> 
        `; 
        this.addBotMessage(helpCard, true, 'help-message'); 
      } 
      
      showInfo() { 
        const infoCard = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-info-circle"></i> 
              <div class="message-card-title">Sobre o StudyFlow</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-text"> 
                O StudyFlow √© seu assistente pessoal de estudos, integrando todas as suas ferramentas de aprendizado em um s√≥ lugar. 
              </div> 
              <div class="message-muted" style="margin-top: 10px"> 
                Comigo voc√™ pode: 
              </div> 
              <div class="message-list" style="margin-top: 8px"> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Gerenciar seu ciclo de estudos</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Registrar quest√µes e revis√µes</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Acompanhar seu progresso no edital</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Analisar desempenho em simulados</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-check"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Receber alertas e lembretes</div> 
                  </div> 
                </div> 
              </div> 
            </div> 
          </div> 
        `; 
        this.addBotMessage(infoCard, true, 'info-message'); 
      } 
      
      showQuickActions() { 
        this.addBotMessage(` 
          <div class="quick-actions"> 
            <button class="action-btn primary" onclick="chatBot.showDailySummary()"> 
              <i class="fas fa-calendar-day"></i> Resumo do Dia 
            </button> 
            <button class="action-btn secondary" onclick="chatBot.openRegisterModal()"> 
              <i class="fas fa-plus-circle"></i> Registrar 
            </button> 
            <button class="action-btn info" onclick="chatBot.showEditalMenu()"> 
              <i class="fas fa-file-alt"></i> Edital 
            </button> 
            <button class="action-btn info" onclick="chatBot.showSimuladosMenu()"> 
              <i class="fas fa-chart-line"></i> Simulados 
            </button> 
            <button class="action-btn info" onclick="chatBot.showConfigModal()"> 
              <i class="fas fa-cog"></i> Configurar 
            </button> 
            <button class="action-btn info" onclick="chatBot.showHelp()"> 
              <i class="fas fa-question-circle"></i> Ajuda 
            </button> 
            <button class="action-btn info" onclick="chatBot.showInfo()"> 
              <i class="fas fa-info"></i> Informa√ß√µes 
            </button> 
            <!-- BOT√ÉO DE RESET ATUALIZADO --> 
            <button class="action-btn reset" onclick="chatBot.showResetConfirmation()"> 
              <i class="fas fa-exclamation-triangle"></i> Reset 
            </button> 
          </div> 
        `, false); 
      } 
      
      toggleEmojiPicker() { 
        // Implementa√ß√£o b√°sica de emoji picker 
        const emojis = ["üòä", "üëç", "‚ù§Ô∏è", "üî•", "‚≠ê", "üìö", "üéØ", "üí°", "üöÄ", "‚úÖ"]; 
        
        let emojiHTML = '<div class="quick-actions">'; 
        emojis.forEach(emoji => { 
          emojiHTML += `<button class="action-btn" onclick="chatBot.addEmoji('${emoji}')">${emoji}</button>`; 
        }); 
        emojiHTML += '</div>'; 
        
        this.addBotMessage(emojiHTML, false); 
      } 
      
      addEmoji(emoji) { 
        const input = document.getElementById('messageInput'); 
        input.value += emoji; 
        input.focus(); 
      } 
      
      // Fun√ß√µes para o m√≥dulo Edital 
      showEditalMenu() { 
        const editalData = this.getEditalData(); 
        if (!editalData) { 
          this.typeMessage("N√£o encontrei dados do edital verticalizado. Verifique se voc√™ j√° importou um edital no m√≥dulo correspondente."); 
          return; 
        } 
        
        this.addBotMessage(` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-file-alt"></i> 
              <div class="message-card-title">Progresso no Edital</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-text"> 
                Voc√™ quer ver seu progresso no edital completo ou em uma mat√©ria espec√≠fica? 
              </div> 
              <div class="quick-actions" style="margin-top: 12px"> 
                <button class="action-btn primary" onclick="chatBot.showEditalCompleto()"> 
                  <i class="fas fa-chart-pie"></i> Todo o Edital 
                </button> 
                <button class="action-btn secondary" onclick="chatBot.showMateriasEdital()"> 
                  <i class="fas fa-book"></i> Mat√©ria Espec√≠fica 
                </button> 
              </div> 
            </div> 
          </div> 
        `, true, 'edital-menu'); 
      } 
      
      getEditalData() { 
        try { 
          // Buscar dados do m√≥dulo de edital verticalizado 
          const editais = JSON.parse(localStorage.getItem('editais')); 
          const editalAtivoId = localStorage.getItem('editalAtivoId'); 
          
          if (!editais || !editalAtivoId) { 
            return null; 
          } 
          
          const editalAtivo = editais.find(edital => edital.id === editalAtivoId); 
          if (!editalAtivo) { 
            return null; 
          } 
          
          // Buscar progresso do edital ativo 
          const completedTopicsKey = `completedTopics_${editalAtivoId}`; 
          const completedTopics = JSON.parse(localStorage.getItem(completedTopicsKey)) || {}; 
          
          return { 
            edital: editalAtivo, 
            progresso: completedTopics 
          }; 
        } catch (error) { 
          console.error('Erro ao buscar dados do edital:', error); 
          return null; 
        } 
      } 
      
      showEditalCompleto() { 
        const editalData = this.getEditalData(); 
        if (!editalData) { 
          this.typeMessage("N√£o foi poss√≠vel carregar os dados do edital."); 
          return; 
        } 
        
        const { edital, progresso } = editalData; 
        
        // Calcular estat√≠sticas gerais 
        let totalTopicos = 0; 
        let topicosConcluidos = 0; 
        
        edital.disciplinas.forEach(disciplina => { 
          disciplina.topicos.forEach(topico => { 
            totalTopicos++; 
            const chaveTopico = `${disciplina.nome}-${topico}`; 
            if (progresso[chaveTopico]) { 
              topicosConcluidos++; 
            } 
          }); 
        }); 
        
        const porcentagemTotal = totalTopicos > 0 ? Math.round((topicosConcluidos / totalTopicos) * 100) : 0; 
        
        // Calcular progresso por disciplina 
        const progressoDisciplinas = edital.disciplinas.map(disciplina => { 
          let topicosDisciplina = 0; 
          let concluidosDisciplina = 0; 
          
          disciplina.topicos.forEach(topico => { 
            topicosDisciplina++; 
            const chaveTopico = `${disciplina.nome}-${topico}`; 
            if (progresso[chaveTopico]) { 
              concluidosDisciplina++; 
            } 
          }); 
          
          const porcentagem = topicosDisciplina > 0 ? Math.round((concluidosDisciplina / topicosDisciplina) * 100) : 0; 
          
          return { 
            nome: disciplina.nome, 
            concluidos: concluidosDisciplina, 
            total: topicosDisciplina, 
            porcentagem: porcentagem 
          }; 
        }); 
        
        // Ordenar por porcentagem (menor para maior) 
        progressoDisciplinas.sort((a, b) => a.porcentagem - b.porcentagem); 
        
        let relatorioHTML = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-chart-pie"></i> 
              <div class="message-card-title">Progresso Geral do Edital</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-stats"> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${porcentagemTotal}%</div> 
                  <div class="message-stat-label">Conclu√≠do</div> 
                </div> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${topicosConcluidos}/${totalTopicos}</div> 
                  <div class="message-stat-label">T√≥picos</div> 
                </div> 
              </div> 
              <div class="message-progress"> 
                <div class="message-progress-bar"> 
                  <div class="message-progress-fill" style="width: ${porcentagemTotal}%"></div> 
                </div> 
                <div class="message-progress-text"> 
                  <span>0%</span> 
                  <span>${porcentagemTotal}%</span> 
                  <span>100%</span> 
                </div> 
              </div> 
              <div class="message-section"> 
                <div class="message-section-title">Progresso por Disciplina</div> 
                <div class="message-list"> 
        `; 
        
        progressoDisciplinas.forEach(disciplina => { 
          const statusClass = disciplina.porcentagem >= 80 ? 'success' : disciplina.porcentagem >= 50 ? 'warning' : 'danger'; 
          
          relatorioHTML += ` 
            <div class="message-list-item"> 
              <div class="message-list-icon"><i class="fas fa-book"></i></div> 
              <div class="message-list-content"> 
                <div class="message-list-title">${disciplina.nome}</div> 
                <div class="message-list-description"> 
                  ${disciplina.concluidos}/${disciplina.total} t√≥picos 
                  <span class="message-badge message-badge-${statusClass}">${disciplina.porcentagem}%</span> 
                </div> 
              </div> 
            </div> 
          `; 
        }); 
        
        relatorioHTML += ` 
                </div> 
              </div> 
            </div> 
          </div> 
        `; 
        
        this.addBotMessage(relatorioHTML, true, 'edital-completo'); 
      } 
      
      showMateriasEdital() { 
        const editalData = this.getEditalData(); 
        if (!editalData) { 
          this.typeMessage("N√£o foi poss√≠vel carregar os dados do edital."); 
          return; 
        } 
        
        const { edital } = editalData; 
        
        let materiasHTML = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-book"></i> 
              <div class="message-card-title">Selecione uma Mat√©ria</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="quick-actions"> 
        `; 
        
        edital.disciplinas.forEach(disciplina => { 
          materiasHTML += ` 
            <button class="action-btn info" onclick="chatBot.showEditalMateria('${disciplina.nome}')"> 
              <i class="fas fa-book-open"></i> ${disciplina.nome} 
            </button> 
          `; 
        }); 
        
        materiasHTML += ` 
              </div> 
            </div> 
          </div> 
        `; 
        
        this.addBotMessage(materiasHTML, true, 'materias-edital'); 
      } 
      
      showEditalMateria(materiaNome) { 
        const editalData = this.getEditalData(); 
        if (!editalData) { 
          this.typeMessage("N√£o foi poss√≠vel carregar os dados do edital."); 
          return; 
        } 
        
        const { edital, progresso } = editalData; 
        const disciplina = edital.disciplinas.find(d => d.nome === materiaNome); 
        
        if (!disciplina) { 
          this.typeMessage("Mat√©ria n√£o encontrada no edital."); 
          return; 
        } 
        
        // Calcular estat√≠sticas da disciplina 
        let totalTopicos = 0; 
        let topicosConcluidos = 0; 
        const topicosDetalhados = []; 
        
        disciplina.topicos.forEach(topico => { 
          totalTopicos++; 
          const chaveTopico = `${disciplina.nome}-${topico}`; 
          const concluido = progresso[chaveTopico] || false; 
          
          if (concluido) { 
            topicosConcluidos++; 
          } 
          
          topicosDetalhados.push({ 
            nome: topico, 
            concluido: concluido 
          }); 
        }); 
        
        const porcentagem = totalTopicos > 0 ? Math.round((topicosConcluidos / totalTopicos) * 100) : 0; 
        
        let materiaHTML = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-book-open"></i> 
              <div class="message-card-title">${disciplina.nome}</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-stats"> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${porcentagem}%</div> 
                  <div class="message-stat-label">Conclu√≠do</div> 
                </div> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${topicosConcluidos}/${totalTopicos}</div> 
                  <div class="message-stat-label">T√≥picos</div> 
                </div> 
              </div> 
              <div class="message-progress"> 
                <div class="message-progress-bar"> 
                  <div class="message-progress-fill" style="width: ${porcentagem}%"></div> 
                </div> 
                <div class="message-progress-text"> 
                  <span>0%</span> 
                  <span>${porcentagem}%</span> 
                  <span>100%</span> 
                </div> 
              </div> 
              <div class="message-section"> 
                <div class="message-section-title">T√≥picos</div> 
                <div class="message-list"> 
        `; 
        
        topicosDetalhados.forEach(topico => { 
          const statusIcon = topico.concluido ? 'check-circle' : 'circle'; 
          const statusColor = topico.concluido ? 'success' : 'gray'; 
          
          materiaHTML += ` 
            <div class="message-list-item"> 
              <div class="message-list-icon" style="color: var(--${statusColor})"> 
                <i class="fas fa-${statusIcon}"></i> 
              </div> 
              <div class="message-list-content"> 
                <div class="message-list-title">${topico.nome}</div> 
                <div class="message-list-description"> 
                  ${topico.concluido ? 'Conclu√≠do' : 'Pendente'} 
                </div> 
              </div> 
            </div> 
          `; 
        }); 
        
        materiaHTML += ` 
                </div> 
              </div> 
            </div> 
          </div> 
        `; 
        
        this.addBotMessage(materiaHTML, true, `edital-${materiaNome}`); 
      } 
      
      // Fun√ß√µes para o m√≥dulo Simulados 
      showSimuladosMenu() { 
        const simuladosData = this.getSimuladosData(); 
        if (!simuladosData || simuladosData.simulados.length === 0) { 
          this.typeMessage("N√£o encontrei dados de simulados. Verifique se voc√™ j√° realizou algum simulado no m√≥dulo correspondente."); 
          return; 
        } 
        
        this.addBotMessage(` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-chart-line"></i> 
              <div class="message-card-title">An√°lise de Simulados</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-text"> 
                O que voc√™ gostaria de ver? 
              </div> 
              <div class="quick-actions" style="margin-top: 12px"> 
                <button class="action-btn primary" onclick="chatBot.showUltimoSimuladoNota()"> 
                  <i class="fas fa-star"></i> Nota do √öltimo Simulado 
                </button> 
                <button class="action-btn secondary" onclick="chatBot.showUltimoSimuladoRelatorio()"> 
                  <i class="fas fa-chart-bar"></i> Relat√≥rio Completo 
                </button> 
                <button class="action-btn info" onclick="chatBot.showUltimoSimuladoData()"> 
                  <i class="fas fa-calendar"></i> Data do √öltimo Simulado 
                </button> 
              </div> 
            </div> 
          </div> 
        `, true, 'simulados-menu'); 
      } 
      
      getSimuladosData() { 
        try { 
          // Buscar dados do m√≥dulo de simulados 
          const simulados = JSON.parse(localStorage.getItem('simulados')) || []; 
          const provas = JSON.parse(localStorage.getItem('provas')) || []; 
          const provaAtivaId = localStorage.getItem('provaAtivaId'); 
          
          if (simulados.length === 0) { 
            return null; 
          } 
          
          // Ordenar simulados por data (mais recente primeiro) 
          simulados.sort((a, b) => new Date(b.date) - new Date(a.date)); 
          
          const ultimoSimulado = simulados[0]; 
          const prova = provas.find(p => p.id === ultimoSimulado.idProva); 
          
          return { 
            simulados: simulados, 
            ultimoSimulado: ultimoSimulado, 
            prova: prova, 
            provaAtivaId: provaAtivaId 
          }; 
        } catch (error) { 
          console.error('Erro ao buscar dados de simulados:', error); 
          return null; 
        } 
      } 
      
      showUltimoSimuladoNota() { 
        const simuladosData = this.getSimuladosData(); 
        if (!simuladosData) { 
          this.typeMessage("N√£o foi poss√≠vel carregar os dados dos simulados."); 
          return; 
        } 
        
        const { ultimoSimulado, prova } = simuladosData; 
        const dataFormatada = new Date(ultimoSimulado.date).toLocaleDateString('pt-BR'); 
        
        // Determinar classifica√ß√£o baseada na porcentagem 
        const porcentagem = parseFloat(ultimoSimulado.totalPercentage); 
        let classificacao = ''; 
        let corClassificacao = ''; 
        
        if (porcentagem >= 90) { 
          classificacao = 'EXCELENTE'; 
          corClassificacao = 'success'; 
        } else if (porcentagem >= 80) { 
          classificacao = '√ìTIMO'; 
          corClassificacao = 'primary'; 
        } else if (porcentagem >= 66) { 
          classificacao = 'BOM'; 
          corClassificacao = 'secondary'; 
        } else if (porcentagem >= 51) { 
          classificacao = 'M√âDIO'; 
          corClassificacao = 'warning'; 
        } else if (porcentagem >= 31) { 
          classificacao = 'FRACO'; 
          corClassificacao = 'warning'; 
        } else { 
          classificacao = 'CR√çTICO'; 
          corClassificacao = 'danger'; 
        } 
        
        const notaHTML = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-star"></i> 
              <div class="message-card-title">Nota do √öltimo Simulado</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-stats"> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${ultimoSimulado.totalScore}</div> 
                  <div class="message-stat-label">Pontua√ß√£o</div> 
                </div> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${ultimoSimulado.totalPercentage}%</div> 
                  <div class="message-stat-label">Acertos</div> 
                </div> 
              </div> 
              <div class="message-alert message-alert-${corClassificacao}"> 
                <i class="fas fa-${porcentagem >= 66 ? 'check' : 'exclamation'}-circle"></i> 
                <div><strong>Classifica√ß√£o: ${classificacao}</strong></div> 
              </div> 
              <div class="message-list"> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-calendar"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Data</div> 
                    <div class="message-list-description">${dataFormatada}</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-clock"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Tempo Total</div> 
                    <div class="message-list-description">${ultimoSimulado.totalTime} minutos</div> 
                  </div> 
                </div> 
                ${prova ? ` 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-file-alt"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Prova</div> 
                    <div class="message-list-description">${prova.nomeConcurso} - ${prova.nomeBanca}</div> 
                  </div> 
                </div> 
                ` : ''} 
              </div> 
            </div> 
          </div> 
        `; 
        
        this.addBotMessage(notaHTML, true, 'ultimo-simulado-nota'); 
      } 
      
      showUltimoSimuladoRelatorio() { 
        const simuladosData = this.getSimuladosData(); 
        if (!simuladosData) { 
          this.typeMessage("N√£o foi poss√≠vel carregar os dados dos simulados."); 
          return; 
        } 
        
        const { ultimoSimulado, prova } = simuladosData; 
        const dataFormatada = new Date(ultimoSimulado.date).toLocaleDateString('pt-BR'); 
        
        // Organizar disciplinas por categoria (se dispon√≠vel) 
        const disciplinas = []; 
        
        if (prova && prova.disciplinas) { 
          Object.keys(prova.disciplinas).forEach(categoria => { 
            Object.keys(prova.disciplinas[categoria]).forEach(disciplina => { 
              if (ultimoSimulado.details[disciplina]) { 
                disciplinas.push({ 
                  nome: disciplina, 
                  categoria: categoria, 
                  detalhes: ultimoSimulado.details[disciplina], 
                  tempo: ultimoSimulado.time[disciplina] || 0 
                }); 
              } 
            }); 
          }); 
        } else { 
          // Se n√£o houver estrutura de categorias, listar todas as disciplinas 
          Object.keys(ultimoSimulado.details).forEach(disciplina => { 
            disciplinas.push({ 
              nome: disciplina, 
              categoria: 'GERAL', 
              detalhes: ultimoSimulado.details[disciplina], 
              tempo: ultimoSimulado.time[disciplina] || 0 
            }); 
          }); 
        } 
        
        let relatorioHTML = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-chart-bar"></i> 
              <div class="message-card-title">Relat√≥rio Completo - ${dataFormatada}</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-stats"> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${ultimoSimulado.totalScore}</div> 
                  <div class="message-stat-label">Pontua√ß√£o</div> 
                </div> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${ultimoSimulado.totalPercentage}%</div> 
                  <div class="message-stat-label">Acertos</div> 
                </div> 
                <div class="message-stat"> 
                  <div class="message-stat-value">${ultimoSimulado.totalTime}</div> 
                  <div class="message-stat-label">Minutos</div> 
                </div> 
              </div> 
              <div class="message-section"> 
                <div class="message-section-title">Desempenho por Disciplina</div> 
                <div class="message-list"> 
        `; 
        
        disciplinas.forEach(disciplina => { 
          const porcentagem = parseFloat(disciplina.detalhes.percentage); 
          let statusClass = ''; 
          if (porcentagem >= 80) statusClass = 'success'; 
          else if (porcentagem >= 60) statusClass = 'warning'; 
          else statusClass = 'danger'; 
          
          relatorioHTML += ` 
            <div class="message-list-item"> 
              <div class="message-list-icon"><i class="fas fa-book"></i></div> 
              <div class="message-list-content"> 
                <div class="message-list-title">${disciplina.nome}</div> 
                <div class="message-list-description"> 
                  ${disciplina.detalhes.correct} acertos de ${disciplina.detalhes.correct + disciplina.detalhes.errors} 
                  <span class="message-badge message-badge-${statusClass}">${disciplina.detalhes.percentage}%</span> 
                </div> 
                <div class="message-list-description"> 
                  Pontua√ß√£o: ${disciplina.detalhes.score} ‚Ä¢ Tempo: ${disciplina.tempo} min 
                </div> 
              </div> 
            </div> 
          `; 
        }); 
        
        relatorioHTML += ` 
                </div> 
              </div> 
            </div> 
          </div> 
        `; 
        
        this.addBotMessage(relatorioHTML, true, 'ultimo-simulado-relatorio'); 
      } 
      
      showUltimoSimuladoData() { 
        const simuladosData = this.getSimuladosData(); 
        if (!simuladosData) { 
          this.typeMessage("N√£o foi poss√≠vel carregar os dados dos simulados."); 
          return; 
        } 
        
        const { ultimoSimulado, simulados } = simuladosData; 
        const dataFormatada = new Date(ultimoSimulado.date).toLocaleDateString('pt-BR'); 
        
        const hoje = new Date(); 
        const dataSimulado = new Date(ultimoSimulado.date); 
        const diffTime = Math.abs(hoje - dataSimulado); 
        const diffDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
        
        const dataHTML = ` 
          <div class="message-card"> 
            <div class="message-card-header"> 
              <i class="fas fa-calendar"></i> 
              <div class="message-card-title">Data do √öltimo Simulado</div> 
            </div> 
            <div class="message-card-content"> 
              <div class="message-alert message-alert-info"> 
                <i class="fas fa-info-circle"></i> 
                <div>Seu √∫ltimo simulado foi realizado h√° <strong>${diffDias} dia(s)</strong></div> 
              </div> 
              <div class="message-list"> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-calendar-day"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Data</div> 
                    <div class="message-list-description">${dataFormatada}</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-history"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Tempo Decorrido</div> 
                    <div class="message-list-description">${diffDias} dia(s)</div> 
                  </div> 
                </div> 
                <div class="message-list-item"> 
                  <div class="message-list-icon"><i class="fas fa-chart-line"></i></div> 
                  <div class="message-list-content"> 
                    <div class="message-list-title">Total de Simulados</div> 
                    <div class="message-list-description">${simulados.length} realizados</div> 
                  </div> 
                </div> 
              </div> 
              ${diffDias > 30 ? ` 
              <div class="message-alert message-alert-warning"> 
                <i class="fas fa-exclamation-triangle"></i> 
                <div>Faz mais de 30 dias desde seu √∫ltimo simulado. Considere realizar um novo para avaliar seu progresso.</div> 
              </div> 
              ` : ''} 
            </div> 
          </div> 
        `; 
        
        this.addBotMessage(dataHTML, true, 'ultimo-simulado-data'); 
      } 
      
      // Fun√ß√µes de alertas 
      checkAlerts() { 
        const alertas = []; 
        const hoje = new Date(); 
        
        // Verificar revis√µes atrasadas 
        const revisoesAtrasadas = this.calculateOverdueReviews(); 
        if (revisoesAtrasadas > 0) { 
          alertas.push({ 
            tipo: 'alert-danger', 
            icone: 'exclamation-triangle', 
            mensagem: `Voc√™ tem ${revisoesAtrasadas} revis√µes atrasadas!` 
          }); 
        } 
        
        // Verificar meta di√°ria 
        const dailyCompletedReviews = this.getModuleData('dailyCompletedReviews') || 0; 
        const dailyReviewGoal = this.getModuleData('dailyReviewGoal') || 5; 
        
        // Verificar se √© um novo dia 
        const lastReviewDate = this.getModuleData('lastReviewDate'); 
        const hojeStr = hoje.toISOString().split('T')[0]; 
        
        if (lastReviewDate !== hojeStr) { 
          // Resetar contador di√°rio se for um novo dia 
          this.setModuleData('dailyCompletedReviews', 0); 
          this.setModuleData('lastReviewDate', hojeStr); 
        } else if (dailyCompletedReviews < dailyReviewGoal / 2) { 
          alertas.push({ 
            tipo: 'alert-warning', 
            icone: 'bullseye', 
            mensagem: `Voc√™ completou apenas ${dailyCompletedReviews} de ${dailyReviewGoal} revis√µes hoje.` 
          }); 
        } 
        
        // Verificar dias sem estudo (simula√ß√£o) 
        const ultimoEstudo = localStorage.getItem('ultimoEstudo'); 
        if (ultimoEstudo) { 
          const diasSemEstudo = Math.floor((hoje - new Date(ultimoEstudo)) / (1000 * 60 * 60 * 24)); 
          if (diasSemEstudo >= 2) { 
            alertas.push({ 
              tipo: 'alert-danger', 
              icone: 'calendar-times', 
              mensagem: `Voc√™ n√£o estuda h√° ${diasSemEstudo} dias!` 
            }); 
          } 
        } 
        
        return alertas; 
      } 
      
      // Fun√ß√µes de integra√ß√£o com outros m√≥dulos 
      getModuleData(key) { 
        try { 
          const data = localStorage.getItem(key); 
          return data ? JSON.parse(data) : null; 
        } catch (e) { 
          console.error(`Erro ao carregar dados do m√≥dulo: ${key}`, e); 
          return null; 
        } 
      } 
      
      setModuleData(key, data) { 
        try { 
          localStorage.setItem(key, JSON.stringify(data)); 
          return true; 
        } catch (e) { 
          console.error(`Erro ao salvar dados no m√≥dulo: ${key}`, e); 
          return false; 
        } 
      } 
      
      // ALGORITMO DE PRIORIZA√á√ÉO ID√äNTICO AO M√ìDULO DE REVIS√ïES 
      calculateTodayReviews() { 
        const disciplines = this.getModuleData('disciplines'); 
        const dailyReviewGoal = this.getModuleData('dailyReviewGoal') || 5; 
        
        if (!disciplines || !Array.isArray(disciplines)) return []; 
        
        const hoje = new Date(); 
        const todayTimestamp = hoje.getTime(); 
        
        let pendingTopics = []; 
        
        // Fase 1: Coletar todos os assuntos pendentes 
        disciplines.forEach(disciplina => { 
          if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) { 
            disciplina.assuntos.forEach(assunto => { 
              // Ignorar assuntos suspensos 
              if (assunto.suspended) return; 
              
              // Verificar se est√° na data de revis√£o ou atrasado 
              if (assunto.nextReviewDate && assunto.nextReviewDate <= todayTimestamp) { 
                // Calcular dias de atraso 
                const daysOverdue = Math.max(0, Math.floor((todayTimestamp - assunto.nextReviewDate) / (1000 * 60 * 60 * 24))); 
                
                // Calcular dificuldade m√©dia (invertida: maior dificuldade = maior prioridade) 
                let avgDifficulty = 2; // padr√£o 
                if (assunto.difficultyHistory && assunto.difficultyHistory.length > 0) { 
                  avgDifficulty = assunto.difficultyHistory.reduce((a, b) => a + b, 0) / assunto.difficultyHistory.length; 
                } 
                const difficultyScore = (3 - avgDifficulty); // Inverte a escala 
                
                // Obter import√¢ncia 
                const importance = assunto.importance || 3; 
                
                // Calcular prioridade (mesma f√≥rmula do m√≥dulo de revis√µes) 
                const priority = (difficultyScore * 40) + (daysOverdue * 60) + (importance * 20); 
                
                pendingTopics.push({ 
                  id: assunto.nome, 
                  nome: assunto.nome, 
                  disciplina: disciplina.name, 
                  priority: priority, 
                  daysOverdue: daysOverdue, 
                  difficulty: avgDifficulty, 
                  importance: importance 
                }); 
              } 
            }); 
          } 
        }); 
        
        // Fase 2: Ordenar por prioridade (decrescente) 
        pendingTopics.sort((a, b) => b.priority - a.priority); 
        
        // Fase 3: Limitar pela meta di√°ria 
        return pendingTopics.slice(0, dailyReviewGoal); 
      } 
      
      calculateOverdueReviews() { 
        const disciplines = this.getModuleData('disciplines'); 
        if (!disciplines || !Array.isArray(disciplines)) return 0; 
        
        const hoje = new Date(); 
        const todayTimestamp = hoje.getTime(); 
        
        let atrasadas = 0; 
        
        disciplines.forEach(disciplina => { 
          if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) { 
            disciplina.assuntos.forEach(assunto => { 
              if (assunto.nextReviewDate && assunto.nextReviewDate < todayTimestamp && !assunto.suspended) { 
                atrasadas++; 
              } 
            }); 
          } 
        }); 
        
        return atrasadas; 
      } 
      
      // FUN√á√ÉO MELHORADA: Agora retorna m√∫ltiplas mat√©rias baseado na configura√ß√£o 
      getTodaySubjects() { 
        const activeCycle = this.getActiveCycle(); 
        if (!activeCycle || !activeCycle.generatedCycle) { 
          return []; 
        } 
        
        const todayIndex = activeCycle.currentDay || 0; 
        const materiasPorDia = this.materiasPorDia || 1; 
        
        let subjects = []; 
        const cycleLength = activeCycle.generatedCycle.length; 
        
        if (cycleLength === 0) { 
          return []; 
        } 
        
        // Ajustar o √≠ndice para estar dentro dos limites 
        const adjustedIndex = todayIndex % cycleLength; 
        
        // Pegar as pr√≥ximas mat√©rias baseado na configura√ß√£o 
        for (let i = 0; i < materiasPorDia; i++) { 
          const index = (adjustedIndex + i) % cycleLength; 
          let subject = activeCycle.generatedCycle[index]; 
          
          // Se o subject for um array (m√∫ltiplas mat√©rias no mesmo dia), junt√°-las 
          if (Array.isArray(subject)) { 
            subject = subject.join(', '); 
          } 
          
          // Ignorar revis√µes e simulados na contagem 
          if (subject && !subject.includes('Revis√£o') && !subject.includes('Simulado')) { 
            subjects.push(subject); 
          } 
        } 
        
        return subjects; 
      } 
      
      saveQuestoes(assuntoId, feitas, erradas, tempo) { 
        const corretas = parseInt(feitas) - parseInt(erradas); 
        const dificuldade = 2; // Valor padr√£o (Bom) - poderia ser capturado do usu√°rio 
        
        // Atualizar m√≥dulo de revis√µes 
        const revisaoAtualizada = this.updateReviewModule(assuntoId, feitas, corretas, tempo, dificuldade); 
        
        if (revisaoAtualizada) { 
          // Atualizar m√≥dulo home (mantendo o funcionamento atual) 
          let dailyCompletedReviews = this.getModuleData('dailyCompletedReviews') || 0; 
          dailyCompletedReviews += 1; 
          this.setModuleData('dailyCompletedReviews', dailyCompletedReviews); 
          
          const hoje = new Date(); 
          this.setModuleData('lastReviewDate', hoje.toISOString().split('T')[0]); 
          
          this.registerHomeSession(`Quest√µes - ${assuntoId}`, parseInt(tempo)); 
          localStorage.setItem('ultimoEstudo', new Date().toISOString()); 
        } 
      } 
      
      saveTeoria(materiaId, conteudo, pagina, tempo) { 
        // Atualizar ciclo de estudos 
        const cicloAtualizado = this.updateStudyCycle(materiaId, tempo); 
        
        if (cicloAtualizado) { 
          // Registrar sess√£o no m√≥dulo Home (mantendo o funcionamento atual) 
          this.registerHomeSession(`Teoria - ${materiaId}`, parseInt(tempo)); 
          
          // Salvar progresso da teoria 
          const teoriaProgress = this.getModuleData('teoriaProgress') || {}; 
          teoriaProgress[materiaId] = { 
            conteudo: conteudo, 
            pagina: pagina, 
            ultimaAtualizacao: new Date().toISOString() 
          }; 
          this.setModuleData('teoriaProgress', teoriaProgress); 
          
          localStorage.setItem('ultimoEstudo', new Date().toISOString()); 
        } 
      } 
      
      saveAnki(deckId, tempo, cards) { 
        // Registrar sess√£o no m√≥dulo Home 
        const ankiData = this.getModuleData('ciclos_focus_v1'); 
        const deck = ankiData && ankiData.decks ? ankiData.decks.find(d => d.id === deckId) : null; 
        const deckNome = deck ? deck.name : deckId; 
        
        this.registerHomeSession(`Anki - ${deckNome}`, parseInt(tempo)); 
        
        // Atualizar √∫ltimo estudo 
        localStorage.setItem('ultimoEstudo', new Date().toISOString()); 
      } 
      
      // Fun√ß√£o para atualizar o m√≥dulo de revis√µes (quest√µes) 
      updateReviewModule(assuntoId, feitas, corretas, tempo, dificuldade) { 
        const disciplines = this.getModuleData('disciplines') || []; 
        const hoje = new Date().getTime(); 
        
        // Encontrar o assunto espec√≠fico 
        let assuntoEncontrado = null; 
        let disciplinaEncontrada = null; 
        
        for (const disciplina of disciplines) { 
          if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) { 
            for (const assunto of disciplina.assuntos) { 
              if (assunto.nome === assuntoId) { 
                assuntoEncontrado = assunto; 
                disciplinaEncontrada = disciplina; 
                break; 
              } 
            } 
            if (assuntoEncontrado) break; 
          } 
        } 
        
        if (assuntoEncontrado) { 
          // Atualizar estat√≠sticas 
          assuntoEncontrado.questions = (assuntoEncontrado.questions || 0) + parseInt(feitas); 
          assuntoEncontrado.correct = (assuntoEncontrado.correct || 0) + parseInt(corretas); 
          assuntoEncontrado.incorrect = (assuntoEncontrado.incorrect || 0) + (parseInt(feitas) - parseInt(corretas)); 
          
          // Adicionar dificuldade ao hist√≥rico 
          if (!assuntoEncontrado.difficultyHistory) { 
            assuntoEncontrado.difficultyHistory = []; 
          } 
          assuntoEncontrado.difficultyHistory.push(parseInt(dificuldade)); 
          
          // Calcular acur√°cia 
          const accuracy = (parseInt(corretas) / parseInt(feitas)) * 100; 
          
          // Determinar o m√©todo de revis√£o 
          if (assuntoEncontrado.reviewMethod === 'fixed') { 
            // Revis√£o por desempenho - usar a fun√ß√£o do m√≥dulo de revis√µes 
            const interval = this.getPerformanceBasedInterval(accuracy); 
            assuntoEncontrado.interval = interval; 
            assuntoEncontrado.repetitions = (assuntoEncontrado.repetitions || 0) + 1; 
          } else { 
            // SM-2 - usar a fun√ß√£o do m√≥dulo de revis√µes 
            const result = this.calculateNextReviewSM2( 
              parseInt(dificuldade), 
              assuntoEncontrado.easeFactor || 2.5, 
              assuntoEncontrado.interval || 1, 
              assuntoEncontrado.repetitions || 0 
            ); 
            assuntoEncontrado.easeFactor = result.newEF; 
            assuntoEncontrado.interval = result.newInterval; 
            assuntoEncontrado.repetitions = result.repetitions; 
          } 
          
          // Atualizar datas 
          assuntoEncontrado.lastReviewed = hoje; 
          
          // Calcular pr√≥xima data de revis√£o 
          const nextReviewDate = new Date(hoje); 
          nextReviewDate.setDate(nextReviewDate.getDate() + assuntoEncontrado.interval); 
          assuntoEncontrado.nextReviewDate = nextReviewDate.getTime(); 
          
          // Calcular for√ßa da mem√≥ria 
          assuntoEncontrado.memoryStrength = this.calculateMemoryStrength(assuntoEncontrado); 
          
          // Salvar de volta no localStorage 
          this.setModuleData('disciplines', disciplines); 
          return true; 
        } else { 
          return false; 
        } 
      } 
      
      // Fun√ß√£o para atualizar o ciclo de estudos (mat√©rias te√≥ricas) 
      updateStudyCycle(materiaId, tempo) { 
        const activeCycle = this.getActiveCycle(); 
        const hoje = new Date().toISOString().split('T')[0]; // Data no formato YYYY-MM-DD 
        
        if (activeCycle && activeCycle.generatedCycle) { 
          const todayIndex = activeCycle.currentDay || 0; 
          const cycleLength = activeCycle.generatedCycle.length; 
          
          // Encontrar a mat√©ria no ciclo atual 
          let materiaEncontrada = activeCycle.generatedCycle[todayIndex % cycleLength]; 
          
          // Se for um array (m√∫ltiplas mat√©rias no mesmo dia), verificar se a mat√©ria est√° presente 
          if (Array.isArray(materiaEncontrada)) { 
            if (materiaEncontrada.includes(materiaId)) { 
              materiaEncontrada = materiaId; 
            } else { 
              materiaEncontrada = null; 
            } 
          } else { 
            if (materiaEncontrada !== materiaId) { 
              materiaEncontrada = null; 
            } 
          } 
          
          if (materiaEncontrada) { 
            // Marcar como estudada no dia atual 
            if (!activeCycle.completedSubjects) { 
              activeCycle.completedSubjects = {}; 
            } 
            activeCycle.completedSubjects[todayIndex] = true; 
            
            // Avan√ßar para o pr√≥ximo dia apenas se ainda n√£o avan√ßou hoje 
            if (activeCycle.lastAdvanced !== hoje) { 
              activeCycle.currentDay = (todayIndex + 1) % cycleLength; 
              activeCycle.lastAdvanced = hoje; 
            } 
            
            // Atualizar estat√≠sticas de progresso 
            if (!activeCycle.studyTime) { 
              activeCycle.studyTime = {}; 
            } 
            // Usar a data como chave para o tempo de estudo 
            activeCycle.studyTime[hoje] = (activeCycle.studyTime[hoje] || 0) + parseInt(tempo); 
            
            // Salvar de volta 
            this.setModuleData('StudyFlow_activeCycle', activeCycle); 
            return true; 
          } 
        } 
        return false; 
      } 
      
      // Fun√ß√£o para calcular intervalo baseado em desempenho 
      getPerformanceBasedInterval(accuracy) { 
        accuracy = Math.max(0, Math.min(100, accuracy)); 
        
        if (accuracy >= 100) return 30; 
        if (accuracy >= 80) return 25; 
        if (accuracy >= 60) return 15; 
        if (accuracy >= 40) return 7; 
        return 3; 
      } 
      
      // Algoritmo SM-2 
      calculateNextReviewSM2(q, currentEF, currentInterval, repetitions) { 
        let newEF = currentEF + (0.1 - (3 - q) * (0.08 + (3 - q) * 0.02)); 
        newEF = Math.max(1.3, Math.min(newEF, 2.5)); 
        
        let newInterval; 
        
        if (q < 2) { 
          newInterval = 1; 
          repetitions = 0; 
        } else { 
          if (repetitions === 0) { 
            newInterval = 1; 
          } else if (repetitions === 1) { 
            newInterval = 3; 
          } else { 
            newInterval = Math.round(currentInterval * newEF); 
          } 
          repetitions++; 
        } 
        
        return { newInterval, newEF, repetitions }; 
      } 
      
      // Fun√ß√£o para calcular for√ßa da mem√≥ria 
      calculateMemoryStrength(topic) { 
        if (!topic.lastReviewed) return 0.5; 
        
        const now = this.getToday(); 
        const lastReview = topic.lastReviewed; 
        const diffTime = Math.max(0, now - lastReview); 
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)); 
        
        const baseStrength = 0.9; 
        const decayRate = 0.15; 
        
        let strength = baseStrength * Math.exp(-decayRate * diffDays); 
        
        if (topic.difficultyHistory && topic.difficultyHistory.length > 0) { 
          const avgDifficulty = topic.difficultyHistory.reduce((a, b) => a + b, 0) / topic.difficultyHistory.length; 
          strength *= (1 - (avgDifficulty * 0.15)); 
        } 
        
        return Math.min(Math.max(strength, 0.1), 0.95); 
      } 
      
      // Fun√ß√£o para obter timestamp do dia atual 
      getToday() { 
        const today = new Date(); 
        today.setHours(0, 0, 0, 0); 
        return today.getTime(); 
      } 
      
      registerHomeSession(subject, minutes) { 
        const hoje = new Date(); 
        const dateKey = `sessions-${hoje.getDate()}-${hoje.getMonth()+1}-${hoje.getFullYear()}`; 
        
        let sessions = this.getModuleData(dateKey) || []; 
        sessions.push({ 
          subject: subject, 
          minutes: minutes, 
          date: `${hoje.getDate()}-${hoje.getMonth()+1}-${hoje.getFullYear()}`, 
          timestamp: hoje.toISOString() 
        }); 
        
        this.setModuleData(dateKey, sessions); 
      } 
    } 
    
    // Inicializar o chatbot quando a p√°gina carregar 
    let chatBot; 
    document.addEventListener('DOMContentLoaded', function() { 
      chatBot = new StudyFlowChatBot(); 
    }); 
  </script> 
</body> 
</html>