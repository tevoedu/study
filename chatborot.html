<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyFlow - ChatBot Central</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #25D366;
            --primary-dark: #128C7E;
            --secondary: #34B7F1;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --light: #FFFFFF;
            --dark: #1F2C34;
            --gray: #667781;
            --light-gray: #F0F0F0;
            --chat-bg: #E5DDD5;
            --user-bubble: #DCF8C6;
            --bot-bubble: #FFFFFF;
            --border-radius: 18px;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark-theme {
            --primary: #00A884;
            --primary-dark: #008069;
            --secondary: #53BDEB;
            --light: #111B21;
            --dark: #E9EDEF;
            --gray: #8696A0;
            --light-gray: #202C33;
            --chat-bg: #0B141A;
            --user-bubble: #005C4B;
            --bot-bubble: #202C33;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            overflow: hidden;
        }

        .chatbot-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            background-color: var(--chat-bg);
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            overflow: hidden;
            position: relative;
        }

        .chatbot-header {
            background-color: var(--light);
            color: var(--dark);
            padding: 0.8rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            z-index: 10;
            position: relative;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bot-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .header-info h1 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .header-info p {
            font-size: 0.8rem;
            opacity: 0.7;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--success);
            display: inline-block;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: transparent;
            border: none;
            color: var(--gray);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .header-btn:hover {
            background-color: var(--light-gray);
        }

        .chat-messages {
            display: flex;
            flex-direction: column;
            padding: 1rem;
            overflow-y: auto;
            flex: 1;
            gap: 8px;
            scroll-behavior: smooth;
        }

        .message-container {
            display: flex;
            margin-bottom: 4px;
            animation: messageAppear 0.3s ease-out;
        }

        .bot-container {
            justify-content: flex-start;
        }

        .user-container {
            justify-content: flex-end;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 8px;
            flex-shrink: 0;
            align-self: flex-end;
            margin-bottom: 4px;
        }

        .bot-avatar-small {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-size: 0.9rem;
        }

        .user-avatar-small {
            background: var(--secondary);
            color: white;
            font-size: 0.9rem;
        }

        .message-bubble {
            position: relative;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            max-width: 80%;
            margin-bottom: 2px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            box-shadow: var(--shadow);
            line-height: 1.4;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bot-bubble {
            background: var(--bot-bubble);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            color: var(--dark);
        }

        .user-bubble {
            background: var(--user-bubble);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
            color: #111B21;
        }

        .bubble-time {
            font-size: 0.65rem;
            opacity: 0.7;
            margin-top: 4px;
            text-align: right;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 12px 16px;
            background-color: var(--bot-bubble);
            border-radius: var(--border-radius);
            border-bottom-left-radius: 4px;
            align-self: flex-start;
            width: fit-content;
            margin-bottom: 8px;
            box-shadow: var(--shadow);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--gray);
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingAnimation {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .chatbot-input {
            display: flex;
            padding: 0.8rem 1.5rem;
            background-color: var(--light);
            border-top: 1px solid var(--light-gray);
            gap: 8px;
            align-items: center;
        }

        .chatbot-input input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 24px;
            border: none;
            background-color: var(--light-gray);
            color: var(--dark);
            font-size: 0.95rem;
            outline: none;
            transition: var(--transition);
        }

        .chatbot-input input:focus {
            background-color: var(--light);
            box-shadow: 0 0 0 1.5px var(--primary);
        }

        .input-actions {
            display: flex;
            gap: 5px;
        }

        .input-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: var(--gray);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .input-btn:hover {
            background-color: var(--light-gray);
        }

        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .send-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .message-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }
        
        .message-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            font-size: 0.7rem;
        }
        
        .message-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--dark);
        }
        
        .message-subtitle {
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--dark);
            margin-bottom: 4px;
        }
        
        .message-text {
            font-size: 0.9rem;
            line-height: 1.4;
            color: var(--dark);
        }
        
        .message-divider {
            height: 1px;
            background-color: var(--light-gray);
            margin: 8px 0;
        }
        
        .message-section {
            margin: 8px 0;
        }
        
        .message-section-title {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 6px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .message-list {
            list-style-type: none;
            margin: 8px 0;
            padding-left: 0;
        }
        
        .message-list-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 6px 0;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .message-list-item:last-child {
            border-bottom: none;
        }
        
        .message-list-icon {
            width: 16px;
            text-align: center;
            color: var(--primary);
            margin-top: 2px;
            flex-shrink: 0;
        }
        
        .message-list-content {
            flex: 1;
        }
        
        .message-list-title {
            font-weight: 500;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }
        
        .message-list-description {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .message-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 12px 0;
        }
        
        .message-stat {
            background-color: var(--light-gray);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .message-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 3px 0;
        }
        
        .message-stat-label {
            font-size: 0.75rem;
            color: var(--gray);
        }
        
        .message-progress {
            margin: 10px 0;
        }
        
        .message-progress-bar {
            height: 6px;
            background-color: var(--light-gray);
            border-radius: 3px;
            margin: 8px 0;
            overflow: hidden;
        }
        
        .message-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--primary));
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .message-progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .message-alert {
            padding: 10px 12px;
            border-radius: 8px;
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            box-shadow: var(--shadow);
        }
        
        .message-alert-warning {
            background-color: rgba(255, 152, 0, 0.1);
            border-left: 4px solid var(--warning);
        }
        
        .message-alert-danger {
            background-color: rgba(244, 67, 54, 0.1);
            border-left: 4px solid var(--danger);
        }
        
        .message-alert-success {
            background-color: rgba(76, 175, 80, 0.1);
            border-left: 4px solid var(--success);
        }
        
        .message-alert-info {
            background-color: rgba(52, 183, 241, 0.1);
            border-left: 4px solid var(--secondary);
        }
        
        .message-card {
            background-color: var(--bot-bubble);
            border-radius: 12px;
            padding: 16px;
            margin: 10px 0;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }
        
        .message-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .message-card-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark);
        }
        
        .message-card-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .message-muted {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 4px;
        }
        
        .message-badge {
            display: inline-block;
            padding: 2px 8px;
            background-color: var(--primary);
            color: white;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 6px;
        }
        
        .message-badge-warning {
            background-color: var(--warning);
        }
        
        .message-badge-danger {
            background-color: var(--danger);
        }
        
        .message-badge-success {
            background-color: var(--success);
        }
        
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0;
            justify-content: center;
        }

        .action-btn {
            padding: 10px 16px;
            background-color: var(--bot-bubble);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            transition: var(--transition);
            color: var(--dark);
            box-shadow: var(--shadow);
            font-weight: 500;
        }

        .action-btn:hover {
            background-color: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .action-btn.primary {
            background-color: var(--primary);
            color: white;
        }

        .action-btn.secondary {
            background-color: var(--secondary);
            color: white;
        }

        .action-btn.info {
            background-color: var(--light-gray);
            color: var(--dark);
        }

        .action-btn.reset {
            background-color: var(--danger);
            color: white;
        }

        .action-btn.yesterday {
            background-color: var(--warning);
            color: white;
        }

        .chat-date {
            text-align: center;
            color: var(--gray);
            font-size: 0.8rem;
            margin: 10px 0;
            position: relative;
        }
        
        .chat-date::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: var(--light-gray);
            z-index: 1;
        }
        
        .chat-date span {
            background-color: var(--chat-bg);
            padding: 0 10px;
            position: relative;
            z-index: 2;
        }
        
        .message-reaction {
            display: flex;
            justify-content: flex-end;
            margin-top: 2px;
        }

        .reaction-icon {
            font-size: 0.7rem;
            color: var(--gray);
        }

        .date-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 10px;
            background-color: var(--light-gray);
            border-radius: 8px;
        }
        
        .date-display {
            font-weight: 600;
            color: var(--dark);
        }
        
        .date-nav-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
        }
        
        .date-nav-btn:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .chatbot-container {
                height: 100vh;
            }
            
            .message-bubble {
                max-width: 85%;
            }
            
            .message-stats {
                grid-template-columns: 1fr;
            }
        }

        .typing-text {
            overflow: hidden;
            white-space: nowrap;
            animation: typing 3.5s steps(40, end);
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: var(--light);
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--dark);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .task-card {
            background-color: var(--light-gray);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--light-gray);
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .task-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .task-icon-large {
            font-size: 1.5rem;
        }

        .task-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .task-description {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .task-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid var(--light-gray);
            background-color: var(--light);
            color: var(--dark);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.2);
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .modal-footer {
            padding: 1.2rem 1.5rem;
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background-color: var(--gray);
            color: white;
        }
    </style>
</head>
<body>
    <div class="chatbot-container">
        <div class="chatbot-header">
            <div class="header-left">
                <div class="bot-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="header-info">
                    <h1>StudyFlow Assistant</h1>
                    <p><span class="status-dot"></span> Online 窶｢ Seu assistente de estudos</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="header-btn" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="header-btn" id="infoBtn">
                    <i class="fas fa-info"></i>
                </button>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <!-- Mensagens serﾃ｣o adicionadas dinamicamente -->
        </div>

        <div class="chatbot-input">
            <div class="input-actions">
                <button class="input-btn" id="attachBtn">
                    <i class="fas fa-paperclip"></i>
                </button>
                <button class="input-btn" id="emojiBtn">
                    <i class="far fa-smile"></i>
                </button>
            </div>
            <input type="text" id="messageInput" placeholder="Digite uma mensagem...">
            <button class="send-btn" id="sendMessage">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Modal de Registro Dinﾃ｢mico -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> Registrar Atividades</h3>
                <button class="close-modal" id="closeRegisterModal">&times;</button>
            </div>
            <div class="modal-body" id="registerModalBody">
                <!-- Conteﾃｺdo dinﾃ｢mico serﾃ｡ inserido aqui -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelRegister">Cancelar</button>
                <button class="btn btn-primary" id="saveRegister">Salvar Tudo</button>
            </div>
        </div>
    </div>

    <!-- Modal de Configuraﾃｧﾃ｣o de Matﾃｩrias por Dia -->
    <div class="modal" id="configModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Configurar Matﾃｩrias por Dia</h3>
                <button class="close-modal" id="closeConfigModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="materiasPorDia">Quantidade de matﾃｩrias por dia:</label>
                    <input type="number" id="materiasPorDia" min="1" max="5" value="1">
                </div>
                <div class="message-muted">
                    Esta configuraﾃｧﾃ｣o define quantas matﾃｩrias serﾃ｣o mostradas no resumo diﾃ｡rio.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelConfig">Cancelar</button>
                <button class="btn btn-primary" id="saveConfig">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        // Classe principal do ChatBot
        class StudyFlowChatBot {
            constructor() {
                this.currentTheme = localStorage.getItem('theme') || 'light';
                // Limitar histﾃｳrico para apenas 3 mensagens
                this.chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
                if (this.chatHistory.length > 3) {
                    this.chatHistory = this.chatHistory.slice(-3);
                }
                this.messageIds = new Set(); // Para evitar duplicaﾃｧﾃ｣o
                
                // Configuraﾃｧﾃ｣o de matﾃｩrias por dia
                this.materiasPorDia = parseInt(localStorage.getItem('studyFlow_materiasPorDia')) || 1;
                
                // NOVAS VARIﾃ〃EIS PARA CONTROLE DE DATA
                this.currentViewDate = this.getDynamicDateString(); // Data sendo visualizada
                this.isRetroactiveMode = false; // Modo de registro retroativo
                
                this.init();
            }

            // FUNﾃﾃグ ADICIONADA PARA CORRIGIR O ERRO
            formatTime(date) {
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                return `${hours}:${minutes}`;
            }

            // NOVA FUNﾃﾃグ: Obter data de ontem
            getYesterdayDateString() {
                const hoje = new Date();
                const ontem = new Date(hoje);
                ontem.setDate(hoje.getDate() - 1);
                const year = ontem.getFullYear();
                const month = String(ontem.getMonth() + 1).padStart(2, '0');
                const day = String(ontem.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            // NOVA FUNﾃﾃグ: Verificar se ﾃｩ possﾃｭvel registrar para ontem
            canRegisterYesterday() {
                const hojeStr = this.getDynamicDateString();
                const ontemStr = this.getYesterdayDateString();
                
                // Verificar se jﾃ｡ registrou hoje - se sim, nﾃ｣o pode registrar ontem
                if (this.hasRegisteredForDate(hojeStr)) {
                    return false;
                }
                
                // Verificar se jﾃ｡ registrou para ontem
                if (this.hasRegisteredForDate(ontemStr)) {
                    return false;
                }
                
                // Verificar se existe memﾃｳria das tarefas de ontem
                const yesterdayMemory = this.getDateMemory(ontemStr);
                return yesterdayMemory && yesterdayMemory.tasks;
            }

            // NOVA FUNﾃﾃグ: Obter memﾃｳria de uma data especﾃｭfica
            getDateMemory(dateString) {
                return JSON.parse(localStorage.getItem(`studyFlow_memory_${dateString}`));
            }

            // NOVA FUNﾃﾃグ: Salvar memﾃｳria para uma data especﾃｭfica
            saveDateMemory(dateString, data) {
                localStorage.setItem(`studyFlow_memory_${dateString}`, JSON.stringify(data));
            }

            // NOVA FUNﾃﾃグ: Verificar se jﾃ｡ registrou para uma data especﾃｭfica
            hasRegisteredForDate(dateString) {
                const dailyActivities = JSON.parse(localStorage.getItem('dailyActivities')) || {};
                return dailyActivities.date === dateString;
            }

            // NOVA FUNﾃﾃグ: Carregar memﾃｳria das datas ao inicializar
            initDateMemory() {
                const hojeStr = this.getDynamicDateString();
                const ontemStr = this.getYesterdayDateString();
                
                // Garantir que temos memﾃｳria do dia atual
                if (!this.getDateMemory(hojeStr)) {
                    const todayTasks = this.getDateTasks(hojeStr);
                    this.saveDateMemory(hojeStr, {
                        tasks: todayTasks,
                        savedAt: new Date().toISOString()
                    });
                }
                
                // Manter memﾃｳria de ontem (se existir)
                const yesterdayMemory = this.getDateMemory(ontemStr);
                if (yesterdayMemory) {
                    // Verificar se a memﾃｳria ﾃｩ muito antiga (mais de 3 dias)
                    const memoryDate = new Date(yesterdayMemory.savedAt);
                    const hoje = new Date();
                    const diffDays = Math.floor((hoje - memoryDate) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays > 3) {
                        localStorage.removeItem(`studyFlow_memory_${ontemStr}`);
                    }
                }
            }

            init() {
                this.initTheme();
                this.initDateMemory(); // NOVA LINHA
                this.initChat();
                this.initEventListeners();
                this.showWelcomeMessage();
            }

            initTheme() {
                if (this.currentTheme === 'dark') {
                    document.body.classList.add('dark-theme');
                    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
                }
            }

            initChat() {
                // Carregar histﾃｳrico do chat
                if (this.chatHistory.length > 0) {
                    this.chatHistory.forEach(msg => {
                        this.addMessageToChat(msg.content, msg.isUser, msg.timestamp);
                    });
                }
            }

            initEventListeners() {
                // Toggle de tema
                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());
                
                // Botﾃ｣o de info
                document.getElementById('infoBtn').addEventListener('click', () => this.showInfo());
                
                // Enviar mensagem
                document.getElementById('sendMessage').addEventListener('click', () => this.sendMessage());
                document.getElementById('messageInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });
                
                // Botﾃｵes de aﾃｧﾃ｣o rﾃ｡pida
                document.getElementById('attachBtn').addEventListener('click', () => this.showQuickActions());
                document.getElementById('emojiBtn').addEventListener('click', () => this.toggleEmojiPicker());
                
                // Modal de registro
                document.getElementById('closeRegisterModal').addEventListener('click', () => this.closeRegisterModal());
                document.getElementById('cancelRegister').addEventListener('click', () => this.closeRegisterModal());
                document.getElementById('saveRegister').addEventListener('click', () => this.saveAllTasks());
                
                // Modal de configuraﾃｧﾃ｣o
                document.getElementById('closeConfigModal').addEventListener('click', () => this.closeConfigModal());
                document.getElementById('cancelConfig').addEventListener('click', () => this.closeConfigModal());
                document.getElementById('saveConfig').addEventListener('click', () => this.saveConfig());
                
                // Fechar modal ao clicar fora
                window.addEventListener('click', (e) => {
                    const registerModal = document.getElementById('registerModal');
                    const configModal = document.getElementById('configModal');
                    if (e.target === registerModal) {
                        this.closeRegisterModal();
                    }
                    if (e.target === configModal) {
                        this.closeConfigModal();
                    }
                });
            }

            showWelcomeMessage() {
                if (this.chatHistory.length === 0) {
                    // Adicionar data atual
                    this.addDateDivider();
                    
                    this.typeMessage("Olﾃ｡! Sou seu assistente de estudos do StudyFlow. 窓", () => {
                        setTimeout(() => {
                            this.typeMessage("Posso te ajudar a gerenciar seu ciclo de estudos, mostrar tarefas diﾃ｡rias, registrar progresso e muito mais!", () => {
                                setTimeout(() => {
                                    this.addQuickActions();
                                }, 500);
                            });
                        }, 500);
                    });
                }
            }

            addQuickActions() {
                const canRegisterYesterday = this.canRegisterYesterday();
                
                const quickActionsHTML = `
                    <div class="quick-actions">
                        <button class="action-btn primary" onclick="chatBot.showDailySummary()">
                            <i class="fas fa-calendar-day"></i> Resumo do Dia
                        </button>
                        <button class="action-btn secondary" onclick="chatBot.openRegisterModal()">
                            <i class="fas fa-plus-circle"></i> Registrar Hoje
                        </button>
                        ${canRegisterYesterday ? `
                        <button class="action-btn yesterday" onclick="chatBot.openRegisterModal('${this.getYesterdayDateString()}')">
                            <i class="fas fa-history"></i> Registrar Ontem
                        </button>
                        ` : ''}
                        <button class="action-btn info" onclick="chatBot.showEditalMenu()">
                            <i class="fas fa-file-alt"></i> Edital
                        </button>
                        <button class="action-btn info" onclick="chatBot.showSimuladosMenu()">
                            <i class="fas fa-chart-line"></i> Simulados
                        </button>
                        <button class="action-btn info" onclick="chatBot.showConfigModal()">
                            <i class="fas fa-cog"></i> Configurar
                        </button>
                        <button class="action-btn info" onclick="chatBot.showHelp()">
                            <i class="fas fa-question-circle"></i> Ajuda
                        </button>
                        <button class="action-btn reset" onclick="chatBot.showResetConfirmation()">
                            <i class="fas fa-exclamation-triangle"></i> Reset
                        </button>
                    </div>
                `;
                
                this.addBotMessage(quickActionsHTML, false);
            }

            // FUNﾃﾃグ ATUALIZADA: Reset para mﾃｳdulo Chatbot
            showResetConfirmation() {
                const confirmationHTML = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-exclamation-triangle" style="color: var(--danger)"></i>
                            <div class="message-card-title">Reset Temporﾃ｡rio</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-alert message-alert-danger">
                                <i class="fas fa-exclamation-circle"></i>
                                <div><strong>Atenﾃｧﾃ｣o!</strong> Esta funﾃｧﾃ｣o executa um reset temporﾃ｡rio do mﾃｳdulo do Chatbot, ﾃｺtil para corrigir travamentos ou inconsistﾃｪncias nos dados do dia. Nenhum outro mﾃｳdulo serﾃ｡ afetado. Deseja continuar?</div>
                            </div>
                            <div class="quick-actions">
                                <button class="action-btn reset" onclick="chatBot.resetChatbotData()">
                                    <i class="fas fa-sync-alt"></i> Confirmar Reset
                                </button>
                                <button class="action-btn info" onclick="chatBot.addBotMessage('Reset cancelado. O sistema permanece inalterado.', false)">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                this.addBotMessage(confirmationHTML, false);
            }

            // FUNﾃﾃグ ATUALIZADA: Reset dos dados do chatbot
            resetChatbotData() {
                const hoje = new Date();
                const hojeStr = hoje.toLocaleDateString('pt-BR');
                
                // Limpar apenas os dados especﾃｭficos do chatbot que estﾃ｣o bloqueando o dia
                localStorage.removeItem('lastRegisterDate');
                localStorage.removeItem('dailyActivities');
                
                // Mensagem de confirmaﾃｧﾃ｣o
                const successHTML = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-check-circle" style="color: var(--success)"></i>
                            <div class="message-card-title">Reset Concluﾃｭdo</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-alert message-alert-success">
                                <i class="fas fa-check-circle"></i>
                                <div><strong>Reset realizado com sucesso!</strong> Dados do mﾃｳdulo Chatbot reiniciados em ${hojeStr}.</div>
                            </div>
                            <div class="message-text">
                                Agora vocﾃｪ pode visualizar e registrar as atividades reais do dia.
                                O sistema voltarﾃ｡ a funcionar normalmente a partir de amanhﾃ｣.
                            </div>
                            <div class="quick-actions">
                                <button class="action-btn primary" onclick="chatBot.showDailySummary()">
                                    <i class="fas fa-calendar-day"></i> Ver Resumo do Dia
                                </button>
                                <button class="action-btn secondary" onclick="chatBot.openRegisterModal()">
                                    <i class="fas fa-plus-circle"></i> Registrar Atividades
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                this.addBotMessage(successHTML, false);
            }

            // CORREﾃﾃグ PARA O PROBLEMA DA DATA - FUNﾃﾃ髭S NOVAS
            getDynamicDateString() {
                // SEMPRE retorna a data atual do sistema
                const hoje = new Date();
                const year = hoje.getFullYear();
                const month = String(hoje.getMonth() + 1).padStart(2, '0');
                const day = String(hoje.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            getDynamicDateObject() {
                // SEMPRE retorna o objeto Date atual
                return new Date();
            }

            formatDynamicDate(date) {
                // Formata a data para exibiﾃｧﾃ｣o
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('pt-BR', options);
            }

            // CORREﾃﾃグ APLICADA: Funﾃｧﾃ｣o para verificar se uma data ﾃｩ hoje
            isToday(dateString) {
                const hoje = this.getDynamicDateString();
                return dateString === hoje;
            }

            // CORREﾃﾃグ APLICADA: Funﾃｧﾃ｣o para verificar se jﾃ｡ registrou atividades HOJE
            hasRegisteredToday() {
                const lastRegisterDate = localStorage.getItem('lastRegisterDate');
                return lastRegisterDate && this.isToday(lastRegisterDate);
            }

            // FUNﾃﾃグ MODIFICADA: showDailySummary com suporte a datas especﾃｭficas
            showDailySummary(dateString = null) {
                const targetDate = dateString || this.getDynamicDateString();
                const hojeObj = new Date(targetDate + 'T00:00:00');
                const dataFormatada = this.formatDynamicDate(hojeObj);
                
                // Atualizar a data sendo visualizada
                this.currentViewDate = targetDate;
                
                // Salvar as tarefas do dia na memﾃｳria (se ainda nﾃ｣o existir)
                const memoryKey = `studyFlow_memory_${targetDate}`;
                if (!localStorage.getItem(memoryKey)) {
                    const todayTasks = this.getDateTasks(targetDate);
                    this.saveDateMemory(targetDate, {
                        tasks: todayTasks,
                        savedAt: new Date().toISOString()
                    });
                }

                if (this.hasRegisteredForDate(targetDate)) {
                    this.showDateSummary(targetDate, dataFormatada);
                } else {
                    this.showPendingTasks(targetDate, dataFormatada);
                }
            }

            // FUNﾃﾃグ MODIFICADA: showPendingTasks com suporte a datas especﾃｭficas
            showPendingTasks(dateString, dataFormatada) {
                const hoje = new Date(dateString + 'T00:00:00');
                
                // Buscar dados reais dos mﾃｳdulos
                const dailyReviewGoal = this.getModuleData('dailyReviewGoal') || 5;
                const dailyCompletedReviews = this.getModuleData('dailyCompletedReviews') || 0;

                // Calcular revisﾃｵes para hoje (usando o mesmo algoritmo do mﾃｳdulo de revisﾃｵes)
                const revisoesHoje = this.calculateDateReviews(dateString);

                // Calcular progresso da meta diﾃ｡ria
                const progressoMeta = Math.min((dailyCompletedReviews / dailyReviewGoal) * 100, 100);

                // Verificar alertas
                const alertas = this.checkAlerts();

                // Obter matﾃｩrias do ciclo - COM Mﾃ哭TIPLAS MATﾃ嘘IAS
                const materiasCiclo = this.getDateSubjects(dateString);

                // CORREﾃﾃグ APLICADA: Obter baralhos do Anki ATUALIZADOS
                const baralhosAnki = this.getDateDecks(dateString);

                // Construir o card de resumo pendente com nova formataﾃｧﾃ｣o
                let summaryHTML = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-calendar-day"></i>
                            <div class="message-card-title">Resumo do Dia - ${dataFormatada}</div>
                        </div>
                        <div class="message-card-content">
                            <!-- Progresso -->
                            <div class="message-section">
                                <div class="message-section-title">Progresso Diﾃ｡rio</div>
                                <div class="message-list">
                                    <div class="message-list-item">
                                        <div class="message-list-icon"><i class="fas fa-chart-line"></i></div>
                                        <div class="message-list-content">
                                            <div class="message-list-title">Revisﾃｵes Concluﾃｭdas</div>
                                            <div class="message-list-description">${dailyCompletedReviews}/${dailyReviewGoal} (${Math.round(progressoMeta)}% da meta)</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="message-progress">
                                    <div class="message-progress-bar">
                                        <div class="message-progress-fill" style="width: ${progressoMeta}%"></div>
                                    </div>
                                    <div class="message-progress-text">
                                        <span>0%</span>
                                        <span>${Math.round(progressoMeta)}%</span>
                                        <span>100%</span>
                                    </div>
                                </div>
                            </div>
                `;

                // Revisﾃｵes
                if (revisoesHoje.length > 0) {
                    summaryHTML += `
                        <div class="message-section">
                            <div class="message-section-title">Revisﾃｵes Pendentes</div>
                            <div class="message-list">
                    `;
                    
                    revisoesHoje.forEach(revisao => {
                        summaryHTML += `
                            <div class="message-list-item">
                                <div class="message-list-icon"><i class="fas fa-book"></i></div>
                                <div class="message-list-content">
                                    <div class="message-list-title">${revisao.nome}</div>
                                    <div class="message-list-description">${revisao.disciplina}</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    summaryHTML += `
                            </div>
                        </div>
                    `;
                } else {
                    summaryHTML += `
                        <div class="message-section">
                            <div class="message-section-title">Revisﾃｵes Pendentes</div>
                            <div class="message-alert message-alert-info">
                                <i class="fas fa-info-circle"></i>
                                <div>Nenhuma revisﾃ｣o pendente para hoje</div>
                            </div>
                        </div>
                    `;
                }

                // Matﾃｩrias - COM Mﾃ哭TIPLAS MATﾃ嘘IAS E HISTﾃ迭ICO
                summaryHTML += `
                    <div class="message-section">
                        <div class="message-section-title">Matﾃｩrias de Hoje</div>
                `;
                
                if (materiasCiclo.length > 0) {
                    summaryHTML += `<div class="message-list">`;
                    
                    materiasCiclo.forEach(materia => {
                        // Buscar o progresso salvo para esta matﾃｩria
                        const teoriaProgress = this.getModuleData('teoriaProgress');
                        const ultimoEstudo = teoriaProgress && teoriaProgress[materia];
                        
                        summaryHTML += `
                            <div class="message-list-item">
                                <div class="message-list-icon"><i class="fas fa-book"></i></div>
                                <div class="message-list-content">
                                    <div class="message-list-title">${materia}</div>
                                    ${ultimoEstudo ? 
                                        `<div class="message-list-description">
                                            ﾃ嗟timo estudo: ${ultimoEstudo.conteudo} 
                                            ${ultimoEstudo.pagina ? `(${ultimoEstudo.pagina})` : ''}
                                         </div>` : 
                                        `<div class="message-list-description">Nenhum registro anterior</div>`
                                    }
                                </div>
                            </div>
                        `;
                    });
                    
                    summaryHTML += `</div>`;
                } else {
                    summaryHTML += `
                        <div class="message-alert message-alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>Nenhuma matﾃｩria encontrada no ciclo de estudos ativo</div>
                        </div>
                    `;
                }
                
                summaryHTML += `</div>`;

                // Anki - CORREﾃﾃグ APLICADA: Usar baralhos atualizados
                summaryHTML += `
                    <div class="message-section">
                        <div class="message-section-title">Baralhos Anki</div>
                        <div class="message-list">
                `;
                
                if (baralhosAnki.length > 0) {
                    baralhosAnki.forEach(deck => {
                        summaryHTML += `
                            <div class="message-list-item">
                                <div class="message-list-icon"><i class="fas fa-layer-group"></i></div>
                                <div class="message-list-content">
                                    <div class="message-list-title">${deck}</div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    summaryHTML += `
                        <div class="message-alert message-alert-info">
                            <i class="fas fa-info-circle"></i>
                            <div>Nenhum baralho programado para hoje</div>
                        </div>
                    `;
                }
                
                summaryHTML += `
                        </div>
                    </div>
                `;

                // Alertas
                if (alertas.length > 0) {
                    summaryHTML += `
                        <div class="message-section">
                            <div class="message-section-title">Alertas</div>
                    `;
                    
                    alertas.forEach(alerta => {
                        const alertClass = `message-alert-${alerta.tipo === 'alert-danger' ? 'danger' : alerta.tipo === 'alert-warning' ? 'warning' : 'info'}`;
                        summaryHTML += `
                            <div class="message-alert ${alertClass}">
                                <i class="fas fa-${alerta.icone}"></i>
                                <div>${alerta.mensagem}</div>
                            </div>
                        `;
                    });
                    
                    summaryHTML += `</div>`;
                }

                // ADICIONAR BOTﾃグ DE REGISTRO RETROATIVO SE FOR ONTEM
                const hojeStr = this.getDynamicDateString();
                if (dateString === this.getYesterdayDateString() && !this.hasRegisteredForDate(dateString)) {
                    summaryHTML += `
                        <div class="quick-actions">
                            <button class="action-btn yesterday" onclick="chatBot.openRegisterModal('${dateString}')">
                                <i class="fas fa-history"></i> Registrar Atividades de Ontem
                            </button>
                        </div>
                    `;
                }

                summaryHTML += `
                        </div>
                    </div>
                `;

                this.addBotMessage(summaryHTML, true, `pending-summary-${dateString}`);

                // Adicionar botﾃｵes de aﾃｧﾃ｣o
                setTimeout(() => {
                    this.addBotMessage(`
                        <div class="quick-actions">
                            <button class="action-btn primary" onclick="chatBot.openRegisterModal('${dateString}')">
                                <i class="fas fa-plus-circle"></i> Registrar Atividades
                            </button>
                            <button class="action-btn info" onclick="chatBot.showHelp()">
                                <i class="fas fa-question-circle"></i> Preciso de Ajuda
                            </button>
                        </div>
                    `, false);
                }, 500);
            }

            // FUNﾃﾃグ MODIFICADA: showTodaySummary para datas especﾃｭficas
            showDateSummary(dateString, dataFormatada) {
                // Buscar atividades registradas para a data especﾃｭfica
                const dailyActivities = JSON.parse(localStorage.getItem('dailyActivities')) || { activities: {} };
                const atividades = dailyActivities.activities;

                let summaryHTML = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-calendar-day"></i>
                            <div class="message-card-title">Resumo do Dia - ${dataFormatada}</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-alert message-alert-success">
                                <i class="fas fa-check-circle"></i>
                                <div><strong>Atividades registradas com sucesso!</strong> Vocﾃｪ jﾃ｡ completou suas tarefas de hoje.</div>
                            </div>
                `;

                // Questﾃｵes
                if (atividades.questoes && atividades.questoes.length > 0) {
                    summaryHTML += `
                        <div class="message-section">
                            <div class="message-section-title">Questﾃｵes Realizadas</div>
                            <div class="message-list">
                    `;
                    
                    atividades.questoes.forEach(q => {
                        const acertos = q.feitas - q.erradas;
                        const taxaAcerto = q.feitas > 0 ? Math.round((acertos / q.feitas) * 100) : 0;
                        summaryHTML += `
                            <div class="message-list-item">
                                <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                <div class="message-list-content">
                                    <div class="message-list-title">${q.assunto}</div>
                                    <div class="message-list-description">${q.feitas} questﾃｵes 窶｢ ${taxaAcerto}% de acerto 窶｢ ${q.tempo} min</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    summaryHTML += `
                            </div>
                        </div>
                    `;
                }

                // Anki
                if (atividades.anki && atividades.anki.length > 0) {
                    summaryHTML += `
                        <div class="message-section">
                            <div class="message-section-title">Revisﾃｵes Anki</div>
                            <div class="message-list">
                    `;
                    
                    atividades.anki.forEach(a => {
                        summaryHTML += `
                            <div class="message-list-item">
                                <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                <div class="message-list-content">
                                    <div class="message-list-title">${a.deck}</div>
                                    <div class="message-list-description">${a.cards} cards revisados 窶｢ ${a.tempo} min</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    summaryHTML += `
                            </div>
                        </div>
                    `;
                }

                // Teoria
                if (atividades.teoria && atividades.teoria.length > 0) {
                    summaryHTML += `
                        <div class="message-section">
                            <div class="message-section-title">Estudo Teﾃｳrico</div>
                            <div class="message-list">
                    `;
                    
                    atividades.teoria.forEach(t => {
                        summaryHTML += `
                            <div class="message-list-item">
                                <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                <div class="message-list-content">
                                    <div class="message-list-title">${t.materia}</div>
                                    <div class="message-list-description">${t.conteudo || t.pagina || 'Estudo concluﾃｭdo'} 窶｢ ${t.tempo} min</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    summaryHTML += `
                            </div>
                        </div>
                    `;
                }

                summaryHTML += `
                        </div>
                    </div>
                `;

                this.addBotMessage(summaryHTML, true, `today-summary-${dateString}`);

                // Nﾃ｣o mostrar botﾃ｣o de registrar, pois jﾃ｡ registrou hoje
                setTimeout(() => {
                    this.addBotMessage(`
                        <div class="quick-actions">
                            <button class="action-btn info" onclick="chatBot.showHelp()">
                                <i class="fas fa-question-circle"></i> Preciso de Ajuda
                            </button>
                        </div>
                    `, false);
                }, 500);
            }

            // FUNﾃﾃグ MODIFICADA: openRegisterModal com suporte a datas especﾃｭficas
            openRegisterModal(dateString = null) {
                const targetDate = dateString || this.getDynamicDateString();
                
                // Verificar se jﾃ｡ registrou para a data alvo
                if (this.hasRegisteredForDate(targetDate)) {
                    const dataFormatada = this.formatDynamicDate(new Date(targetDate + 'T00:00:00'));
                    this.typeMessage(`Vocﾃｪ jﾃ｡ registrou suas atividades para ${dataFormatada}! 柿);
                    return;
                }
                
                // Configurar modo retroativo se for uma data passada
                this.isRetroactiveMode = dateString !== null && dateString !== this.getDynamicDateString();
                this.currentViewDate = targetDate;
                
                document.getElementById('registerModal').style.display = 'flex';
                this.loadDateTasks(targetDate);
            }

            // FUNﾃﾃグ MODIFICADA: loadTodayTasks para carregar tarefas de data especﾃｭfica
            loadDateTasks(dateString) {
                const modalBody = document.getElementById('registerModalBody');
                
                // ADICIONAR NAVEGAﾃﾃグ DE DATA NO MODAL
                const dateObj = new Date(dateString + 'T00:00:00');
                const dataFormatada = this.formatDynamicDate(dateObj);
                const hojeStr = this.getDynamicDateString();
                const ontemStr = this.getYesterdayDateString();
                
                let dateNavigation = `
                    <div class="date-navigation">
                        <div class="date-display">
                            <i class="fas fa-calendar-day"></i>
                            Registro para: ${dataFormatada}
                            ${this.isRetroactiveMode ? '<span class="message-badge message-badge-warning">Retroativo</span>' : ''}
                        </div>
                `;
                
                // Botﾃ｣o para ontem (se aplicﾃ｡vel)
                if (dateString === hojeStr && this.canRegisterYesterday()) {
                    dateNavigation += `
                        <button class="date-nav-btn" onclick="chatBot.openRegisterModal('${ontemStr}')">
                            <i class="fas fa-arrow-left"></i> Registrar Ontem
                        </button>
                    `;
                } else if (dateString === ontemStr) {
                    dateNavigation += `
                        <button class="date-nav-btn" onclick="chatBot.openRegisterModal('${hojeStr}')">
                            Registrar Hoje <i class="fas fa-arrow-right"></i>
                        </button>
                    `;
                } else {
                    dateNavigation += `<button class="date-nav-btn" disabled>Navegaﾃｧﾃ｣o</button>`;
                }
                
                dateNavigation += `</div>`;
                modalBody.innerHTML = dateNavigation;
                
                // Carregar tarefas da data especﾃｭfica
                const dateTasks = this.getDateTasks(dateString);
                
                if (dateTasks.questoes.length === 0 && dateTasks.anki.length === 0 && dateTasks.teoria.length === 0) {
                    modalBody.innerHTML += `
                        <div class="empty-state">
                            <i class="fas fa-check-circle"></i>
                            <h3>Nﾃ｣o hﾃ｡ tarefas pendentes para esta data!</h3>
                            <p>Nﾃ｣o foram encontradas atividades programadas para ${dataFormatada}.</p>
                        </div>
                    `;
                    return;
                }
                
                let tasksHTML = '<div class="tasks-grid">';
                
                dateTasks.questoes.forEach(questao => {
                    tasksHTML += this.createQuestaoCard(questao);
                });
                
                dateTasks.anki.forEach(deck => {
                    tasksHTML += this.createAnkiCard(deck);
                });
                
                dateTasks.teoria.forEach(materia => {
                    tasksHTML += this.createTeoriaCard(materia);
                });
                
                tasksHTML += '</div>';
                modalBody.innerHTML += tasksHTML;
            }

            // NOVA FUNﾃﾃグ: Obter tarefas para uma data especﾃｭfica
            getDateTasks(dateString) {
                const dateObj = new Date(dateString + 'T00:00:00');
                const tasks = {
                    questoes: [],
                    anki: [],
                    teoria: []
                };

                // Buscar assuntos para questﾃｵes da data especﾃｭfica
                tasks.questoes = this.calculateDateReviews(dateString);
                
                // Buscar baralhos do Anki para a data especﾃｭfica
                tasks.anki = this.getDateDecks(dateString).map(deckName => ({
                    id: deckName,
                    nome: deckName,
                    emoji: '煤'
                }));

                // Buscar matﾃｩrias de teoria para a data especﾃｭfica
                tasks.teoria = this.getDateSubjects(dateString);

                return tasks;
            }

            // NOVA FUNﾃﾃグ: Calcular revisﾃｵes para uma data especﾃｭfica
            calculateDateReviews(dateString) {
                // Implementaﾃｧﾃ｣o similar ﾃ calculateTodayReviews, mas considerando a data especﾃｭfica
                const disciplines = this.getModuleData('disciplines');
                const dailyReviewGoal = this.getModuleData('dailyReviewGoal') || 5;
                
                if (!disciplines || !Array.isArray(disciplines)) return [];
                
                const targetDate = new Date(dateString + 'T00:00:00').getTime();
                let pendingTopics = [];
                
                disciplines.forEach(disciplina => {
                    if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) {
                        disciplina.assuntos.forEach(assunto => {
                            if (assunto.suspended) return;
                            
                            if (assunto.nextReviewDate && assunto.nextReviewDate <= targetDate) {
                                const daysOverdue = Math.max(0, Math.floor((targetDate - assunto.nextReviewDate) / (1000 * 60 * 60 * 24)));
                                let avgDifficulty = 2;
                                if (assunto.difficultyHistory && assunto.difficultyHistory.length > 0) {
                                    avgDifficulty = assunto.difficultyHistory.reduce((a, b) => a + b, 0) / assunto.difficultyHistory.length;
                                }
                                const difficultyScore = (3 - avgDifficulty);
                                const importance = assunto.importance || 3;
                                const priority = (difficultyScore * 40) + (daysOverdue * 60) + (importance * 20);
                                
                                pendingTopics.push({
                                    id: assunto.nome,
                                    nome: assunto.nome,
                                    disciplina: disciplina.name,
                                    priority: priority,
                                    daysOverdue: daysOverdue,
                                    difficulty: avgDifficulty,
                                    importance: importance
                                });
                            }
                        });
                    }
                });
                
                pendingTopics.sort((a, b) => b.priority - a.priority);
                return pendingTopics.slice(0, dailyReviewGoal);
            }

            // NOVA FUNﾃﾃグ: Obter baralhos do Anki para uma data especﾃｭfica
            getDateDecks(dateString) {
                // Implementaﾃｧﾃ｣o similar ﾃ getTodayDecks, mas calculando com base na data
                const ankiData = this.getModuleData('ciclos_focus_v1');
                if (!ankiData || !ankiData.decks || !ankiData.perDay) return [];
                
                const perDay = ankiData.perDay;
                // Calcular blockIndex baseado na data (simplificado)
                const startDate = new Date(ankiData.startDate || dateString);
                const targetDate = new Date(dateString + 'T00:00:00');
                const diffTime = targetDate - startDate;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                const blockIndex = Math.floor(diffDays / (ankiData.decks.length / perDay));
                
                const startIndex = blockIndex * perDay;
                const dateDecks = ankiData.decks.slice(startIndex, startIndex + perDay);
                
                return dateDecks.map(deck => deck.name);
            }

            // NOVA FUNﾃﾃグ: Obter matﾃｩrias para uma data especﾃｭfica
            getDateSubjects(dateString) {
                const activeCycle = this.getActiveCycle();
                if (!activeCycle || !activeCycle.generatedCycle) {
                    return [];
                }
                
                // Calcular ﾃｭndice baseado na data (simplificado)
                const startDate = new Date(activeCycle.startDate || dateString);
                const targetDate = new Date(dateString + 'T00:00:00');
                const diffTime = targetDate - startDate;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                const todayIndex = diffDays;
                const materiasPorDia = this.materiasPorDia || 1;
                let subjects = [];
                
                const cycleLength = activeCycle.generatedCycle.length;
                if (cycleLength === 0) {
                    return [];
                }
                
                const adjustedIndex = todayIndex % cycleLength;
                
                for (let i = 0; i < materiasPorDia; i++) {
                    const index = (adjustedIndex + i) % cycleLength;
                    let subject = activeCycle.generatedCycle[index];
                    
                    if (Array.isArray(subject)) {
                        subject = subject.join(', ');
                    }
                    
                    if (subject && !subject.includes('Revisﾃ｣o') && !subject.includes('Simulado')) {
                        subjects.push(subject);
                    }
                }
                
                return subjects;
            }

            // MODIFICAR A FUNﾃﾃグ addDateDivider (substituir a existente)
            addDateDivider() {
                const hoje = this.getDynamicDateObject(); // SEMPRE usa data atual
                const dataFormatada = this.formatDynamicDate(hoje);
                
                const chatMessages = document.getElementById('chatMessages');
                const dateDiv = document.createElement('div');
                dateDiv.className = 'chat-date';
                dateDiv.innerHTML = `<span>${dataFormatada}</span>`;
                chatMessages.appendChild(dateDiv);
            }

            // Modal de configuraﾃｧﾃ｣o
            showConfigModal() {
                document.getElementById('configModal').style.display = 'flex';
                document.getElementById('materiasPorDia').value = this.materiasPorDia;
            }

            closeConfigModal() {
                document.getElementById('configModal').style.display = 'none';
            }

            saveConfig() {
                const materiasPorDia = parseInt(document.getElementById('materiasPorDia').value);
                if (materiasPorDia >= 1 && materiasPorDia <= 5) {
                    this.materiasPorDia = materiasPorDia;
                    localStorage.setItem('studyFlow_materiasPorDia', materiasPorDia.toString());
                    this.closeConfigModal();
                    this.typeMessage(`Configuraﾃｧﾃ｣o salva! Agora vocﾃｪ verﾃ｡ ${materiasPorDia} matﾃｩria(s) por dia.`);
                } else {
                    alert('Por favor, informe um nﾃｺmero entre 1 e 5.');
                }
            }

            // CORREﾃﾃグ APLICADA: Funﾃｧﾃ｣o para obter baralhos do Anki atualizados
            getTodayDecks() {
                const ankiData = this.getModuleData('ciclos_focus_v1');
                if (!ankiData || !ankiData.decks || !ankiData.perDay) return [];
                
                const perDay = ankiData.perDay;
                const blockIndex = ankiData.blockIndex || 0;
                
                // Calcular os baralhos do dia atual baseado no blockIndex atual
                const startIndex = blockIndex * perDay;
                const todayDecks = ankiData.decks.slice(startIndex, startIndex + perDay);
                
                // Retornar apenas os nomes dos baralhos
                return todayDecks.map(deck => deck.name);
            }

            // CORREﾃﾃグ APLICADA: Funﾃｧﾃ｣o para obter tarefas do dia atualizada
            getTodayTasks() {
                const hoje = new Date();
                const hojeStr = hoje.toISOString().split('T')[0];
                const tasks = {
                    questoes: [],
                    anki: [],
                    teoria: []
                };

                // Buscar assuntos para questﾃｵes de hoje (revisﾃ｣o) - APENAS AS DO DIA
                tasks.questoes = this.calculateTodayReviews();
                
                // CORREﾃﾃグ APLICADA: Buscar baralhos do Anki para hoje (atualizados)
                tasks.anki = this.getTodayDecks().map(deckName => ({
                    id: deckName,
                    nome: deckName,
                    emoji: '煤'
                }));

                // Buscar matﾃｩrias de teoria para hoje (ciclo teﾃｳrico) - COM Mﾃ哭TIPLAS MATﾃ嘘IAS
                const activeCycle = this.getActiveCycle();
                if (activeCycle && activeCycle.generatedCycle) {
                    // Obter as prﾃｳximas matﾃｩrias baseado na configuraﾃｧﾃ｣o
                    tasks.teoria = this.getTodaySubjects();
                }

                return tasks;
            }

            addMessageToChat(content, isUser = false, timestamp = null, messageId = null) {
                // Verificar se a mensagem jﾃ｡ foi exibida (evitar duplicaﾃｧﾃ｣o)
                if (messageId && this.messageIds.has(messageId)) {
                    return;
                }
                
                if (messageId) {
                    this.messageIds.add(messageId);
                }
                
                const chatMessages = document.getElementById('chatMessages');
                const messageContainer = document.createElement('div');
                messageContainer.className = `message-container ${isUser ? 'user-container' : 'bot-container'}`;
                
                if (!isUser) {
                    const avatar = document.createElement('div');
                    avatar.className = 'avatar bot-avatar-small';
                    avatar.innerHTML = '<i class="fas fa-robot"></i>';
                    messageContainer.appendChild(avatar);
                }
                
                const messageBubble = document.createElement('div');
                messageBubble.className = `message-bubble ${isUser ? 'user-bubble' : 'bot-bubble'}`;
                
                // Processar markdown simples (substituir *texto* por <strong>texto</strong>)
                const processedContent = this.parseMarkdown(content);
                
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                messageContent.innerHTML = processedContent;
                
                const messageTime = document.createElement('div');
                messageTime.className = 'bubble-time';
                messageTime.textContent = timestamp ? this.formatTime(new Date(timestamp)) : this.formatTime(new Date());
                
                messageBubble.appendChild(messageContent);
                messageBubble.appendChild(messageTime);
                
                // Adicionar reaﾃｧﾃ｣o para mensagens do usuﾃ｡rio
                if (isUser) {
                    const reaction = document.createElement('div');
                    reaction.className = 'message-reaction';
                    reaction.innerHTML = '<span class="reaction-icon"><i class="fas fa-check-double"></i></span>';
                    messageBubble.appendChild(reaction);
                }
                
                messageContainer.appendChild(messageBubble);
                
                if (isUser) {
                    const avatar = document.createElement('div');
                    avatar.className = 'avatar user-avatar-small';
                    avatar.innerHTML = '<i class="fas fa-user"></i>';
                    messageContainer.appendChild(avatar);
                }
                
                chatMessages.appendChild(messageContainer);
                
                // Scroll para a ﾃｺltima mensagem
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Salvar no histﾃｳrico (limitado a 3 mensagens)
                this.chatHistory.push({
                    content: content,
                    isUser: isUser,
                    timestamp: timestamp || new Date().toISOString()
                });
                
                // Manter apenas as ﾃｺltimas 3 mensagens
                if (this.chatHistory.length > 3) {
                    this.chatHistory = this.chatHistory.slice(-3);
                }
                
                localStorage.setItem('chatHistory', JSON.stringify(this.chatHistory));
            }

            // Funﾃｧﾃ｣o para parsear markdown simples
            parseMarkdown(text) {
                // Substituir *texto* por <strong>texto</strong>
                return text.replace(/\*(.*?)\*/g, '<strong>$1</strong>');
            }

            addBotMessage(content, saveToHistory = true, messageId = null) {
                if (saveToHistory) {
                    this.addMessageToChat(content, false, null, messageId);
                } else {
                    // Nﾃ｣o salva no histﾃｳrico para mensagens de interface
                    const chatMessages = document.getElementById('chatMessages');
                    const messageContainer = document.createElement('div');
                    messageContainer.className = 'message-container bot-container';
                    
                    const avatar = document.createElement('div');
                    avatar.className = 'avatar bot-avatar-small';
                    avatar.innerHTML = '<i class="fas fa-robot"></i>';
                    messageContainer.appendChild(avatar);
                    
                    const messageBubble = document.createElement('div');
                    messageBubble.className = 'message-bubble bot-bubble';
                    
                    // Processar markdown
                    const processedContent = this.parseMarkdown(content);
                    
                    const messageContent = document.createElement('div');
                    messageContent.className = 'message-content';
                    messageContent.innerHTML = processedContent;
                    
                    const messageTime = document.createElement('div');
                    messageTime.className = 'bubble-time';
                    messageTime.textContent = this.formatTime(new Date());
                    
                    messageBubble.appendChild(messageContent);
                    messageBubble.appendChild(messageTime);
                    messageContainer.appendChild(messageBubble);
                    
                    chatMessages.appendChild(messageContainer);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }

            typeMessage(text, callback = null, messageId = null) {
                const chatMessages = document.getElementById('chatMessages');
                const messageContainer = document.createElement('div');
                messageContainer.className = 'message-container bot-container';
                
                const avatar = document.createElement('div');
                    avatar.className = 'avatar bot-avatar-small';
                    avatar.innerHTML = '<i class="fas fa-robot"></i>';
                    messageContainer.appendChild(avatar);
                    
                const messageBubble = document.createElement('div');
                messageBubble.className = 'message-bubble bot-bubble';
                
                // Processar markdown
                const processedText = this.parseMarkdown(text);
                
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                messageContent.innerHTML = `<span class="typing-text">${processedText}</span>`;
                
                const messageTime = document.createElement('div');
                messageTime.className = 'bubble-time';
                messageTime.textContent = this.formatTime(new Date());
                
                messageBubble.appendChild(messageContent);
                messageBubble.appendChild(messageTime);
                messageContainer.appendChild(messageBubble);
                
                chatMessages.appendChild(messageContainer);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Salvar no histﾃｳrico - CORRIGIDO
                this.chatHistory.push({
                    content: text,
                    isUser: false,
                    timestamp: new Date().toISOString()
                });
                
                // Manter apenas as ﾃｺltimas 3 mensagens
                if (this.chatHistory.length > 3) {
                    this.chatHistory = this.chatHistory.slice(-3);
                }
                
                localStorage.setItem('chatHistory', JSON.stringify(this.chatHistory));
                
                // Chamar callback apﾃｳs a animaﾃｧﾃ｣o
                if (callback) {
                    setTimeout(callback, text.length * 30 + 300);
                }
            }

            showTypingIndicator() {
                const chatMessages = document.getElementById('chatMessages');
                const messageContainer = document.createElement('div');
                messageContainer.className = 'message-container bot-container';
                
                const avatar = document.createElement('div');
                avatar.className = 'avatar bot-avatar-small';
                avatar.innerHTML = '<i class="fas fa-robot"></i>';
                messageContainer.appendChild(avatar);
                
                const typingBubble = document.createElement('div');
                typingBubble.className = 'typing-indicator';
                typingBubble.id = 'typingIndicator';
                
                typingBubble.innerHTML = `
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                `;
                
                messageContainer.appendChild(typingBubble);
                chatMessages.appendChild(messageContainer);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            hideTypingIndicator() {
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.parentElement.remove();
                }
            }

            sendMessage() {
                const input = document.getElementById('messageInput');
                const message = input.value.trim();
                
                if (message) {
                    this.addUserMessage(message);
                    input.value = '';
                    
                    // Simular resposta do bot
                    this.showTypingIndicator();
                    setTimeout(() => {
                        this.hideTypingIndicator();
                        this.processUserMessage(message);
                    }, 1000 + Math.random() * 1000);
                }
            }

            processUserMessage(message) {
                const lowerMessage = message.toLowerCase();
                
                if (lowerMessage.includes('resumo') || lowerMessage.includes('como estou') || lowerMessage.includes('tarefas')) {
                    this.showDailySummary();
                } else if (lowerMessage.includes('registrar') || lowerMessage.includes('adicionar')) {
                    this.openRegisterModal();
                } else if (lowerMessage.includes('configurar') || lowerMessage.includes('config')) {
                    this.showConfigModal();
                } else if (lowerMessage.includes('ajuda') || lowerMessage.includes('comandos')) {
                    this.showHelp();
                } else if (lowerMessage.includes('info') || lowerMessage.includes('sobre')) {
                    this.showInfo();
                } else if (lowerMessage.includes('edital')) {
                    this.showEditalMenu();
                } else if (lowerMessage.includes('simulado')) {
                    this.showSimuladosMenu();
                } else if (lowerMessage.includes('reset')) {
                    this.showResetConfirmation();
                } else {
                    // Resposta padrﾃ｣o
                    this.typeMessage("Entendi sua mensagem! Posso te ajudar com:\n\n窶｢ <strong>Resumo do dia</strong>\n窶｢ <strong>Registrar atividades</strong>\n窶｢ <strong>Edital</strong>\n窶｢ <strong>Simulados</strong>\n窶｢ <strong>Configuraﾃｧﾃｵes</strong>\n窶｢ <strong>Ajuda e informaﾃｧﾃｵes</strong>\n\nO que vocﾃｪ gostaria de fazer?");
                }
            }

            showHelp() {
                const helpCard = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-question-circle"></i>
                            <div class="message-card-title">Como posso ajudﾃ｡-lo?</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-list">
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-calendar-day"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Resumo do dia</div>
                                        <div class="message-list-description">Mostrar tarefas e progresso atual</div>
                                    </div>
                                </div>
                                
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-plus-circle"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Registrar atividades</div>
                                        <div class="message-list-description">Questﾃｵes, Anki ou teoria</div>
                                    </div>
                                </div>
                                
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-file-alt"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Edital</div>
                                        <div class="message-list-description">Ver progresso no edital completo ou por matﾃｩria</div>
                                    </div>
                                </div>
                                
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-chart-line"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Simulados</div>
                                        <div class="message-list-description">Ver notas e relatﾃｳrios de simulados</div>
                                    </div>
                                </div>
                                
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-cog"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Configurar</div>
                                        <div class="message-list-description">Ajustar quantidade de matﾃｩrias por dia</div>
                                    </div>
                                </div>
                                
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-question-circle"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Ajuda</div>
                                        <div class="message-list-description">Mostrar esta mensagem de ajuda</div>
                                    </div>
                                </div>
                                
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-info"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Informaﾃｧﾃｵes</div>
                                        <div class="message-list-description">Sobre o StudyFlow</div>
                                    </div>
                                </div>

                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-exclamation-triangle"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Reset</div>
                                        <div class="message-list-description">Funﾃｧﾃ｣o temporﾃ｡ria para corrigir travamentos</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.addBotMessage(helpCard, true, 'help-message');
            }

            showInfo() {
                const infoCard = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-info-circle"></i>
                            <div class="message-card-title">Sobre o StudyFlow</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-text">
                                O StudyFlow ﾃｩ seu assistente pessoal de estudos, integrando todas as suas ferramentas de aprendizado em um sﾃｳ lugar.
                            </div>
                            <div class="message-muted" style="margin-top: 10px">
                                Comigo vocﾃｪ pode:
                            </div>
                            <div class="message-list" style="margin-top: 8px">
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Gerenciar seu ciclo de estudos</div>
                                    </div>
                                </div>
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Registrar questﾃｵes e revisﾃｵes</div>
                                    </div>
                                </div>
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Acompanhar seu progresso no edital</div>
                                    </div>
                                </div>
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Analisar desempenho em simulados</div>
                                    </div>
                                </div>
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Receber alertas e lembretes</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.addBotMessage(infoCard, true, 'info-message');
            }

            showQuickActions() {
                const canRegisterYesterday = this.canRegisterYesterday();
                
                this.addBotMessage(`
                    <div class="quick-actions">
                        <button class="action-btn primary" onclick="chatBot.showDailySummary()">
                            <i class="fas fa-calendar-day"></i> Resumo do Dia
                        </button>
                        <button class="action-btn secondary" onclick="chatBot.openRegisterModal()">
                            <i class="fas fa-plus-circle"></i> Registrar Hoje
                        </button>
                        ${canRegisterYesterday ? `
                        <button class="action-btn yesterday" onclick="chatBot.openRegisterModal('${this.getYesterdayDateString()}')">
                            <i class="fas fa-history"></i> Registrar Ontem
                        </button>
                        ` : ''}
                        <button class="action-btn info" onclick="chatBot.showEditalMenu()">
                            <i class="fas fa-file-alt"></i> Edital
                        </button>
                        <button class="action-btn info" onclick="chatBot.showSimuladosMenu()">
                            <i class="fas fa-chart-line"></i> Simulados
                        </button>
                        <button class="action-btn info" onclick="chatBot.showConfigModal()">
                            <i class="fas fa-cog"></i> Configurar
                        </button>
                        <button class="action-btn info" onclick="chatBot.showHelp()">
                            <i class="fas fa-question-circle"></i> Ajuda
                        </button>
                        <button class="action-btn info" onclick="chatBot.showInfo()">
                            <i class="fas fa-info"></i> Informaﾃｧﾃｵes
                        </button>
                        <!-- BOTﾃグ DE RESET ATUALIZADO -->
                        <button class="action-btn reset" onclick="chatBot.showResetConfirmation()">
                            <i class="fas fa-exclamation-triangle"></i> Reset
                        </button>
                    </div>
                `, false);
            }

            toggleEmojiPicker() {
                // Implementaﾃｧﾃ｣o bﾃ｡sica de emoji picker
                const emojis = ["", "総", "笶､ｸ", "櫨", "箝", "答", "識", "庁", "噫", "笨"];
                let emojiHTML = '<div class="quick-actions">';
                emojis.forEach(emoji => {
                    emojiHTML += `<button class="action-btn" onclick="chatBot.addEmoji('${emoji}')">${emoji}</button>`;
                });
                emojiHTML += '</div>';
                
                this.addBotMessage(emojiHTML, false);
            }

            addEmoji(emoji) {
                const input = document.getElementById('messageInput');
                input.value += emoji;
                input.focus();
            }

            // Funﾃｧﾃｵes para o mﾃｳdulo Edital
            showEditalMenu() {
                const editalData = this.getEditalData();
                
                if (!editalData) {
                    this.typeMessage("Nﾃ｣o encontrei dados do edital verticalizado. Verifique se vocﾃｪ jﾃ｡ importou um edital no mﾃｳdulo correspondente.");
                    return;
                }
                
                this.addBotMessage(`
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-file-alt"></i>
                            <div class="message-card-title">Progresso no Edital</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-text">
                                Vocﾃｪ quer ver seu progresso no edital completo ou em uma matﾃｩria especﾃｭfica?
                            </div>
                            <div class="quick-actions" style="margin-top: 12px">
                                <button class="action-btn primary" onclick="chatBot.showEditalCompleto()">
                                    <i class="fas fa-chart-pie"></i> Todo o Edital
                                </button>
                                <button class="action-btn secondary" onclick="chatBot.showMateriasEdital()">
                                    <i class="fas fa-book"></i> Matﾃｩria Especﾃｭfica
                                </button>
                            </div>
                        </div>
                    </div>
                `, true, 'edital-menu');
            }

            getEditalData() {
                try {
                    // Buscar dados do mﾃｳdulo de edital verticalizado
                    const editais = JSON.parse(localStorage.getItem('editais'));
                    const editalAtivoId = localStorage.getItem('editalAtivoId');
                    
                    if (!editais || !editalAtivoId) {
                        return null;
                    }
                    
                    const editalAtivo = editais.find(edital => edital.id === editalAtivoId);
                    if (!editalAtivo) {
                        return null;
                    }
                    
                    // Buscar progresso do edital ativo
                    const completedTopicsKey = `completedTopics_${editalAtivoId}`;
                    const completedTopics = JSON.parse(localStorage.getItem(completedTopicsKey)) || {};
                    
                    return {
                        edital: editalAtivo,
                        progresso: completedTopics
                    };
                } catch (error) {
                    console.error('Erro ao buscar dados do edital:', error);
                    return null;
                }
            }

            showEditalCompleto() {
                const editalData = this.getEditalData();
                
                if (!editalData) {
                    this.typeMessage("Nﾃ｣o foi possﾃｭvel carregar os dados do edital.");
                    return;
                }
                
                const { edital, progresso } = editalData;
                
                // Calcular estatﾃｭsticas gerais
                let totalTopicos = 0;
                let topicosConcluidos = 0;
                
                edital.disciplinas.forEach(disciplina => {
                    disciplina.topicos.forEach(topico => {
                        totalTopicos++;
                        const chaveTopico = `${disciplina.nome}-${topico}`;
                        if (progresso[chaveTopico]) {
                            topicosConcluidos++;
                        }
                    });
                });
                
                const porcentagemTotal = totalTopicos > 0 ? Math.round((topicosConcluidos / totalTopicos) * 100) : 0;
                
                // Calcular progresso por disciplina
                const progressoDisciplinas = edital.disciplinas.map(disciplina => {
                    let topicosDisciplina = 0;
                    let concluidosDisciplina = 0;
                    
                    disciplina.topicos.forEach(topico => {
                        topicosDisciplina++;
                        const chaveTopico = `${disciplina.nome}-${topico}`;
                        if (progresso[chaveTopico]) {
                            concluidosDisciplina++;
                        }
                    });
                    
                    const porcentagem = topicosDisciplina > 0 ? Math.round((concluidosDisciplina / topicosDisciplina) * 100) : 0;
                    
                    return {
                        nome: disciplina.nome,
                        concluidos: concluidosDisciplina,
                        total: topicosDisciplina,
                        porcentagem: porcentagem
                    };
                });
                
                // Ordenar por porcentagem (menor para maior)
                progressoDisciplinas.sort((a, b) => a.porcentagem - b.porcentagem);
                
                let relatorioHTML = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-chart-pie"></i>
                            <div class="message-card-title">Progresso Geral do Edital</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-stats">
                                <div class="message-stat">
                                    <div class="message-stat-value">${porcentagemTotal}%</div>
                                    <div class="message-stat-label">Concluﾃｭdo</div>
                                </div>
                                <div class="message-stat">
                                    <div class="message-stat-value">${topicosConcluidos}/${totalTopicos}</div>
                                    <div class="message-stat-label">Tﾃｳpicos</div>
                                </div>
                            </div>
                            
                            <div class="message-progress">
                                <div class="message-progress-bar">
                                    <div class="message-progress-fill" style="width: ${porcentagemTotal}%"></div>
                                </div>
                                <div class="message-progress-text">
                                    <span>0%</span>
                                    <span>${porcentagemTotal}%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                            
                            <div class="message-section">
                                <div class="message-section-title">Progresso por Disciplina</div>
                                <div class="message-list">
                `;
                
                progressoDisciplinas.forEach(disciplina => {
                    const statusClass = disciplina.porcentagem >= 80 ? 'success' : 
                                      disciplina.porcentagem >= 50 ? 'warning' : 'danger';
                    
                    relatorioHTML += `
                        <div class="message-list-item">
                            <div class="message-list-icon"><i class="fas fa-book"></i></div>
                            <div class="message-list-content">
                                <div class="message-list-title">${disciplina.nome}</div>
                                <div class="message-list-description">
                                    ${disciplina.concluidos}/${disciplina.total} tﾃｳpicos
                                    <span class="message-badge message-badge-${statusClass}">${disciplina.porcentagem}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                relatorioHTML += `
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.addBotMessage(relatorioHTML, true, 'edital-completo');
            }

            showMateriasEdital() {
                const editalData = this.getEditalData();
                
                if (!editalData) {
                    this.typeMessage("Nﾃ｣o foi possﾃｭvel carregar os dados do edital.");
                    return;
                }
                
                const { edital } = editalData;
                
                let materiasHTML = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-book"></i>
                            <div class="message-card-title">Selecione uma Matﾃｩria</div>
                        </div>
                        <div class="message-card-content">
                            <div class="quick-actions">
                `;
                
                edital.disciplinas.forEach(disciplina => {
                    materiasHTML += `
                        <button class="action-btn info" onclick="chatBot.showEditalMateria('${disciplina.nome}')">
                            <i class="fas fa-book-open"></i> ${disciplina.nome}
                        </button>
                    `;
                });
                
                materiasHTML += `
                            </div>
                        </div>
                    </div>
                `;
                
                this.addBotMessage(materiasHTML, true, 'materias-edital');
            }

            showEditalMateria(materiaNome) {
                const editalData = this.getEditalData();
                
                if (!editalData) {
                    this.typeMessage("Nﾃ｣o foi possﾃｭvel carregar os dados do edital.");
                    return;
                }
                
                const { edital, progresso } = editalData;
                
                const disciplina = edital.disciplinas.find(d => d.nome === materiaNome);
                if (!disciplina) {
                    this.typeMessage("Matﾃｩria nﾃ｣o encontrada no edital.");
                    return;
                }
                
                // Calcular estatﾃｭsticas da disciplina
                let totalTopicos = 0;
                let topicosConcluidos = 0;
                const topicosDetalhados = [];
                
                disciplina.topicos.forEach(topico => {
                    totalTopicos++;
                    const chaveTopico = `${disciplina.nome}-${topico}`;
                    const concluido = progresso[chaveTopico] || false;
                    
                    if (concluido) {
                        topicosConcluidos++;
                    }
                    
                    topicosDetalhados.push({
                        nome: topico,
                        concluido: concluido
                    });
                });
                
                const porcentagem = totalTopicos > 0 ? Math.round((topicosConcluidos / totalTopicos) * 100) : 0;
                
                let materiaHTML = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-book-open"></i>
                            <div class="message-card-title">${disciplina.nome}</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-stats">
                                <div class="message-stat">
                                    <div class="message-stat-value">${porcentagem}%</div>
                                    <div class="message-stat-label">Concluﾃｭdo</div>
                                </div>
                                <div class="message-stat">
                                    <div class="message-stat-value">${topicosConcluidos}/${totalTopicos}</div>
                                    <div class="message-stat-label">Tﾃｳpicos</div>
                                </div>
                            </div>
                            
                            <div class="message-progress">
                                <div class="message-progress-bar">
                                    <div class="message-progress-fill" style="width: ${porcentagem}%"></div>
                                </div>
                                <div class="message-progress-text">
                                    <span>0%</span>
                                    <span>${porcentagem}%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                            
                            <div class="message-section">
                                <div class="message-section-title">Tﾃｳpicos</div>
                                <div class="message-list">
                `;
                
                topicosDetalhados.forEach(topico => {
                    const statusIcon = topico.concluido ? 'check-circle' : 'circle';
                    const statusColor = topico.concluido ? 'success' : 'gray';
                    
                    materiaHTML += `
                        <div class="message-list-item">
                            <div class="message-list-icon" style="color: var(--${statusColor})">
                                <i class="fas fa-${statusIcon}"></i>
                            </div>
                            <div class="message-list-content">
                                <div class="message-list-title">${topico.nome}</div>
                                <div class="message-list-description">
                                    ${topico.concluido ? 'Concluﾃｭdo' : 'Pendente'}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                materiaHTML += `
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.addBotMessage(materiaHTML, true, `edital-${materiaNome}`);
            }

            // Funﾃｧﾃｵes para o mﾃｳdulo Simulados
            showSimuladosMenu() {
                const simuladosData = this.getSimuladosData();
                
                if (!simuladosData || simuladosData.simulados.length === 0) {
                    this.typeMessage("Nﾃ｣o encontrei dados de simulados. Verifique se vocﾃｪ jﾃ｡ realizou algum simulado no mﾃｳdulo correspondente.");
                    return;
                }
                
                this.addBotMessage(`
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-chart-line"></i>
                            <div class="message-card-title">Anﾃ｡lise de Simulados</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-text">
                                O que vocﾃｪ gostaria de ver?
                            </div>
                            <div class="quick-actions" style="margin-top: 12px">
                                <button class="action-btn primary" onclick="chatBot.showUltimoSimuladoNota()">
                                    <i class="fas fa-star"></i> Nota do ﾃ嗟timo Simulado
                                </button>
                                <button class="action-btn secondary" onclick="chatBot.showUltimoSimuladoRelatorio()">
                                    <i class="fas fa-chart-bar"></i> Relatﾃｳrio Completo
                                </button>
                                <button class="action-btn info" onclick="chatBot.showUltimoSimuladoData()">
                                    <i class="fas fa-calendar"></i> Data do ﾃ嗟timo Simulado
                                </button>
                            </div>
                        </div>
                    </div>
                `, true, 'simulados-menu');
            }

            getSimuladosData() {
                try {
                    // Buscar dados do mﾃｳdulo de simulados
                    const simulados = JSON.parse(localStorage.getItem('simulados')) || [];
                    const provas = JSON.parse(localStorage.getItem('provas')) || [];
                    const provaAtivaId = localStorage.getItem('provaAtivaId');
                    
                    if (simulados.length === 0) {
                        return null;
                    }
                    
                    // Ordenar simulados por data (mais recente primeiro)
                    simulados.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    const ultimoSimulado = simulados[0];
                    const prova = provas.find(p => p.id === ultimoSimulado.idProva);
                    
                    return {
                        simulados: simulados,
                        ultimoSimulado: ultimoSimulado,
                        prova: prova,
                        provaAtivaId: provaAtivaId
                    };
                } catch (error) {
                    console.error('Erro ao buscar dados de simulados:', error);
                    return null;
                }
            }

            showUltimoSimuladoNota() {
                const simuladosData = this.getSimuladosData();
                
                if (!simuladosData) {
                    this.typeMessage("Nﾃ｣o foi possﾃｭvel carregar os dados dos simulados.");
                    return;
                }
                
                const { ultimoSimulado, prova } = simuladosData;
                const dataFormatada = new Date(ultimoSimulado.date).toLocaleDateString('pt-BR');
                
                // Determinar classificaﾃｧﾃ｣o baseada na porcentagem
                const porcentagem = parseFloat(ultimoSimulado.totalPercentage);
                let classificacao = '';
                let corClassificacao = '';
                
                if (porcentagem >= 90) {
                    classificacao = 'EXCELENTE';
                    corClassificacao = 'success';
                } else if (porcentagem >= 80) {
                    classificacao = 'ﾃ典IMO';
                    corClassificacao = 'primary';
                } else if (porcentagem >= 66) {
                    classificacao = 'BOM';
                    corClassificacao = 'secondary';
                } else if (porcentagem >= 51) {
                    classificacao = 'Mﾃ吋IO';
                    corClassificacao = 'warning';
                } else if (porcentagem >= 31) {
                    classificacao = 'FRACO';
                    corClassificacao = 'warning';
                } else {
                    classificacao = 'CRﾃ控ICO';
                    corClassificacao = 'danger';
                }
                
                const notaHTML = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-star"></i>
                            <div class="message-card-title">Nota do ﾃ嗟timo Simulado</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-stats">
                                <div class="message-stat">
                                    <div class="message-stat-value">${ultimoSimulado.totalScore}</div>
                                    <div class="message-stat-label">Pontuaﾃｧﾃ｣o</div>
                                </div>
                                <div class="message-stat">
                                    <div class="message-stat-value">${ultimoSimulado.totalPercentage}%</div>
                                    <div class="message-stat-label">Acertos</div>
                                </div>
                            </div>
                            
                            <div class="message-alert message-alert-${corClassificacao}">
                                <i class="fas fa-${porcentagem >= 66 ? 'check' : 'exclamation'}-circle"></i>
                                <div><strong>Classificaﾃｧﾃ｣o: ${classificacao}</strong></div>
                            </div>
                            
                            <div class="message-list">
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-calendar"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Data</div>
                                        <div class="message-list-description">${dataFormatada}</div>
                                    </div>
                                </div>
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-clock"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Tempo Total</div>
                                        <div class="message-list-description">${ultimoSimulado.totalTime} minutos</div>
                                    </div>
                                </div>
                                ${prova ? `
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-file-alt"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Prova</div>
                                        <div class="message-list-description">${prova.nomeConcurso} - ${prova.nomeBanca}</div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                this.addBotMessage(notaHTML, true, 'ultimo-simulado-nota');
            }

            showUltimoSimuladoRelatorio() {
                const simuladosData = this.getSimuladosData();
                
                if (!simuladosData) {
                    this.typeMessage("Nﾃ｣o foi possﾃｭvel carregar os dados dos simulados.");
                    return;
                }
                
                const { ultimoSimulado, prova } = simuladosData;
                const dataFormatada = new Date(ultimoSimulado.date).toLocaleDateString('pt-BR');
                
                // Organizar disciplinas por categoria (se disponﾃｭvel)
                const disciplinas = [];
                if (prova && prova.disciplinas) {
                    Object.keys(prova.disciplinas).forEach(categoria => {
                        Object.keys(prova.disciplinas[categoria]).forEach(disciplina => {
                            if (ultimoSimulado.details[disciplina]) {
                                disciplinas.push({
                                    nome: disciplina,
                                    categoria: categoria,
                                    detalhes: ultimoSimulado.details[disciplina],
                                    tempo: ultimoSimulado.time[disciplina] || 0
                                });
                            }
                        });
                    });
                } else {
                    // Se nﾃ｣o houver estrutura de categorias, listar todas as disciplinas
                    Object.keys(ultimoSimulado.details).forEach(disciplina => {
                        disciplinas.push({
                            nome: disciplina,
                            categoria: 'GERAL',
                            detalhes: ultimoSimulado.details[disciplina],
                            tempo: ultimoSimulado.time[disciplina] || 0
                        });
                    });
                }
                
                let relatorioHTML = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-chart-bar"></i>
                            <div class="message-card-title">Relatﾃｳrio Completo - ${dataFormatada}</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-stats">
                                <div class="message-stat">
                                    <div class="message-stat-value">${ultimoSimulado.totalScore}</div>
                                    <div class="message-stat-label">Pontuaﾃｧﾃ｣o</div>
                                </div>
                                <div class="message-stat">
                                    <div class="message-stat-value">${ultimoSimulado.totalPercentage}%</div>
                                    <div class="message-stat-label">Acertos</div>
                                </div>
                                <div class="message-stat">
                                    <div class="message-stat-value">${ultimoSimulado.totalTime}</div>
                                    <div class="message-stat-label">Minutos</div>
                                </div>
                            </div>
                            
                            <div class="message-section">
                                <div class="message-section-title">Desempenho por Disciplina</div>
                                <div class="message-list">
                `;
                
                disciplinas.forEach(disciplina => {
                    const porcentagem = parseFloat(disciplina.detalhes.percentage);
                    let statusClass = '';
                    
                    if (porcentagem >= 80) statusClass = 'success';
                    else if (porcentagem >= 60) statusClass = 'warning';
                    else statusClass = 'danger';
                    
                    relatorioHTML += `
                        <div class="message-list-item">
                            <div class="message-list-icon"><i class="fas fa-book"></i></div>
                            <div class="message-list-content">
                                <div class="message-list-title">${disciplina.nome}</div>
                                <div class="message-list-description">
                                    ${disciplina.detalhes.correct} acertos de ${disciplina.detalhes.correct + disciplina.detalhes.errors} 
                                    <span class="message-badge message-badge-${statusClass}">${disciplina.detalhes.percentage}%</span>
                                </div>
                                <div class="message-list-description">
                                    Pontuaﾃｧﾃ｣o: ${disciplina.detalhes.score} 窶｢ Tempo: ${disciplina.tempo} min
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                relatorioHTML += `
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.addBotMessage(relatorioHTML, true, 'ultimo-simulado-relatorio');
            }

            showUltimoSimuladoData() {
                const simuladosData = this.getSimuladosData();
                
                if (!simuladosData) {
                    this.typeMessage("Nﾃ｣o foi possﾃｭvel carregar os dados dos simulados.");
                    return;
                }
                
                const { ultimoSimulado, simulados } = simuladosData;
                const dataFormatada = new Date(ultimoSimulado.date).toLocaleDateString('pt-BR');
                const hoje = new Date();
                const dataSimulado = new Date(ultimoSimulado.date);
                const diffTime = Math.abs(hoje - dataSimulado);
                const diffDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                const dataHTML = `
                    <div class="message-card">
                        <div class="message-card-header">
                            <i class="fas fa-calendar"></i>
                            <div class="message-card-title">Data do ﾃ嗟timo Simulado</div>
                        </div>
                        <div class="message-card-content">
                            <div class="message-alert message-alert-info">
                                <i class="fas fa-info-circle"></i>
                                <div>Seu ﾃｺltimo simulado foi realizado hﾃ｡ <strong>${diffDias} dia(s)</strong></div>
                            </div>
                            
                            <div class="message-list">
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-calendar-day"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Data</div>
                                        <div class="message-list-description">${dataFormatada}</div>
                                    </div>
                                </div>
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-history"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Tempo Decorrido</div>
                                        <div class="message-list-description">${diffDias} dia(s)</div>
                                    </div>
                                </div>
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-chart-line"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">Total de Simulados</div>
                                        <div class="message-list-description">${simulados.length} realizados</div>
                                    </div>
                                </div>
                            </div>
                            
                            ${diffDias > 30 ? `
                            <div class="message-alert message-alert-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <div>Faz mais de 30 dias desde seu ﾃｺltimo simulado. Considere realizar um novo para avaliar seu progresso.</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                this.addBotMessage(dataHTML, true, 'ultimo-simulado-data');
            }

            // Funﾃｧﾃｵes de alertas
            checkAlerts() {
                const alertas = [];
                const hoje = new Date();
                
                // Verificar revisﾃｵes atrasadas
                const revisoesAtrasadas = this.calculateOverdueReviews();
                
                if (revisoesAtrasadas > 0) {
                    alertas.push({
                        tipo: 'alert-danger',
                        icone: 'exclamation-triangle',
                        mensagem: `Vocﾃｪ tem ${revisoesAtrasadas} revisﾃｵes atrasadas!`
                    });
                }
                
                // Verificar meta diﾃ｡ria
                const dailyCompletedReviews = this.getModuleData('dailyCompletedReviews') || 0;
                const dailyReviewGoal = this.getModuleData('dailyReviewGoal') || 5;
                
                // Verificar se ﾃｩ um novo dia
                const lastReviewDate = this.getModuleData('lastReviewDate');
                const hojeStr = hoje.toISOString().split('T')[0];
                
                if (lastReviewDate !== hojeStr) {
                    // Resetar contador diﾃ｡rio se for um novo dia
                    this.setModuleData('dailyCompletedReviews', 0);
                    this.setModuleData('lastReviewDate', hojeStr);
                } else if (dailyCompletedReviews < dailyReviewGoal / 2) {
                    alertas.push({
                        tipo: 'alert-warning',
                        icone: 'bullseye',
                        mensagem: `Vocﾃｪ completou apenas ${dailyCompletedReviews} de ${dailyReviewGoal} revisﾃｵes hoje.`
                    });
                }
                
                // Verificar dias sem estudo (simulaﾃｧﾃ｣o)
                const ultimoEstudo = localStorage.getItem('ultimoEstudo');
                if (ultimoEstudo) {
                    const diasSemEstudo = Math.floor((hoje - new Date(ultimoEstudo)) / (1000 * 60 * 60 * 24));
                    if (diasSemEstudo >= 2) {
                        alertas.push({
                            tipo: 'alert-danger',
                            icone: 'calendar-times',
                            mensagem: `Vocﾃｪ nﾃ｣o estuda hﾃ｡ ${diasSemEstudo} dias!`
                        });
                    }
                }
                
                return alertas;
            }

            closeRegisterModal() {
                document.getElementById('registerModal').style.display = 'none';
            }

            createQuestaoCard(questao) {
                return `
                    <div class="task-card" data-type="questoes" data-id="${questao.id}">
                        <div class="task-header">
                            <div class="task-icon-large">ｧｩ</div>
                            <div class="task-title">Questﾃｵes: ${questao.disciplina}</div>
                        </div>
                        <div class="task-description">
                            <strong>Assunto:</strong> ${questao.nome}
                        </div>
                        <div class="task-form">
                            <div class="form-group">
                                <label for="questoes-feitas-${questao.id}">Quantidade de questﾃｵes feitas</label>
                                <input type="number" id="questoes-feitas-${questao.id}" min="0" placeholder="Ex: 20">
                            </div>
                            <div class="form-group">
                                <label for="questoes-erradas-${questao.id}">Quantidade de questﾃｵes erradas</label>
                                <input type="number" id="questoes-erradas-${questao.id}" min="0" placeholder="Ex: 5">
                            </div>
                            <div class="form-group">
                                <label for="questoes-tempo-${questao.id}">Tempo total gasto (minutos)</label>
                                <input type="number" id="questoes-tempo-${questao.id}" min="0" placeholder="Ex: 45">
                            </div>
                        </div>
                    </div>
                `;
            }

            createAnkiCard(deck) {
                return `
                    <div class="task-card" data-type="anki" data-id="${deck.id}">
                        <div class="task-header">
                            <div class="task-icon-large">${deck.emoji}</div>
                            <div class="task-title">Revisﾃ｣o Anki</div>
                        </div>
                        <div class="task-description">
                            <strong>Baralho:</strong> ${deck.nome}
                        </div>
                        <div class="task-form">
                            <div class="form-group">
                                <label for="anki-tempo-${deck.id}">Tempo de estudo (minutos)</label>
                                <input type="number" id="anki-tempo-${deck.id}" min="0" placeholder="Ex: 30">
                            </div>
                            <div class="form-group">
                                <label for="anki-cards-${deck.id}">Quantidade de cards revisados</label>
                                <input type="number" id="anki-cards-${deck.id}" min="0" placeholder="Ex: 50">
                            </div>
                        </div>
                    </div>
                `;
            }

            createTeoriaCard(materia) {
                return `
                    <div class="task-card" data-type="teoria" data-id="${materia}">
                        <div class="task-header">
                            <div class="task-icon-large">答</div>
                            <div class="task-title">Estudo Teﾃｳrico</div>
                        </div>
                        <div class="task-description">
                            <strong>Matﾃｩria:</strong> ${materia}
                        </div>
                        <div class="task-form">
                            <div class="form-group">
                                <label for="teoria-conteudo-${materia}">Conteﾃｺdo estudado (PDF/Aula)</label>
                                <input type="text" id="teoria-conteudo-${materia}" placeholder="Ex: PDF Aula 1, Video Aula 2">
                            </div>
                            <div class="form-group">
                                <label for="teoria-pagina-${materia}">Pﾃ｡gina/Progresso</label>
                                <input type="text" id="teoria-pagina-${materia}" placeholder="Ex: Pﾃ｡gina 42, 50% concluﾃｭdo">
                            </div>
                            <div class="form-group">
                                <label for="teoria-tempo-${materia}">Tempo de estudo (minutos)</label>
                                <input type="number" id="teoria-tempo-${materia}" min="0" placeholder="Ex: 60">
                            </div>
                        </div>
                    </div>
                `;
            }

            // FUNﾃﾃグ MODIFICADA: saveAllTasks com suporte a datas especﾃｭficas
            saveAllTasks() {
                const cards = document.querySelectorAll('.task-card');
                let hasError = false;
                let savedCount = 0;
                let totalTime = 0;
                let activities = {
                    questoes: [],
                    anki: [],
                    teoria: []
                };

                cards.forEach(card => {
                    const type = card.getAttribute('data-type');
                    const id = card.getAttribute('data-id');

                    if (type === 'questoes') {
                        const feitas = document.getElementById(`questoes-feitas-${id}`).value;
                        const erradas = document.getElementById(`questoes-erradas-${id}`).value;
                        const tempo = document.getElementById(`questoes-tempo-${id}`).value;

                        if (!feitas || !tempo) {
                            hasError = true;
                            card.style.border = '1px solid red';
                        } else {
                            card.style.border = '';
                            this.saveQuestoes(id, feitas, erradas, tempo);
                            savedCount++;
                            totalTime += parseInt(tempo);
                            activities.questoes.push({
                                assunto: id,
                                feitas: parseInt(feitas),
                                erradas: parseInt(erradas),
                                tempo: parseInt(tempo)
                            });
                        }
                    } else if (type === 'anki') {
                        const tempo = document.getElementById(`anki-tempo-${id}`).value;
                        const cards = document.getElementById(`anki-cards-${id}`).value;

                        if (!tempo || !cards) {
                            hasError = true;
                            card.style.border = '1px solid red';
                        } else {
                            card.style.border = '';
                            this.saveAnki(id, tempo, cards);
                            savedCount++;
                            totalTime += parseInt(tempo);
                            activities.anki.push({
                                deck: id,
                                tempo: parseInt(tempo),
                                cards: parseInt(cards)
                            });
                        }
                    } else if (type === 'teoria') {
                        const conteudo = document.getElementById(`teoria-conteudo-${id}`).value;
                        const pagina = document.getElementById(`teoria-pagina-${id}`).value;
                        const tempo = document.getElementById(`teoria-tempo-${id}`).value;

                        if (!tempo) {
                            hasError = true;
                            card.style.border = '1px solid red';
                        } else {
                            card.style.border = '';
                            this.saveTeoria(id, conteudo, pagina, tempo);
                            savedCount++;
                            totalTime += parseInt(tempo);
                            activities.teoria.push({
                                materia: id,
                                conteudo: conteudo,
                                pagina: pagina,
                                tempo: parseInt(tempo)
                            });
                        }
                    }
                });

                if (hasError) {
                    alert('Preencha todos os campos obrigatﾃｳrios!');
                    return;
                }

                // SALVAMENTO COM SUPORTE A DATAS ESPECﾃ孝ICAS
                const targetDate = this.currentViewDate;
                
                // Salvar a data do ﾃｺltimo registro (apenas se for o dia atual)
                if (!this.isRetroactiveMode) {
                    localStorage.setItem('lastRegisterDate', targetDate);
                }
                
                // Salvar as atividades do dia
                const dailyActivities = {
                    date: targetDate,
                    activities: activities,
                    registeredAt: new Date().toISOString(),
                    isRetroactive: this.isRetroactiveMode
                };
                
                // Para registros retroativos, usar uma chave especﾃｭfica
                const activitiesKey = this.isRetroactiveMode ? 
                    `dailyActivities_${targetDate}` : 'dailyActivities';
                localStorage.setItem(activitiesKey, JSON.stringify(dailyActivities));

                this.closeRegisterModal();
                
                if (savedCount > 0) {
                    this.showRegistrationSummary(savedCount, totalTime, activities, targetDate);
                }
                
                // Limpar modo retroativo
                this.isRetroactiveMode = false;
                this.currentViewDate = this.getDynamicDateString();
            }

            // FUNﾃﾃグ MODIFICADA: showRegistrationSummary com suporte a datas
            showRegistrationSummary(savedCount, totalTime, activities, targetDate) {
                const dateObj = new Date(targetDate + 'T00:00:00');
                const dataFormatada = this.formatDynamicDate(dateObj);
                
                const isYesterday = targetDate === this.getYesterdayDateString();
                const timePrefix = isYesterday ? "ontem" : "hoje";

                const successMessage = `
                    <div class="message-bubble bot-bubble message-alert-success">
                        <div class="message-content">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px">
                                <i class="fas fa-check-circle" style="color: var(--success)"></i>
                                <strong>${savedCount} atividade(s) registrada(s) para ${timePrefix}!</strong>
                            </div>
                            <div class="message-text">
                                Seu progresso de ${dataFormatada} foi salvo com sucesso.
                                ${isYesterday ? '<br><small>Registro retroativo concluﾃｭdo</small>' : ''}
                            </div>
                        </div>
                        <div class="bubble-time">${this.formatTime(new Date())}</div>
                    </div>
                `;
                
                // Adicionar a mensagem de sucesso
                const chatMessages = document.getElementById('chatMessages');
                const messageContainer = document.createElement('div');
                messageContainer.className = 'message-container bot-container';
                
                const avatar = document.createElement('div');
                avatar.className = 'avatar bot-avatar-small';
                avatar.innerHTML = '<i class="fas fa-robot"></i>';
                messageContainer.appendChild(avatar);
                
                messageContainer.innerHTML = successMessage;
                chatMessages.appendChild(messageContainer);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                setTimeout(() => {
                    let summaryHTML = `
                        <div class="message-card">
                            <div class="message-card-header">
                                <i class="fas fa-chart-bar"></i>
                                <div class="message-card-title">Resumo das Atividades - ${dataFormatada}</div>
                            </div>
                            <div class="message-card-content">
                    `;
                    
                    // Adicionar questﾃｵes
                    if (activities.questoes.length > 0) {
                        summaryHTML += `<div class="message-section-title">ｧｩ Questﾃｵes</div>`;
                        activities.questoes.forEach(q => {
                            const acertos = q.feitas - q.erradas;
                            const taxaAcerto = q.feitas > 0 ? Math.round((acertos / q.feitas) * 100) : 0;
                            summaryHTML += `
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">${q.assunto}</div>
                                        <div class="message-list-description">${q.feitas} questﾃｵes (${taxaAcerto}% acerto)</div>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    // Adicionar Anki
                    if (activities.anki.length > 0) {
                        summaryHTML += `<div class="message-section-title">煤 Anki</div>`;
                        activities.anki.forEach(a => {
                            summaryHTML += `
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">${a.deck}</div>
                                        <div class="message-list-description">${a.cards} cards revisados</div>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    // Adicionar teoria
                    if (activities.teoria.length > 0) {
                        summaryHTML += `<div class="message-section-title">答 Teoria</div>`;
                        activities.teoria.forEach(t => {
                            summaryHTML += `
                                <div class="message-list-item">
                                    <div class="message-list-icon"><i class="fas fa-check"></i></div>
                                    <div class="message-list-content">
                                        <div class="message-list-title">${t.materia}</div>
                                        <div class="message-list-description">${t.conteudo || t.pagina || 'Estudo'}</div>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    // Total
                    summaryHTML += `
                        <div class="message-divider"></div>
                        <div class="message-list-item">
                            <div class="message-list-icon"><i class="fas fa-clock"></i></div>
                            <div class="message-list-content">
                                <div class="message-list-title">Tempo Total</div>
                                <div class="message-list-description">${totalTime} minutos</div>
                            </div>
                        </div>
                    `;
                    
                    summaryHTML += `</div></div>`;
                    
                    this.addBotMessage(summaryHTML, false);
                    
                    setTimeout(() => {
                        // Mostrar prﾃｳximas datas de revisﾃ｣o
                        const nextReviews = this.getNextReviewDates();
                        if (nextReviews.length > 0) {
                            let nextReviewsHTML = `
                                <div class="message-card">
                                    <div class="message-card-header">
                                        <i class="fas fa-calendar-alt"></i>
                                        <div class="message-card-title">Prﾃｳximas Revisﾃｵes</div>
                                    </div>
                                    <div class="message-card-content">
                            `;
                            
                            nextReviews.forEach(review => {
                                nextReviewsHTML += `
                                    <div class="message-list-item">
                                        <div class="message-list-icon"><i class="fas fa-calendar-day"></i></div>
                                        <div class="message-list-content">
                                            <div class="message-list-title">${review.assunto}</div>
                                            <div class="message-list-description">${review.data}</div>
                                        </div>
                                    </div>
                                `;
                            });
                            
                            nextReviewsHTML += `</div></div>`;
                            this.addBotMessage(nextReviewsHTML, false);
                        }
                    }, 500);
                }, 500);
            }

            getNextReviewDates() {
                const disciplines = this.getModuleData('disciplines');
                const nextReviews = [];
                const hoje = new Date();
                
                if (disciplines && Array.isArray(disciplines)) {
                    disciplines.forEach(disciplina => {
                        if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) {
                            disciplina.assuntos.forEach(assunto => {
                                if (assunto.nextReviewDate) {
                                    const nextDate = new Date(assunto.nextReviewDate);
                                    if (nextDate > hoje) {
                                        nextReviews.push({
                                            assunto: assunto.nome,
                                            disciplina: disciplina.name,
                                            data: nextDate.toLocaleDateString('pt-BR')
                                        });
                                    }
                                }
                            });
                        }
                    });
                }
                
                // Ordenar por data e pegar as 3 mais prﾃｳximas
                return nextReviews
                    .sort((a, b) => new Date(a.data) - new Date(b.data))
                    .slice(0, 3);
            }

            // Funﾃｧﾃｵes de utilitﾃ｡rio
            toggleTheme() {
                if (this.currentTheme === 'light') {
                    document.body.classList.add('dark-theme');
                    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
                    this.currentTheme = 'dark';
                } else {
                    document.body.classList.remove('dark-theme');
                    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
                    this.currentTheme = 'light';
                }
                localStorage.setItem('theme', this.currentTheme);
            }

            addUserMessage(content) {
                this.addMessageToChat(content, true);
            }

            // Buscar ciclo ativo de forma robusta
            getActiveCycle() {
                // Tentar diferentes chaves possﾃｭveis para o ciclo ativo
                const possibleKeys = [
                    'StudyFlow_activeCycle',
                    'StudyFlow_allCycles',
                    'activeCycle',
                    'StudyFlow_cycle',
                    'currentCycle'
                ];
                
                for (const key of possibleKeys) {
                    const data = this.getModuleData(key);
                    if (data) {
                        // Se for um array (como StudyFlow_allCycles), pegar o primeiro ciclo
                        if (Array.isArray(data) && data.length > 0) {
                            const cycle = data[0];
                            if (cycle && cycle.generatedCycle && Array.isArray(cycle.generatedCycle)) {
                                return cycle;
                            }
                        }
                        // Se for um objeto direto
                        else if (data.generatedCycle && Array.isArray(data.generatedCycle)) {
                            return data;
                        }
                    }
                }
                
                // Se nﾃ｣o encontrou, tentar buscar em todas as chaves do localStorage
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.includes('cycle') || key.includes('Cycle') || key.includes('CYCLE'))) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            if (data) {
                                // Se for um array, pegar o primeiro item
                                if (Array.isArray(data) && data.length > 0) {
                                    const cycle = data[0];
                                    if (cycle && cycle.generatedCycle && Array.isArray(cycle.generatedCycle)) {
                                        return cycle;
                                    }
                                }
                                // Se for um objeto direto
                                else if (data.generatedCycle && Array.isArray(data.generatedCycle)) {
                                    return data;
                                }
                            }
                        } catch (e) {
                            // Ignorar chaves que nﾃ｣o sﾃ｣o JSON vﾃ｡lido
                        }
                    }
                }
                
                return null;
            }

            // Funﾃｧﾃｵes de integraﾃｧﾃ｣o com mﾃｳdulos
            getModuleData(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error(`Erro ao carregar dados do mﾃｳdulo: ${key}`, e);
                    return null;
                }
            }

            setModuleData(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.error(`Erro ao salvar dados no mﾃｳdulo: ${key}`, e);
                    return false;
                }
            }

            // ALGORITMO DE PRIORIZAﾃﾃグ IDﾃ劾TICO AO Mﾃ泥ULO DE REVISﾃ髭S
            calculateTodayReviews() {
                const disciplines = this.getModuleData('disciplines');
                const dailyReviewGoal = this.getModuleData('dailyReviewGoal') || 5;
                
                if (!disciplines || !Array.isArray(disciplines)) return [];
                
                const hoje = new Date();
                const todayTimestamp = hoje.getTime();
                let pendingTopics = [];
                
                // Fase 1: Coletar todos os assuntos pendentes
                disciplines.forEach(disciplina => {
                    if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) {
                        disciplina.assuntos.forEach(assunto => {
                            // Ignorar assuntos suspensos
                            if (assunto.suspended) return;
                            
                            // Verificar se estﾃ｡ na data de revisﾃ｣o ou atrasado
                            if (assunto.nextReviewDate && assunto.nextReviewDate <= todayTimestamp) {
                                // Calcular dias de atraso
                                const daysOverdue = Math.max(0, Math.floor((todayTimestamp - assunto.nextReviewDate) / (1000 * 60 * 60 * 24)));
                                
                                // Calcular dificuldade mﾃｩdia (invertida: maior dificuldade = maior prioridade)
                                let avgDifficulty = 2; // padrﾃ｣o
                                if (assunto.difficultyHistory && assunto.difficultyHistory.length > 0) {
                                    avgDifficulty = assunto.difficultyHistory.reduce((a, b) => a + b, 0) / assunto.difficultyHistory.length;
                                }
                                const difficultyScore = (3 - avgDifficulty); // Inverte a escala
                                
                                // Obter importﾃ｢ncia
                                const importance = assunto.importance || 3;
                                
                                // Calcular prioridade (mesma fﾃｳrmula do mﾃｳdulo de revisﾃｵes)
                                const priority = (difficultyScore * 40) + (daysOverdue * 60) + (importance * 20);
                                
                                pendingTopics.push({
                                    id: assunto.nome,
                                    nome: assunto.nome,
                                    disciplina: disciplina.name,
                                    priority: priority,
                                    daysOverdue: daysOverdue,
                                    difficulty: avgDifficulty,
                                    importance: importance
                                });
                            }
                        });
                    }
                });
                
                // Fase 2: Ordenar por prioridade (decrescente)
                pendingTopics.sort((a, b) => b.priority - a.priority);
                
                // Fase 3: Limitar pela meta diﾃ｡ria
                return pendingTopics.slice(0, dailyReviewGoal);
            }

            calculateOverdueReviews() {
                const disciplines = this.getModuleData('disciplines');
                if (!disciplines || !Array.isArray(disciplines)) return 0;
                
                const hoje = new Date();
                const todayTimestamp = hoje.getTime();
                let atrasadas = 0;
                
                disciplines.forEach(disciplina => {
                    if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) {
                        disciplina.assuntos.forEach(assunto => {
                            if (assunto.nextReviewDate && assunto.nextReviewDate < todayTimestamp && !assunto.suspended) {
                                atrasadas++;
                            }
                        });
                    }
                });
                
                return atrasadas;
            }

            // FUNﾃﾃグ MELHORADA: Agora retorna mﾃｺltiplas matﾃｩrias baseado na configuraﾃｧﾃ｣o
            getTodaySubjects() {
                const activeCycle = this.getActiveCycle();
                if (!activeCycle || !activeCycle.generatedCycle) {
                    return [];
                }
                
                const todayIndex = activeCycle.currentDay || 0;
                const materiasPorDia = this.materiasPorDia || 1;
                let subjects = [];
                
                const cycleLength = activeCycle.generatedCycle.length;
                if (cycleLength === 0) {
                    return [];
                }
                
                // Ajustar o ﾃｭndice para estar dentro dos limites
                const adjustedIndex = todayIndex % cycleLength;
                
                // Pegar as prﾃｳximas matﾃｩrias baseado na configuraﾃｧﾃ｣o
                for (let i = 0; i < materiasPorDia; i++) {
                    const index = (adjustedIndex + i) % cycleLength;
                    let subject = activeCycle.generatedCycle[index];
                    
                    // Se o subject for um array (mﾃｺltiplas matﾃｩrias no mesmo dia), juntﾃ｡-las
                    if (Array.isArray(subject)) {
                        subject = subject.join(', ');
                    }
                    
                    // Ignorar revisﾃｵes e simulados na contagem
                    if (subject && !subject.includes('Revisﾃ｣o') && !subject.includes('Simulado')) {
                        subjects.push(subject);
                    }
                }
                
                return subjects;
            }

            saveQuestoes(assuntoId, feitas, erradas, tempo) {
                const corretas = parseInt(feitas) - parseInt(erradas);
                const dificuldade = 2; // Valor padrﾃ｣o (Bom) - poderia ser capturado do usuﾃ｡rio
                
                // Atualizar mﾃｳdulo de revisﾃｵes
                const revisaoAtualizada = this.updateReviewModule(assuntoId, feitas, corretas, tempo, dificuldade);
                
                if (revisaoAtualizada) {
                    // Atualizar mﾃｳdulo home (mantendo o funcionamento atual)
                    let dailyCompletedReviews = this.getModuleData('dailyCompletedReviews') || 0;
                    dailyCompletedReviews += 1;
                    this.setModuleData('dailyCompletedReviews', dailyCompletedReviews);

                    const hoje = new Date();
                    this.setModuleData('lastReviewDate', hoje.toISOString().split('T')[0]);

                    this.registerHomeSession(`Questﾃｵes - ${assuntoId}`, parseInt(tempo));
                    localStorage.setItem('ultimoEstudo', new Date().toISOString());
                }
            }

            saveTeoria(materiaId, conteudo, pagina, tempo) {
                // Atualizar ciclo de estudos
                const cicloAtualizado = this.updateStudyCycle(materiaId, tempo);
                
                if (cicloAtualizado) {
                    // Registrar sessﾃ｣o no mﾃｳdulo Home (mantendo o funcionamento atual)
                    this.registerHomeSession(`Teoria - ${materiaId}`, parseInt(tempo));

                    // Salvar progresso da teoria
                    const teoriaProgress = this.getModuleData('teoriaProgress') || {};
                    teoriaProgress[materiaId] = {
                        conteudo: conteudo,
                        pagina: pagina,
                        ultimaAtualizacao: new Date().toISOString()
                    };
                    this.setModuleData('teoriaProgress', teoriaProgress);

                    localStorage.setItem('ultimoEstudo', new Date().toISOString());
                }
            }

            saveAnki(deckId, tempo, cards) {
                // Registrar sessﾃ｣o no mﾃｳdulo Home
                const ankiData = this.getModuleData('ciclos_focus_v1');
                const deck = ankiData && ankiData.decks ? ankiData.decks.find(d => d.id === deckId) : null;
                const deckNome = deck ? deck.name : deckId;

                this.registerHomeSession(`Anki - ${deckNome}`, parseInt(tempo));

                // Atualizar ﾃｺltimo estudo
                localStorage.setItem('ultimoEstudo', new Date().toISOString());
            }

            // Funﾃｧﾃ｣o para atualizar o mﾃｳdulo de revisﾃｵes (questﾃｵes)
            updateReviewModule(assuntoId, feitas, corretas, tempo, dificuldade) {
                const disciplines = this.getModuleData('disciplines') || [];
                const hoje = new Date().getTime();
                
                // Encontrar o assunto especﾃｭfico
                let assuntoEncontrado = null;
                let disciplinaEncontrada = null;
                
                for (const disciplina of disciplines) {
                    if (disciplina.assuntos && Array.isArray(disciplina.assuntos)) {
                        for (const assunto of disciplina.assuntos) {
                            if (assunto.nome === assuntoId) {
                                assuntoEncontrado = assunto;
                                disciplinaEncontrada = disciplina;
                                break;
                            }
                        }
                        if (assuntoEncontrado) break;
                    }
                }
                
                if (assuntoEncontrado) {
                    // Atualizar estatﾃｭsticas
                    assuntoEncontrado.questions = (assuntoEncontrado.questions || 0) + parseInt(feitas);
                    assuntoEncontrado.correct = (assuntoEncontrado.correct || 0) + parseInt(corretas);
                    assuntoEncontrado.incorrect = (assuntoEncontrado.incorrect || 0) + (parseInt(feitas) - parseInt(corretas));
                    
                    // Adicionar dificuldade ao histﾃｳrico
                    if (!assuntoEncontrado.difficultyHistory) {
                        assuntoEncontrado.difficultyHistory = [];
                    }
                    assuntoEncontrado.difficultyHistory.push(parseInt(dificuldade));
                    
                    // Calcular acurﾃ｡cia
                    const accuracy = (parseInt(corretas) / parseInt(feitas)) * 100;
                    
                    // Determinar o mﾃｩtodo de revisﾃ｣o
                    if (assuntoEncontrado.reviewMethod === 'fixed') {
                        // Revisﾃ｣o por desempenho - usar a funﾃｧﾃ｣o do mﾃｳdulo de revisﾃｵes
                        const interval = this.getPerformanceBasedInterval(accuracy);
                        assuntoEncontrado.interval = interval;
                        assuntoEncontrado.repetitions = (assuntoEncontrado.repetitions || 0) + 1;
                    } else {
                        // SM-2 - usar a funﾃｧﾃ｣o do mﾃｳdulo de revisﾃｵes
                        const result = this.calculateNextReviewSM2(
                            parseInt(dificuldade),
                            assuntoEncontrado.easeFactor || 2.5,
                            assuntoEncontrado.interval || 1,
                            assuntoEncontrado.repetitions || 0
                        );
                        
                        assuntoEncontrado.easeFactor = result.newEF;
                        assuntoEncontrado.interval = result.newInterval;
                        assuntoEncontrado.repetitions = result.repetitions;
                    }
                    
                    // Atualizar datas
                    assuntoEncontrado.lastReviewed = hoje;
                    
                    // Calcular prﾃｳxima data de revisﾃ｣o
                    const nextReviewDate = new Date(hoje);
                    nextReviewDate.setDate(nextReviewDate.getDate() + assuntoEncontrado.interval);
                    assuntoEncontrado.nextReviewDate = nextReviewDate.getTime();
                    
                    // Calcular forﾃｧa da memﾃｳria
                    assuntoEncontrado.memoryStrength = this.calculateMemoryStrength(assuntoEncontrado);
                    
                    // Salvar de volta no localStorage
                    this.setModuleData('disciplines', disciplines);
                    
                    return true;
                } else {
                    return false;
                }
            }

            // Funﾃｧﾃ｣o para atualizar o ciclo de estudos (matﾃｩrias teﾃｳricas)
            updateStudyCycle(materiaId, tempo) {
                const activeCycle = this.getActiveCycle();
                const hoje = new Date().toISOString().split('T')[0]; // Data no formato YYYY-MM-DD

                if (activeCycle && activeCycle.generatedCycle) {
                    const todayIndex = activeCycle.currentDay || 0;
                    const cycleLength = activeCycle.generatedCycle.length;

                    // Encontrar a matﾃｩria no ciclo atual
                    let materiaEncontrada = activeCycle.generatedCycle[todayIndex % cycleLength];

                    // Se for um array (mﾃｺltiplas matﾃｩrias no mesmo dia), verificar se a matﾃｩria estﾃ｡ presente
                    if (Array.isArray(materiaEncontrada)) {
                        if (materiaEncontrada.includes(materiaId)) {
                            materiaEncontrada = materiaId;
                        } else {
                            materiaEncontrada = null;
                        }
                    } else {
                        if (materiaEncontrada !== materiaId) {
                            materiaEncontrada = null;
                        }
                    }

                    if (materiaEncontrada) {
                        // Marcar como estudada no dia atual
                        if (!activeCycle.completedSubjects) {
                            activeCycle.completedSubjects = {};
                        }
                        activeCycle.completedSubjects[todayIndex] = true;

                        // Avanﾃｧar para o prﾃｳximo dia apenas se ainda nﾃ｣o avanﾃｧou hoje
                        if (activeCycle.lastAdvanced !== hoje) {
                            activeCycle.currentDay = (todayIndex + 1) % cycleLength;
                            activeCycle.lastAdvanced = hoje;
                        }

                        // Atualizar estatﾃｭsticas de progresso
                        if (!activeCycle.studyTime) {
                            activeCycle.studyTime = {};
                        }
                        // Usar a data como chave para o tempo de estudo
                        activeCycle.studyTime[hoje] = (activeCycle.studyTime[hoje] || 0) + parseInt(tempo);

                        // Salvar de volta
                        this.setModuleData('StudyFlow_activeCycle', activeCycle);

                        return true;
                    }
                }

                return false;
            }

            // Funﾃｧﾃ｣o para calcular intervalo baseado em desempenho
            getPerformanceBasedInterval(accuracy) {
                accuracy = Math.max(0, Math.min(100, accuracy));
                
                if (accuracy >= 100) return 30;
                if (accuracy >= 80) return 25;
                if (accuracy >= 60) return 15;
                if (accuracy >= 40) return 7;
                return 3;
            }

            // Algoritmo SM-2
            calculateNextReviewSM2(q, currentEF, currentInterval, repetitions) {
                let newEF = currentEF + (0.1 - (3 - q) * (0.08 + (3 - q) * 0.02));
                newEF = Math.max(1.3, Math.min(newEF, 2.5));
                let newInterval;
                if (q < 2) {
                    newInterval = 1;
                    repetitions = 0;
                } else {
                    if (repetitions === 0) {
                        newInterval = 1;
                    } else if (repetitions === 1) {
                        newInterval = 3;
                    } else {
                        newInterval = Math.round(currentInterval * newEF);
                    }
                    repetitions++;
                }
                return { newInterval, newEF, repetitions };
            }

            // Funﾃｧﾃ｣o para calcular forﾃｧa da memﾃｳria
            calculateMemoryStrength(topic) {
                if (!topic.lastReviewed) return 0.5;
                
                const now = this.getToday();
                const lastReview = topic.lastReviewed;
                
                const diffTime = Math.max(0, now - lastReview);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                const baseStrength = 0.9;
                const decayRate = 0.15;
                let strength = baseStrength * Math.exp(-decayRate * diffDays);
                
                if (topic.difficultyHistory && topic.difficultyHistory.length > 0) {
                    const avgDifficulty = topic.difficultyHistory.reduce((a, b) => a + b, 0) / topic.difficultyHistory.length;
                    strength *= (1 - (avgDifficulty * 0.15));
                }
                
                return Math.min(Math.max(strength, 0.1), 0.95);
            }

            // Funﾃｧﾃ｣o para obter timestamp do dia atual
            getToday() {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                return today.getTime();
            }

            registerHomeSession(subject, minutes) {
                const hoje = new Date();
                const dateKey = `sessions-${hoje.getDate()}-${hoje.getMonth()+1}-${hoje.getFullYear()}`;
                
                let sessions = this.getModuleData(dateKey) || [];
                sessions.push({
                    subject: subject,
                    minutes: minutes,
                    date: `${hoje.getDate()}-${hoje.getMonth()+1}-${hoje.getFullYear()}`,
                    timestamp: hoje.toISOString()
                });
                
                this.setModuleData(dateKey, sessions);
            }
        }

        // Inicializar o chatbot quando a pﾃ｡gina carregar
        let chatBot;
        document.addEventListener('DOMContentLoaded', function() {
            chatBot = new StudyFlowChatBot();
        });
    </script>
</body>
</html>
